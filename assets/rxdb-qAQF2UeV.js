var $f=Object.defineProperty;var Lf=(e,t,r)=>t in e?$f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var bi=(e,t,r)=>Lf(e,typeof t!="symbol"?t+"":t,r);var Us=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bf(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Sn(e){"@babel/helpers - typeof";return Sn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sn(e)}function jf(e,t){if(Sn(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Sn(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Kf(e){var t=jf(e,"string");return Sn(t)=="symbol"?t:t+""}function qf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Kf(n.key),n)}}function Gt(e,t,r){return t&&qf(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ff(e){return e[e.length-1]}function Ro(e){return Array.isArray(e)?e.slice(0):[e]}function Uf(e,t){e=e.slice(0);for(var r=[];e.length;){var n=e.splice(0,t);r.push(n)}return r}function Ao(e){return Array.isArray(e)}function Wf(e){return e!=null}function ja(e,t){var r=0,n=-1;for(var i of e){n=n+1;var s=t(i,n);if(s)r=r+1;else break}return r}function vr(e,t){var r=t.length;if(r!==0){var n=e.length;e.length=n+t.length;for(var i=0;i<r;++i)e[n+i]=t[i]}}function Hf(e){return e.filter(function(t,r,n){return n.indexOf(t)===r})}function Qt(e){for(var t="",r=0;r<e.length;r++){var n=e[r];if(n==="-")return parseInt(t,10);t+=n}throw new Error("malformatted revision: "+e)}function It(e,t){var r=t?Qt(t._rev)+1:1;return r+"-"+e}function zf(e){var t=e.split("."),r=t.length;return r===1?n=>n[e]:n=>{for(var i=n,s=0;s<r;++s){var u=t[s];if(i=i[u],typeof i>"u")return i}return i}}function Se(e){return Object.assign({},e)}function Qf(e){return Object.keys(e)[0]}function Ci(e,t=!1){if(!e)return e;if(!t&&Array.isArray(e))return e.sort((n,i)=>typeof n=="string"&&typeof i=="string"?n.localeCompare(i):typeof n=="object"?1:-1).map(n=>Ci(n,t));if(typeof e=="object"&&!Array.isArray(e)){var r={};return Object.keys(e).sort((n,i)=>n.localeCompare(i)).forEach(n=>{r[n]=Ci(e[n],t)}),r}return e}function ao(e){if(!e||e===null||typeof e!="object")return e;if(Array.isArray(e)){for(var t=new Array(e.length),r=t.length;r--;)t[r]=ao(e[r]);return t}var n={};for(var i in e)n[i]=ao(e[i]);return n}var Qe=ao;function kt(e,t,r){return Object.defineProperty(e,t,{get:function(){return r}}),r}var Mo=1;function _r(){return{lwt:Mo}}function ht(){return""}function Vf(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})}function Gf(e,t,r){if(t.length!==r.length)return!1;for(var n=0,i=t.length;n<i;){var s=t[n],u=r[n];if(n++,s._rev!==u._rev||s[e]!==u[e])return!1}return!0}var Yf=Object.defineProperty,Jf=(e,t,r)=>t in e?Yf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,$r=(e,t,r)=>(Jf(e,typeof t!="symbol"?t+"":t,r),r);class Ht{constructor(t,r){$r(this,"words"),$r(this,"sigBytes"),t=this.words=t||[],this.sigBytes=r===void 0?t.length*4:r}toString(t){return(t||Xf).stringify(this)}concat(t){if(this.clamp(),this.sigBytes%4)for(let r=0;r<t.sigBytes;r++){const n=t.words[r>>>2]>>>24-r%4*8&255;this.words[this.sigBytes+r>>>2]|=n<<24-(this.sigBytes+r)%4*8}else for(let r=0;r<t.sigBytes;r+=4)this.words[this.sigBytes+r>>>2]=t.words[r>>>2];return this.sigBytes+=t.sigBytes,this}clamp(){this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4)}clone(){return new Ht([...this.words])}}const Xf={stringify(e){const t=[];for(let r=0;r<e.sigBytes;r++){const n=e.words[r>>>2]>>>24-r%4*8&255;t.push((n>>>4).toString(16),(n&15).toString(16))}return t.join("")}},Zf={parse(e){const t=e.length,r=[];for(let n=0;n<t;n++)r[n>>>2]|=(e.charCodeAt(n)&255)<<24-n%4*8;return new Ht(r,t)}},eh={parse(e){return Zf.parse(unescape(encodeURIComponent(e)))}};class th{constructor(){$r(this,"_data",new Ht),$r(this,"_nDataBytes",0),$r(this,"_minBufferSize",0),$r(this,"blockSize",512/32)}reset(){this._data=new Ht,this._nDataBytes=0}_append(t){typeof t=="string"&&(t=eh.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_doProcessBlock(t,r){}_process(t){let r,n=this._data.sigBytes/(this.blockSize*4);t?n=Math.ceil(n):n=Math.max((n|0)-this._minBufferSize,0);const i=n*this.blockSize,s=Math.min(i*4,this._data.sigBytes);if(i){for(let u=0;u<i;u+=this.blockSize)this._doProcessBlock(this._data.words,u);r=this._data.words.splice(0,i),this._data.sigBytes-=s}return new Ht(r,s)}}class rh extends th{update(t){return this._append(t),this._process(),this}finalize(t){t&&this._append(t)}}var nh=Object.defineProperty,ih=(e,t,r)=>t in e?nh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ah=(e,t,r)=>(ih(e,t+"",r),r);const Ws=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],oh=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],or=[];class sh extends rh{constructor(){super(...arguments),ah(this,"_hash",new Ht([...Ws]))}reset(){super.reset(),this._hash=new Ht([...Ws])}_doProcessBlock(t,r){const n=this._hash.words;let i=n[0],s=n[1],u=n[2],l=n[3],h=n[4],m=n[5],v=n[6],g=n[7];for(let _=0;_<64;_++){if(_<16)or[_]=t[r+_]|0;else{const V=or[_-15],se=(V<<25|V>>>7)^(V<<14|V>>>18)^V>>>3,X=or[_-2],ee=(X<<15|X>>>17)^(X<<13|X>>>19)^X>>>10;or[_]=se+or[_-7]+ee+or[_-16]}const O=h&m^~h&v,D=i&s^i&u^s&u,A=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),L=(h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25),B=g+L+O+oh[_]+or[_],z=A+D;g=v,v=m,m=h,h=l+B|0,l=u,u=s,s=i,i=B+z|0}n[0]=n[0]+i|0,n[1]=n[1]+s|0,n[2]=n[2]+u|0,n[3]=n[3]+l|0,n[4]=n[4]+h|0,n[5]=n[5]+m|0,n[6]=n[6]+v|0,n[7]=n[7]+g|0}finalize(t){super.finalize(t);const r=this._nDataBytes*8,n=this._data.sigBytes*8;return this._data.words[n>>>5]|=128<<24-n%32,this._data.words[(n+64>>>9<<4)+14]=Math.floor(r/4294967296),this._data.words[(n+64>>>9<<4)+15]=r,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}}function uh(e){return new sh().finalize(e).toString()}function ch(e){return Promise.resolve(uh(e))}async function lh(e){var t=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",t),n=Array.prototype.map.call(new Uint8Array(r),i=>("00"+i.toString(16)).slice(-2)).join("");return n}var fh=typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof crypto.subtle.digest=="function",Vu=fh?lh:ch;function hh(){return new Promise(e=>setTimeout(e,0))}function dh(e=0){return new Promise(t=>setTimeout(t,e))}function ph(e){return e&&typeof e.then=="function"?e:Promise.resolve(e)}var mh=Promise.resolve(!0),pt=Promise.resolve(!1),To=Promise.resolve(null),ft=Promise.resolve();function Wi(e=1e4){return typeof requestIdleCallback=="function"?new Promise(t=>{requestIdleCallback(()=>t(),{timeout:e})}):dh(0)}var Ka=ft;function vh(e=void 0){return Ka=Ka.then(()=>Wi(e)),Ka}function yh(e,t){return e.reduce((r,n)=>r.then(n),Promise.resolve(t))}var gh=/\./g,Hs="abcdefghijklmnopqrstuvwxyz";function An(e=10){for(var t="",r=0;r<e;r++)t+=Hs.charAt(Math.floor(Math.random()*Hs.length));return t}function Gu(e){e+="";var t=e.charAt(0).toUpperCase();return t+e.substr(1)}function pn(e){for(;e.charAt(0)===".";)e=e.substr(1);for(;e.slice(-1)===".";)e=e.slice(0,-1);return e}function En(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,n;if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!En(e[n],t[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var i=Object.keys(e);if(r=i.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[n]))return!1;for(n=r;n--!==0;){var s=i[n];if(!En(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}var oo=e=>{var t=typeof e;return e!==null&&(t==="object"||t==="function")},qa=new Set(["__proto__","prototype","constructor"]),bh=new Set("0123456789");function Yu(e){var t=[],r="",n="start",i=!1;for(var s of e)switch(s){case"\\":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");i&&(r+=s),n="property",i=!i;break}case".":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="property";break}if(i){i=!1,r+=s;break}if(qa.has(r))return[];t.push(r),r="",n="property";break}case"[":{if(n==="index")throw new Error("Invalid character in an index");if(n==="indexEnd"){n="index";break}if(i){i=!1,r+=s;break}if(n==="property"){if(qa.has(r))return[];t.push(r),r=""}n="index";break}case"]":{if(n==="index"){t.push(Number.parseInt(r,10)),r="",n="indexEnd";break}if(n==="indexEnd")throw new Error("Invalid character after an index")}default:{if(n==="index"&&!bh.has(s))throw new Error("Invalid character in an index");if(n==="indexEnd")throw new Error("Invalid character after an index");n==="start"&&(n="property"),i&&(i=!1,r+="\\"),r+=s}}switch(i&&(r+="\\"),n){case"property":{if(qa.has(r))return[];t.push(r);break}case"index":throw new Error("Index was not closed");case"start":{t.push("");break}}return t}function Ju(e,t){if(typeof t!="number"&&Array.isArray(e)){var r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}function wh(e,t){if(Ju(e,t))throw new Error("Cannot use string index")}function Vt(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!oo(e)||typeof t!="string")return r===void 0?e:r;var n=Yu(t);if(n.length===0)return r;for(var i=0;i<n.length;i++){var s=n[i];if(Ju(e,s)?e=i===n.length-1?void 0:null:e=e[s],e==null){if(i!==n.length-1)return r;break}}return e===void 0?r:e}function Xu(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!oo(e)||typeof t!="string")return e;for(var n=e,i=Yu(t),s=0;s<i.length;s++){var u=i[s];wh(e,u),s===i.length-1?e[u]=r:oo(e[u])||(e[u]=typeof i[s+1]=="number"?[]:{}),e=e[u]}return n}function yr(e,t){var r=e.get(t);if(typeof r>"u")throw new Error("missing value from map "+t);return r}function Pt(e,t,r,n){var i=e.get(t);return typeof i>"u"&&(i=r(),e.set(t,i)),i}function ve(e){var t=e.split("-"),r="RxDB";return t.forEach(n=>{r+=Gu(n)}),r+="Plugin",new Error(`You are using a function which must be overwritten by a plugin.
        You should either prevent the usage of this function or add the plugin via:
            import { `+r+" } from 'rxdb/plugins/"+e+`';
            addRxPlugin(`+r+`);
        `)}function _h(e){var t={name:e.name,message:e.message,rxdb:e.rxdb,parameters:e.parameters,extensions:e.extensions,code:e.code,url:e.url,stack:e.stack?e.stack.replace(/\n/g,` 
 `):void 0};return t}var Fa=0;function je(){var e=Date.now();e=e+.01,e<=Fa&&(e=Fa+.01);var t=parseFloat(e.toFixed(2));return Fa=t,t}function ae(e,t){if(!e)throw t||(t=""),new Error("ensureNotFalsy() is falsy: "+t);return e}var Mn={bufferSize:1,refCount:!0},Zu="15.39.0",Ua={},Sh="6da4936d1425ff3a5c44c02342c6daf791d266be3ae8479b8ec59e261df41b93";function On(e,t){return On=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},On(e,t)}function No(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,On(e,t)}function so(e){return so=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},so(e)}function Eh(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function ec(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ec=function(){return!!e})()}function Oh(e,t,r){if(ec())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&On(i,r.prototype),i}function Ri(e){var t=typeof Map=="function"?new Map:void 0;return Ri=function(n){if(n===null||!Eh(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return Oh(n,arguments,so(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),On(i,n)},Ri(e)}var ge={isDevMode(){return!1},deepFreezeWhenDevMode(e){return e},tunnelErrorMessage(e){return"RxDB Error-Code "+e+`.
        Error messages are not included in RxDB core to reduce build size.
        `}};function kh(e){var t="";return Object.keys(e).length===0||(t+=`Given parameters: {
`,t+=Object.keys(e).map(r=>{var n="[object Object]";try{r==="errors"?n=e[r].map(i=>JSON.stringify(i,Object.getOwnPropertyNames(i))):n=JSON.stringify(e[r],function(i,s){return s===void 0?null:s},2)}catch{}return r+":"+n}).join(`
`),t+="}"),t}function tc(e,t,r){return"RxError ("+t+`):
`+e+`
`+kh(r)}var xh=function(e){function t(n,i,s={}){var u,l=tc(i,n,s);return u=e.call(this,l)||this,u.code=n,u.message=l,u.url=$o(n),u.parameters=s,u.rxdb=!0,u}No(t,e);var r=t.prototype;return r.toString=function(){return this.message},Gt(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])}(Ri(Error)),Ih=function(e){function t(n,i,s={}){var u,l=tc(i,n,s);return u=e.call(this,l)||this,u.code=n,u.message=l,u.url=$o(n),u.parameters=s,u.rxdb=!0,u}No(t,e);var r=t.prototype;return r.toString=function(){return this.message},Gt(t,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}])}(Ri(TypeError));function $o(e){return"https://rxdb.info/errors.html?console=errors#"+e}function rc(e){return`
 You can find out more about this error here: `+$o(e)+" "}function G(e,t){return new xh(e,ge.tunnelErrorMessage(e)+rc(e),t)}function Ze(e,t){return new Ih(e,ge.tunnelErrorMessage(e)+rc(e),t)}function Hi(e){return e&&e.status===409?e:!1}var Ph={409:"document write conflict",422:"schema validation error",510:"attachment data missing"};function Dh(e){return G("COL20",{name:Ph[e.status],document:e.documentId,writeError:e})}var kn={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],createRxState:[],postDestroyRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preStorageWrite:[],preMigrateDocument:[],postMigrateDocument:[],preDestroyRxDatabase:[],postRemoveRxDatabase:[],postCleanup:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};function dt(e,t){kn[e].length>0&&kn[e].forEach(r=>r(t))}function Tn(e,t){return Promise.all(kn[e].map(r=>r(t)))}function Kr(e,t){var r=t;r=r.replace(gh,".properties."),r="properties."+r,r=pn(r);var n=Vt(e,r);return n}function Ch(e,t,r){if(typeof t.primaryKey=="string")return r;var n=Sr(t,r),i=r[e];if(i&&i!==n)throw G("DOC19",{args:{documentData:r,existingPrimary:i,newPrimary:n},schema:t});return r[e]=n,r}function at(e){return typeof e=="string"?e:e.key}function Rh(e){var t=at(e.primaryKey),r=Kr(e,t);return ae(r.maxLength)}function Sr(e,t){if(typeof e.primaryKey=="string")return t[e.primaryKey];var r=e.primaryKey;return r.fields.map(n=>{var i=Vt(t,n);if(typeof i>"u")throw G("DOC18",{args:{field:n,documentData:t}});return i}).join(r.separator)}function Ah(e){var t=Ci(e,!0);return t}function Mh(e){return["_deleted",e]}function zi(e){e=Se(e);var t=at(e.primaryKey);e.properties=Se(e.properties),e.additionalProperties=!1,Object.prototype.hasOwnProperty.call(e,"keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=Th,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments");var r=nc(e);vr(e.required,r),e.required=e.required.filter(s=>!s.includes(".")).filter((s,u,l)=>l.indexOf(s)===u),e.version=e.version||0;var n=e.indexes.map(s=>{var u=Ao(s)?s.slice(0):[s];return u.includes(t)||u.push(t),u[0]!=="_deleted"&&u.unshift("_deleted"),u});n.length===0&&n.push(Mh(t)),n.push(["_meta.lwt",t]),e.internalIndexes&&e.internalIndexes.map(s=>{n.push(s)});var i=new Set;return n.filter(s=>{var u=s.join(",");return i.has(u)?!1:(i.add(u),!0)}),e.indexes=n,e}var Th={type:"object",properties:{lwt:{type:"number",minimum:Mo,maximum:1e15,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function nc(e){var t=Object.keys(e.properties).filter(n=>e.properties[n].final),r=at(e.primaryKey);return t.push(r),typeof e.primaryKey!="string"&&e.primaryKey.fields.forEach(n=>t.push(n)),t}function Nh(e,t){for(var r=Object.keys(e.defaultValues),n=0;n<r.length;++n){var i=r[n];(!Object.prototype.hasOwnProperty.call(t,i)||typeof t[i]>"u")&&(t[i]=e.defaultValues[i])}return t}var ic=function(){function e(r,n){this.jsonSchema=r,this.hashFunction=n,this.indexes=$h(this.jsonSchema),this.primaryPath=at(this.jsonSchema.primaryKey),this.finalFields=nc(this.jsonSchema)}var t=e.prototype;return t.validateChange=function(n,i){this.finalFields.forEach(s=>{if(!En(n[s],i[s]))throw G("DOC9",{dataBefore:n,dataAfter:i,fieldName:s,schema:this.jsonSchema})})},t.getDocumentPrototype=function(){var n={},i=Kr(this.jsonSchema,"");return Object.keys(i).forEach(s=>{var u=s;n.__defineGetter__(s,function(){if(!(!this.get||typeof this.get!="function")){var l=this.get(u);return l}}),Object.defineProperty(n,s+"$",{get:function(){return this.get$(u)},enumerable:!1,configurable:!1}),Object.defineProperty(n,s+"$$",{get:function(){return this.get$$(u)},enumerable:!1,configurable:!1}),Object.defineProperty(n,s+"_",{get:function(){return this.populate(u)},enumerable:!1,configurable:!1})}),kt(this,"getDocumentPrototype",()=>n),n},t.getPrimaryOfDocumentData=function(n){return Sr(this.jsonSchema,n)},Gt(e,[{key:"version",get:function(){return this.jsonSchema.version}},{key:"defaultValues",get:function(){var r={};return Object.entries(this.jsonSchema.properties).filter(([,n])=>Object.prototype.hasOwnProperty.call(n,"default")).forEach(([n,i])=>r[n]=i.default),kt(this,"defaultValues",r)}},{key:"hash",get:function(){return kt(this,"hash",this.hashFunction(JSON.stringify(this.jsonSchema)))}}])}();function $h(e){return(e.indexes||[]).map(t=>Ao(t)?t:[t])}function Lh(e){var t=e.version?e.version:0,r=0;return new Array(t).fill(0).map(()=>r++)}function Bh(e,t,r=!0){r&&dt("preCreateRxSchema",e);var n=zi(e);n=Ah(n),ge.deepFreezeWhenDevMode(n);var i=new ic(n,t);return dt("createRxSchema",i),i}function Re(e){return typeof e=="function"}function jh(e){return Re(e==null?void 0:e.lift)}function wt(e){return function(t){if(jh(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var uo=function(e,t){return uo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},uo(e,t)};function Er(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");uo(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function Kh(e,t,r,n){function i(s){return s instanceof r?s:new r(function(u){u(s)})}return new(r||(r=Promise))(function(s,u){function l(v){try{m(n.next(v))}catch(g){u(g)}}function h(v){try{m(n.throw(v))}catch(g){u(g)}}function m(v){v.done?s(v.value):i(v.value).then(l,h)}m((n=n.apply(e,t||[])).next())})}function ac(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,u=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return u.next=l(0),u.throw=l(1),u.return=l(2),typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(m){return function(v){return h([m,v])}}function h(m){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,m[0]&&(r=0)),r;)try{if(n=1,i&&(s=m[0]&2?i.return:m[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,m[1])).done)return s;switch(i=0,s&&(m=[m[0]&2,s.value]),m[0]){case 0:case 1:s=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,i=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!s||m[1]>s[0]&&m[1]<s[3])){r.label=m[1];break}if(m[0]===6&&r.label<s[1]){r.label=s[1],s=m;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(m);break}s[2]&&r.ops.pop(),r.trys.pop();continue}m=t.call(e,r)}catch(v){m=[6,v],i=0}finally{n=s=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}}function qr(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function gr(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,s=[],u;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(l){u={error:l}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(u)throw u.error}}return s}function br(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}function Lr(e){return this instanceof Lr?(this.v=e,this):new Lr(e)}function qh(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",u),i[Symbol.asyncIterator]=function(){return this},i;function u(O){return function(D){return Promise.resolve(D).then(O,g)}}function l(O,D){n[O]&&(i[O]=function(A){return new Promise(function(L,B){s.push([O,A,L,B])>1||h(O,A)})},D&&(i[O]=D(i[O])))}function h(O,D){try{m(n[O](D))}catch(A){_(s[0][3],A)}}function m(O){O.value instanceof Lr?Promise.resolve(O.value.v).then(v,g):_(s[0][2],O)}function v(O){h("next",O)}function g(O){h("throw",O)}function _(O,D){O(D),s.shift(),s.length&&h(s[0][0],s[0][1])}}function Fh(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof qr=="function"?qr(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=e[s]&&function(u){return new Promise(function(l,h){u=e[s](u),i(l,h,u.done,u.value)})}}function i(s,u,l,h){Promise.resolve(h).then(function(m){s({value:m,done:l})},u)}}var oc=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function sc(e){return Re(e==null?void 0:e.then)}function Lo(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var Wa=Lo(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function co(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Qi=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,i,s;if(!this.closed){this.closed=!0;var u=this._parentage;if(u)if(this._parentage=null,Array.isArray(u))try{for(var l=qr(u),h=l.next();!h.done;h=l.next()){var m=h.value;m.remove(this)}}catch(A){t={error:A}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}else u.remove(this);var v=this.initialTeardown;if(Re(v))try{v()}catch(A){s=A instanceof Wa?A.errors:[A]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var _=qr(g),O=_.next();!O.done;O=_.next()){var D=O.value;try{zs(D)}catch(A){s=s??[],A instanceof Wa?s=br(br([],gr(s)),gr(A.errors)):s.push(A)}}}catch(A){n={error:A}}finally{try{O&&!O.done&&(i=_.return)&&i.call(_)}finally{if(n)throw n.error}}}if(s)throw new Wa(s)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)zs(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&co(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&co(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),uc=Qi.EMPTY;function cc(e){return e instanceof Qi||e&&"closed"in e&&Re(e.remove)&&Re(e.add)&&Re(e.unsubscribe)}function zs(e){Re(e)?e():e.unsubscribe()}var Uh={Promise:void 0},Wh={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,br([e,t],gr(r)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function lc(e){Wh.setTimeout(function(){throw e})}function Qs(){}function Ei(e){e()}var Bo=function(e){Er(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,cc(r)&&r.add(n)):n.destination=Qh,n}return t.create=function(r,n,i){return new Fr(r,n,i)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Qi),Hh=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){wi(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){wi(n)}else wi(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){wi(r)}},e}(),Fr=function(e){Er(t,e);function t(r,n,i){var s=e.call(this)||this,u;return Re(r)||!r?u={next:r??void 0,error:n??void 0,complete:i??void 0}:u=r,s.destination=new Hh(u),s}return t}(Bo);function wi(e){lc(e)}function zh(e){throw e}var Qh={closed:!0,next:Qs,error:zh,complete:Qs},jo=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Nn(e){return e}function Vh(e){return e.length===0?Nn:e.length===1?e[0]:function(r){return e.reduce(function(n,i){return i(n)},r)}}var nt=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var i=this,s=Yh(t)?t:new Fr(t,r,n);return Ei(function(){var u=i,l=u.operator,h=u.source;s.add(l?l.call(s,h):h?i._subscribe(s):i._trySubscribe(s))}),s},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=Vs(r),new r(function(i,s){var u=new Fr({next:function(l){try{t(l)}catch(h){s(h),u.unsubscribe()}},error:s,complete:i});n.subscribe(u)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[jo]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Vh(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=Vs(t),new t(function(n,i){var s;r.subscribe(function(u){return s=u},function(u){return i(u)},function(){return n(s)})})},e.create=function(t){return new e(t)},e}();function Vs(e){var t;return(t=e??Uh.Promise)!==null&&t!==void 0?t:Promise}function Gh(e){return e&&Re(e.next)&&Re(e.error)&&Re(e.complete)}function Yh(e){return e&&e instanceof Bo||Gh(e)&&cc(e)}function fc(e){return Re(e[jo])}function hc(e){return Symbol.asyncIterator&&Re(e==null?void 0:e[Symbol.asyncIterator])}function dc(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Jh(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var pc=Jh();function mc(e){return Re(e==null?void 0:e[pc])}function vc(e){return qh(this,arguments,function(){var r,n,i,s;return ac(this,function(u){switch(u.label){case 0:r=e.getReader(),u.label=1;case 1:u.trys.push([1,,9,10]),u.label=2;case 2:return[4,Lr(r.read())];case 3:return n=u.sent(),i=n.value,s=n.done,s?[4,Lr(void 0)]:[3,5];case 4:return[2,u.sent()];case 5:return[4,Lr(i)];case 6:return[4,u.sent()];case 7:return u.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function yc(e){return Re(e==null?void 0:e.getReader)}function Nt(e){if(e instanceof nt)return e;if(e!=null){if(fc(e))return Xh(e);if(oc(e))return Zh(e);if(sc(e))return ed(e);if(hc(e))return gc(e);if(mc(e))return td(e);if(yc(e))return rd(e)}throw dc(e)}function Xh(e){return new nt(function(t){var r=e[jo]();if(Re(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Zh(e){return new nt(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function ed(e){return new nt(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,lc)})}function td(e){return new nt(function(t){var r,n;try{for(var i=qr(e),s=i.next();!s.done;s=i.next()){var u=s.value;if(t.next(u),t.closed)return}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}t.complete()})}function gc(e){return new nt(function(t){nd(e,t).catch(function(r){return t.error(r)})})}function rd(e){return gc(vc(e))}function nd(e,t){var r,n,i,s;return Kh(this,void 0,void 0,function(){var u,l;return ac(this,function(h){switch(h.label){case 0:h.trys.push([0,5,6,11]),r=Fh(e),h.label=1;case 1:return[4,r.next()];case 2:if(n=h.sent(),!!n.done)return[3,4];if(u=n.value,t.next(u),t.closed)return[2];h.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=h.sent(),i={error:l},[3,11];case 6:return h.trys.push([6,,9,10]),n&&!n.done&&(s=r.return)?[4,s.call(r)]:[3,8];case 7:h.sent(),h.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Dt(e,t,r,n,i){return new id(e,t,r,n,i)}var id=function(e){Er(t,e);function t(r,n,i,s,u,l){var h=e.call(this,r)||this;return h.onFinalize=u,h.shouldUnsubscribe=l,h._next=n?function(m){try{n(m)}catch(v){r.error(v)}}:e.prototype._next,h._error=s?function(m){try{s(m)}catch(v){r.error(v)}finally{this.unsubscribe()}}:e.prototype._error,h._complete=i?function(){try{i()}catch(m){r.error(m)}finally{this.unsubscribe()}}:e.prototype._complete,h}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(Bo),bc={now:function(){return(bc.delegate||Date).now()},delegate:void 0};function ad(e){return e&&Re(e.schedule)}function Ko(e){return e[e.length-1]}function od(e){return Re(Ko(e))?e.pop():void 0}function $n(e){return ad(Ko(e))?e.pop():void 0}function wc(e,t){return typeof Ko(e)=="number"?e.pop():t}function zt(e,t,r,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var s=t.schedule(function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(s),!i)return s}var sd=Array.isArray,ud=Object.getPrototypeOf,cd=Object.prototype,ld=Object.keys;function fd(e){if(e.length===1){var t=e[0];if(sd(t))return{args:t,keys:null};if(hd(t)){var r=ld(t);return{args:r.map(function(n){return t[n]}),keys:r}}}return{args:e,keys:null}}function hd(e){return e&&typeof e=="object"&&ud(e)===cd}function _c(e,t){return t===void 0&&(t=0),wt(function(r,n){r.subscribe(Dt(n,function(i){return zt(n,e,function(){return n.next(i)},t)},function(){return zt(n,e,function(){return n.complete()},t)},function(i){return zt(n,e,function(){return n.error(i)},t)}))})}function Sc(e,t){return t===void 0&&(t=0),wt(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function dd(e,t){return Nt(e).pipe(Sc(t),_c(t))}function pd(e,t){return Nt(e).pipe(Sc(t),_c(t))}function md(e,t){return new nt(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function vd(e,t){return new nt(function(r){var n;return zt(r,t,function(){n=e[pc](),zt(r,t,function(){var i,s,u;try{i=n.next(),s=i.value,u=i.done}catch(l){r.error(l);return}u?r.complete():r.next(s)},0,!0)}),function(){return Re(n==null?void 0:n.return)&&n.return()}})}function Ec(e,t){if(!e)throw new Error("Iterable cannot be null");return new nt(function(r){zt(r,t,function(){var n=e[Symbol.asyncIterator]();zt(r,t,function(){n.next().then(function(i){i.done?r.complete():r.next(i.value)})},0,!0)})})}function yd(e,t){return Ec(vc(e),t)}function gd(e,t){if(e!=null){if(fc(e))return dd(e,t);if(oc(e))return md(e,t);if(sc(e))return pd(e,t);if(hc(e))return Ec(e,t);if(mc(e))return vd(e,t);if(yc(e))return yd(e,t)}throw dc(e)}function Ln(e,t){return t?gd(e,t):Nt(e)}function Te(e,t){return wt(function(r,n){var i=0;r.subscribe(Dt(n,function(s){n.next(e.call(t,s,i++))}))})}var bd=Array.isArray;function wd(e,t){return bd(t)?e.apply(void 0,br([],gr(t))):e(t)}function _d(e){return Te(function(t){return wd(e,t)})}function Sd(e,t){return e.reduce(function(r,n,i){return r[n]=t[i],r},{})}function Ed(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=$n(e),n=od(e),i=fd(e),s=i.args,u=i.keys;if(s.length===0)return Ln([],r);var l=new nt(Od(s,r,u?function(h){return Sd(u,h)}:Nn));return n?l.pipe(_d(n)):l}function Od(e,t,r){return r===void 0&&(r=Nn),function(n){Gs(t,function(){for(var i=e.length,s=new Array(i),u=i,l=i,h=function(v){Gs(t,function(){var g=Ln(e[v],t),_=!1;g.subscribe(Dt(n,function(O){s[v]=O,_||(_=!0,l--),l||n.next(r(s.slice()))},function(){--u||n.complete()}))},n)},m=0;m<i;m++)h(m)},n)}}function Gs(e,t,r){e?zt(r,e,t):t()}function kd(e,t,r,n,i,s,u,l){var h=[],m=0,v=0,g=!1,_=function(){g&&!h.length&&!m&&t.complete()},O=function(A){return m<n?D(A):h.push(A)},D=function(A){m++;var L=!1;Nt(r(A,v++)).subscribe(Dt(t,function(B){t.next(B)},function(){L=!0},void 0,function(){if(L)try{m--;for(var B=function(){var z=h.shift();u||D(z)};h.length&&m<n;)B();_()}catch(z){t.error(z)}}))};return e.subscribe(Dt(t,O,function(){g=!0,_()})),function(){}}function Ct(e,t,r){return r===void 0&&(r=1/0),Re(t)?Ct(function(n,i){return Te(function(s,u){return t(n,s,i,u)})(Nt(e(n,i)))},r):(typeof t=="number"&&(r=t),wt(function(n,i){return kd(n,i,e,r)}))}function qo(e){return e===void 0&&(e=1/0),Ct(Nn,e)}function xd(){return qo(1)}var Id=Lo(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),tt=function(e){Er(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new Ys(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new Id},t.prototype.next=function(r){var n=this;Ei(function(){var i,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var u=qr(n.currentObservers),l=u.next();!l.done;l=u.next()){var h=l.value;h.next(r)}}catch(m){i={error:m}}finally{try{l&&!l.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}}})},t.prototype.error=function(r){var n=this;Ei(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},t.prototype.complete=function(){var r=this;Ei(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,i=this,s=i.hasError,u=i.isStopped,l=i.observers;return s||u?uc:(this.currentObservers=null,l.push(r),new Qi(function(){n.currentObservers=null,co(l,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,s=n.thrownError,u=n.isStopped;i?r.error(s):u&&r.complete()},t.prototype.asObservable=function(){var r=new nt;return r.source=this,r},t.create=function(r,n){return new Ys(r,n)},t}(nt),Ys=function(e){Er(t,e);function t(r,n){var i=e.call(this)||this;return i.destination=r,i.source=n,i}return t.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},t.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:uc},t}(tt);function Js(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return xd()(Ln(e,$n(e)))}var Pd=new nt(function(e){return e.complete()});function xn(e,t){return t===void 0&&(t=Nn),e=e??Dd,wt(function(r,n){var i,s=!0;r.subscribe(Dt(n,function(u){var l=t(u);(s||!e(i,l))&&(s=!1,i=l,n.next(u))}))})}function Dd(e,t){return e===t}function ye(e,t){return wt(function(r,n){var i=0;r.subscribe(Dt(n,function(s){return e.call(t,s,i++)&&n.next(s)}))})}var Cd=Lo(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function Rd(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=$n(e),n=wc(e,1/0);return wt(function(i,s){qo(n)(Ln(br([i],gr(e)),r)).subscribe(s)})}function Ad(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Rd.apply(void 0,br([],gr(e)))}var cr=function(e){Er(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,i=r.thrownError,s=r._value;if(n)throw i;return this._throwIfClosed(),s},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(tt),Md=function(e){Er(t,e);function t(r,n,i){r===void 0&&(r=1/0),n===void 0&&(n=1/0),i===void 0&&(i=bc);var s=e.call(this)||this;return s._bufferSize=r,s._windowTime=n,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,r),s._windowTime=Math.max(1,n),s}return t.prototype.next=function(r){var n=this,i=n.isStopped,s=n._buffer,u=n._infiniteTimeWindow,l=n._timestampProvider,h=n._windowTime;i||(s.push(r),!u&&s.push(l.now()+h)),this._trimBuffer(),e.prototype.next.call(this,r)},t.prototype._subscribe=function(r){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(r),i=this,s=i._infiniteTimeWindow,u=i._buffer,l=u.slice(),h=0;h<l.length&&!r.closed;h+=s?1:2)r.next(l[h]);return this._checkFinalizedStatuses(r),n},t.prototype._trimBuffer=function(){var r=this,n=r._bufferSize,i=r._timestampProvider,s=r._buffer,u=r._infiniteTimeWindow,l=(u?1:2)*n;if(n<1/0&&l<s.length&&s.splice(0,s.length-l),!u){for(var h=i.now(),m=0,v=1;v<s.length&&s[v]<=h;v+=2)m=v;m&&s.splice(0,m+1)}},t}(tt);function Td(e){e===void 0&&(e={});var t=e.connector,r=t===void 0?function(){return new tt}:t,n=e.resetOnError,i=n===void 0?!0:n,s=e.resetOnComplete,u=s===void 0?!0:s,l=e.resetOnRefCountZero,h=l===void 0?!0:l;return function(m){var v,g,_,O=0,D=!1,A=!1,L=function(){g==null||g.unsubscribe(),g=void 0},B=function(){L(),v=_=void 0,D=A=!1},z=function(){var V=v;B(),V==null||V.unsubscribe()};return wt(function(V,se){O++,!A&&!D&&L();var X=_=_??r();se.add(function(){O--,O===0&&!A&&!D&&(g=Ha(z,h))}),X.subscribe(se),!v&&O>0&&(v=new Fr({next:function(ee){return X.next(ee)},error:function(ee){A=!0,L(),g=Ha(B,i,ee),X.error(ee)},complete:function(){D=!0,L(),g=Ha(B,u),X.complete()}}),Nt(V).subscribe(v))})(m)}}function Ha(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(t===!0){e();return}if(t!==!1){var i=new Fr({next:function(){i.unsubscribe(),e()}});return Nt(t.apply(void 0,br([],gr(r)))).subscribe(i)}}function Bn(e,t,r){var n,i,s,u,l=!1;return e&&typeof e=="object"?(n=e.bufferSize,u=n===void 0?1/0:n,i=e.windowTime,t=i===void 0?1/0:i,s=e.refCount,l=s===void 0?!1:s,r=e.scheduler):u=e??1/0,Td({connector:function(){return new Md(u,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:l})}function jn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=$n(e);return wt(function(n,i){(r?Js(e,n,r):Js(e,n)).subscribe(i)})}function Nd(e,t){return wt(function(r,n){var i=null,s=0,u=!1,l=function(){return u&&!i&&n.complete()};r.subscribe(Dt(n,function(h){i==null||i.unsubscribe();var m=0,v=s++;Nt(e(h,v)).subscribe(i=Dt(n,function(g){return n.next(t?t(h,g,v,m++):g)},function(){i=null,l()}))},function(){u=!0,l()}))})}function Oc(e){return e.documentData?e.documentData:e.previousDocumentData}function $d(e){switch(e.operation){case"INSERT":return{operation:e.operation,id:e.documentId,doc:e.documentData,previous:null};case"UPDATE":return{operation:e.operation,id:e.documentId,doc:ge.deepFreezeWhenDevMode(e.documentData),previous:e.previousDocumentData?e.previousDocumentData:"UNKNOWN"};case"DELETE":return{operation:e.operation,id:e.documentId,doc:null,previous:e.previousDocumentData}}}function fr(e,t){return new Promise(function(r,n){var i=new Fr({next:function(s){r(s),i.unsubscribe()},error:n,complete:function(){n(new Cd)}});e.subscribe(i)})}function Ld(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=$n(e),n=wc(e,1/0),i=e;return i.length?i.length===1?Nt(i[0]):qo(n)(Ln(i,r)):Pd}function Fo(e){return e[e.length-1]}function Bd(e){const t=typeof e;return e!==null&&(t==="object"||t==="function")}function Xs(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!Bd(e)||typeof t!="string")return e;const n=t.split(".");if(n.length===0)return r;for(let i=0;i<n.length;i++){const s=n[i];if(jd(e,s)?e=i===n.length-1?void 0:null:e=e[s],e==null){if(i!==n.length-1)return r;break}}return e===void 0?r:e}function jd(e,t){if(typeof t!="number"&&Array.isArray(e)){const r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}const kc=e=>!!e.queryParams.limit,Kd=e=>e.queryParams.limit===1,qd=e=>!!(e.queryParams.skip&&e.queryParams.skip>0),Fd=e=>e.changeEvent.operation==="DELETE",Ud=e=>e.changeEvent.operation==="INSERT",Wd=e=>e.changeEvent.operation==="UPDATE",Hd=e=>kc(e)&&e.previousResults.length>=e.queryParams.limit,zd=e=>{const t=e.queryParams.sortFields,r=e.changeEvent.previous,n=e.changeEvent.doc;if(!n)return!1;if(!r)return!0;for(let i=0;i<t.length;i++){const s=t[i],u=Xs(r,s),l=Xs(n,s);if(u!==l)return!0}return!1},Qd=e=>{const t=e.changeEvent.id;if(e.keyDocumentMap)return e.keyDocumentMap.has(t);{const r=e.queryParams.primaryKey,n=e.previousResults;for(let i=0;i<n.length;i++)if(n[i][r]===t)return!0;return!1}},Vd=e=>{const t=e.previousResults[0];return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},Gd=e=>{const t=Fo(e.previousResults);return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},Yd=e=>{const t=e.changeEvent.previous;if(!t)return!1;const r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},Jd=e=>{const t=e.changeEvent.previous;if(!t)return!1;const r=Fo(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},Xd=e=>{const t=e.changeEvent.doc;if(!t)return!1;const r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},Zd=e=>{const t=e.changeEvent.doc;if(!t)return!1;const r=Fo(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},ep=e=>{const t=e.changeEvent.previous;return t?e.queryParams.queryMatcher(t):!1},tp=e=>{const t=e.changeEvent.doc;return t?e.queryParams.queryMatcher(t):!1},rp=e=>e.previousResults.length===0,np={0:Ud,1:Wd,2:Fd,3:kc,4:Kd,5:qd,6:rp,7:Hd,8:Vd,9:Gd,10:zd,11:Qd,12:Yd,13:Jd,14:Xd,15:Zd,16:ep,17:tp};function ip(e,t,r,n){var i=e.length,s=i-1,u=0;if(i===0)return e.push(t),0;for(var l;n<=s;)u=n+(s-n>>1),l=e[u],r(l,t)<=0?n=u+1:s=u-1;return r(l,t)<=0&&u++,e.splice(u,0,t),u}const ap=e=>{},Uo=e=>{e.previousResults.unshift(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},Wo=e=>{e.previousResults.push(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},Ho=e=>{const t=e.previousResults.shift();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},zo=e=>{const t=e.previousResults.pop();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},op=e=>{Ho(e),Wo(e)},sp=e=>{zo(e),Uo(e)},up=e=>{Ho(e),Uo(e)},cp=e=>{zo(e),Wo(e)},xc=e=>{e.keyDocumentMap&&e.keyDocumentMap.delete(e.changeEvent.id);const t=e.queryParams.primaryKey,r=e.previousResults;for(let n=0;n<r.length;n++)if(r[n][t]===e.changeEvent.id){r.splice(n,1);break}},lp=e=>{const t=e.changeEvent.doc,r=e.queryParams.primaryKey,n=e.previousResults;for(let i=0;i<n.length;i++)if(n[i][r]===e.changeEvent.id){n[i]=t,e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,t);break}},fp=e=>{const t={_id:"wrongHuman"+new Date().getTime()};e.previousResults.length=0,e.previousResults.push(t),e.keyDocumentMap&&(e.keyDocumentMap.clear(),e.keyDocumentMap.set(t._id,t))},Ic=e=>{const t=e.changeEvent.id,r=e.changeEvent.doc;if(e.keyDocumentMap){if(e.keyDocumentMap.has(t))return;e.keyDocumentMap.set(t,r)}else if(e.previousResults.find(i=>i[e.queryParams.primaryKey]===t))return;ip(e.previousResults,r,e.queryParams.sortComparator,0)},hp=e=>{xc(e),Ic(e)},dp=e=>{throw new Error("Action runFullQueryAgain must be implemented by yourself")},pp=e=>{throw new Error("Action unknownAction should never be called")},mp=["doNothing","insertFirst","insertLast","removeFirstItem","removeLastItem","removeFirstInsertLast","removeLastInsertFirst","removeFirstInsertFirst","removeLastInsertLast","removeExisting","replaceExisting","alwaysWrong","insertAtSortPosition","removeExistingAndInsertAtSortPosition","runFullQueryAgain","unknownAction"],vp={doNothing:ap,insertFirst:Uo,insertLast:Wo,removeFirstItem:Ho,removeLastItem:zo,removeFirstInsertLast:op,removeLastInsertFirst:sp,removeFirstInsertFirst:up,removeLastInsertLast:cp,removeExisting:xc,replaceExisting:lp,alwaysWrong:fp,insertAtSortPosition:Ic,removeExistingAndInsertAtSortPosition:hp,runFullQueryAgain:dp,unknownAction:pp},yp=40;function za(e){return e.charCodeAt(0)-yp}function gp(e){return e?"1":"0"}function Zs(e,t){const r=[];for(let n=0,i=e.length;n<i;n+=t)r.push(e.substring(n,n+t));return r}function bp(e){const t=new Map,n=2+parseInt(e.charAt(0)+e.charAt(1),10)*2,i=e.substring(2,n),s=Zs(i,2);for(let A=0;A<s.length;A++){const L=s[A],B=L.charAt(0),z=za(L.charAt(1));t.set(B,z)}const u=e.substring(n,e.length-3),l=Zs(u,4);for(let A=0;A<l.length;A++){const L=l[A],B=L.charAt(0),z=L.charAt(1),V=L.charAt(2),se=za(L.charAt(3));if(!t.has(z))throw new Error("missing node with id "+z);if(!t.has(V))throw new Error("missing node with id "+V);const X=t.get(z),ee=t.get(V),Z={l:se,0:X,1:ee};t.set(B,Z)}const h=e.slice(-3),m=h.charAt(0),v=h.charAt(1),g=za(h.charAt(2)),_=t.get(m),O=t.get(v);return{l:g,0:_,1:O}}function wp(e,t,r){let n=e,i=e.l;for(;;){const s=t[i](r),u=gp(s);if(n=n[u],typeof n=="number"||typeof n=="string")return n;i=n.l}}const _p="14a1b,c+d2e5f0g/h.i4j*k-l)m(n6oeh6pnm6qen6ril6snh6tin6ubo9vce9wmh9xns9yne9zmi9{cm9|ad9}cp9~aq9ae9¡bf9¢bq9£cg9¤ck9¥cn9¦nd9§np9¨nq9©nf9ªng9«nm9¬nk9­mr9®ms9¯mt9°mj9±mk9²ml9³mn9´mc8µ³{8¶¯}8·°¤8¸³§8¹mn8º³«8»³m8¼m´4½z²4¾³w4¿zµ4À¯¶4Á°·4Â³º4Ã³¸4Äm¹4Åv¤7Æyn7ÇÀÁ7È~7É¥¤7ÊÃÄ7Ë¨n7Ìº¹7Í­°7Î®m7Ï¯°7Ð±m7Ñ³m7Ò¼m5ÓÄm5Ô¹m5Õ½°5Ö¾m5×¿°5ØÇÏ5ÙÂm5ÚÊÑ5Û±m5Üºm5ÝÌÑ5ÞÕÍ2ß|2à¡u2á£Å2âÖÎ2ã¦Æ2ä©x2åªÆ2æ×Ø2ç|È2è¡¢2é£É2ê¤¥2ëÙÚ2ì¦Ë2í©n2îªn2ïÛÐ2ðÜÝ2ñ¬n2òÒÓ/óan/ôbn/õcn/öÞâ/÷ßã/øàä/ùáå/úæë/ûçì/üèí/ýéî/þÍÎ/ÿÏÑ/ĀòÔ,ācn,Ăöï,ă¤ñ,Ąúð,ąêñ,ĆþÐ,ćÿÑ,Ĉac0ĉbc0Ċóõ0ċôā0Čßá0čà¤0Ďçé0ďèê0Đ÷ù0đøă0Ēûý0ēüą0ĔmÒ-ĕmĀ-ĖÞæ-ėČĎ-Ęčď-ęĂĄ-ĚĐĒ-ěđē-Ĝ²»-ĝÍÏ-ĞĆć-ğ²³-ĠĔĈ3ġĕĊ3ĢĖė3ģęĚ3ĤĢĝ(ĥĜğ(ĦģĞ(ħĠġ+Ĩĉċ+ĩĤĦ+ĪĘě+īħĨ1ĬĩĪ1ĭĬī*Įĥm*ĭĮ.";let Qa;function Sp(){return Qa||(Qa=bp(_p)),Qa}const Ep=e=>wp(Sp(),np,e);function Op(e){const t=Ep(e);return mp[t]}function kp(e,t,r,n,i){const s=vp[e];return s({queryParams:t,changeEvent:r,previousResults:n,keyDocumentMap:i}),n}var Br="￿",jr=Number.MIN_SAFE_INTEGER;function xp(e,t){var r=t.selector,n=e.indexes?e.indexes.slice(0):[];t.index&&(n=[t.index]);var i=!!t.sort.find(v=>Object.values(v)[0]==="desc"),s=new Set;Object.keys(r).forEach(v=>{var g=Kr(e,v);g&&g.type==="boolean"&&Object.prototype.hasOwnProperty.call(r[v],"$eq")&&s.add(v)});var u=t.sort.map(v=>Object.keys(v)[0]),l=u.filter(v=>!s.has(v)).join(","),h=-1,m;if(n.forEach(v=>{var g=!0,_=!0,O=v.map(z=>{var V=r[z],se=V?Object.keys(V):[],X={};if(!V||!se.length){var ee=_?jr:Br;X={startKey:ee,endKey:g?Br:jr,inclusiveStart:!0,inclusiveEnd:!0}}else se.forEach(Z=>{if(Qo.has(Z)){var ue=V[Z],be=Cp(Z,ue);X=Object.assign(X,be)}});return typeof X.startKey>"u"&&(X.startKey=jr),typeof X.endKey>"u"&&(X.endKey=Br),typeof X.inclusiveStart>"u"&&(X.inclusiveStart=!0),typeof X.inclusiveEnd>"u"&&(X.inclusiveEnd=!0),_&&!X.inclusiveStart&&(_=!1),g&&!X.inclusiveEnd&&(g=!1),X}),D=O.map(z=>z.startKey),A=O.map(z=>z.endKey),L={index:v,startKeys:D,endKeys:A,inclusiveEnd:g,inclusiveStart:_,sortSatisfiedByIndex:!i&&l===v.filter(z=>!s.has(z)).join(","),selectorSatisfiedByIndex:Dp(v,t.selector,D,A)},B=Rp(e,t,L);(B>=h||t.index)&&(h=B,m=L)}),!m)throw G("SNH",{query:t});return m}var Qo=new Set(["$eq","$gt","$gte","$lt","$lte"]),Ip=new Set(["$eq","$gt","$gte"]),Pp=new Set(["$eq","$lt","$lte"]);function Dp(e,t,r,n){var i=Object.entries(t),s=i.find(([Z,ue])=>{if(!e.includes(Z))return!0;var be=Object.entries(ue).find(([xe,Ie])=>!Qo.has(xe));return be});if(s||t.$and||t.$or)return!1;var u=[],l=new Set;for(var[h,m]of Object.entries(t)){if(!e.includes(h))return!1;var v=Object.keys(m).filter(Z=>Ip.has(Z));if(v.length>1)return!1;var g=v[0];if(g&&l.add(h),g!=="$eq"){if(u.length>0)return!1;u.push(g)}}var _=[],O=new Set;for(var[D,A]of Object.entries(t)){if(!e.includes(D))return!1;var L=Object.keys(A).filter(Z=>Pp.has(Z));if(L.length>1)return!1;var B=L[0];if(B&&O.add(D),B!=="$eq"){if(_.length>0)return!1;_.push(B)}}var z=0;for(var V of e){for(var se of[l,O]){if(!se.has(V)&&se.size>0)return!1;se.delete(V)}var X=r[z],ee=n[z];if(X!==ee&&l.size>0&&O.size>0)return!1;z++}return!0}function Cp(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}function Rp(e,t,r){var n=0,i=v=>{v>0&&(n=n+v)},s=10,u=ja(r.startKeys,v=>v!==jr&&v!==Br);i(u*s);var l=ja(r.startKeys,v=>v!==Br&&v!==jr);i(l*s);var h=ja(r.startKeys,(v,g)=>v===r.endKeys[g]);i(h*s*1.5);var m=r.sortSatisfiedByIndex?5:0;return i(m),n}class Or extends Error{}const Ap=2147483647,Mp=-2147483648,Tp=Number.MAX_SAFE_INTEGER,Np=Number.MIN_SAFE_INTEGER,Rt=Symbol("missing"),Pc=Object.freeze(new Error("mingo: cycle detected while processing object/array")),$p="[object Object]",Lp=/^\[object ([a-zA-Z0-9]+)\]$/,Kn=e=>{const t=Up(e);let r=0,n=t.length;for(;n;)r=(r<<5)-r^t.charCodeAt(--n);return r>>>0},Dc=new Set(["null","undefined","boolean","number","string","date","regexp"]),Bp={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8},Ge=(e,t)=>{e===Rt&&(e=void 0),t===Rt&&(t=void 0);const[r,n]=[e,t].map(i=>Bp[In(i).toLowerCase()]);return r!==n?r-n:r===1||r===2||r===6?e<t?-1:e>t?1:0:bt(e,t)?0:e<t?-1:e>t?1:0};function Ae(e,t){if(!e)throw new Or(t)}const In=e=>Lp.exec(Object.prototype.toString.call(e))[1],Va=e=>typeof e=="boolean",At=e=>typeof e=="string",et=e=>!isNaN(e)&&typeof e=="number",Me=Array.isArray,Oe=e=>{if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===Object.prototype||t===null)&&$p===Object.prototype.toString.call(e)},Vi=e=>e===Object(e),Ai=e=>e instanceof Date,yn=e=>e instanceof RegExp,Vo=e=>typeof e=="function",Ke=e=>e==null,Ur=(e,t)=>e.includes(t),Cc=(e,t)=>!Ur(e,t),Wr=(e,t=!0)=>!!e||t&&e==="",Vr=e=>Ke(e)||At(e)&&!e||e instanceof Array&&e.length===0||Oe(e)&&Object.keys(e).length===0,eu=e=>e===Rt,Gr=e=>e instanceof Array?e:[e],rt=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),Go=e=>typeof ArrayBuffer<"u"&&ArrayBuffer.isView(e),jp=[Ai,yn,Go],lo=(e,t)=>{if(Ke(e))return e;if(t.has(e))throw Pc;const r=e.constructor;if(jp.some(n=>n(e)))return new r(e);try{if(t.add(e),Me(e))return e.map(n=>lo(n,t));if(Oe(e)){const n={};for(const i in e)n[i]=lo(e[i],t);return n}}finally{t.delete(e)}return e},fo=e=>lo(e,new Set),Kp=(e,t)=>Oe(e)&&Oe(t)||Me(e)&&Me(t);function ho(e,t,r){if(r=r||{flatten:!1},eu(e)||Ke(e))return t;if(eu(t)||Ke(t))return e;if(!Kp(e,t)){if(r.skipValidation)return t||e;throw Error("mismatched types. must both be array or object")}if(r.skipValidation=!0,Me(e)){const n=e,i=t;if(r.flatten){let s=0,u=0;for(;s<n.length&&u<i.length;)n[s]=ho(n[s++],i[u++],r);for(;u<i.length;)n.push(t[u++])}else qn(n,i)}else for(const n in t)e[n]=ho(e[n],t[n],r);return e}function po(e,t=Kn){const r=new Map;return e.forEach((n,i)=>{const s=Ac(n,t);r.has(s)?r.get(s).some(u=>bt(e[u],n))||r.get(s).push(i):r.set(s,[i])}),r}function Yo(e,t=Kn){if(e.some(l=>l.length==0))return[];if(e.length===1)return Array.from(e);const r=Wp(e.map((l,h)=>[h,l.length]),l=>l[1]),n=e[r[0][0]],i=po(n,t),s=new Map,u=new Array;return i.forEach((l,h)=>{const m=l.map(O=>n[O]),v=m.map(O=>0),g=m.map(O=>[r[0][0],0]);let _=!1;for(let O=1;O<e.length;O++){const[D,A]=r[O],L=e[D];if(s.has(O)||s.set(O,po(L)),s.get(O).has(h)){const B=s.get(O).get(h).map(z=>L[z]);_=m.map((z,V)=>B.some((se,X)=>{const ee=v[V];return bt(z,se)&&(v[V]++,D<g[V][0]&&(g[V]=[D,s.get(O).get(h)[X]])),ee<v[V]})).some(Boolean)}if(!_)return}_&&qn(u,v.map((O,D)=>O===e.length-1?[m[D],g[D]]:Rt).filter(O=>O!==Rt))}),u.sort((l,h)=>{const[m,[v,g]]=l,[_,[O,D]]=h,A=Ge(v,O);return A!==0?A:Ge(g,D)}).map(l=>l[0])}function Rc(e,t=0){const r=new Array;function n(i,s){for(let u=0,l=i.length;u<l;u++)Me(i[u])&&(s>0||s<0)?n(i[u],Math.max(-1,s-1)):r.push(i[u])}return n(e,t),r}const qp=e=>{let[t,r]=[Object.getPrototypeOf(e),Object.getOwnPropertyNames(e)],n=t;for(;!r.length&&t!==Object.prototype&&t!==Array.prototype;)n=t,r=Object.getOwnPropertyNames(t),t=Object.getPrototypeOf(t);const i={};return r.forEach(s=>i[s]=e[s]),[i,n]};function bt(e,t){if(e===t||Object.is(e,t))return!0;const r=!!e&&e.constructor||e;if(e===null||t===null||e===void 0||t===void 0||r!==t.constructor||r===Function)return!1;if(r===Array||r===Object){const s=Object.keys(e),u=Object.keys(t);if(s.length!==u.length||new Set([...s,...u]).size!=s.length)return!1;for(const l of s)if(!bt(e[l],t[l]))return!1;return!0}const n=Object.getPrototypeOf(e);return(Go(e)||n!==Object.prototype&&n!==Array.prototype&&Object.prototype.hasOwnProperty.call(n,"toString"))&&e.toString()===t.toString()}function Fp(e,t=Kn){const r=e.map(n=>Rt);return po(e,t).forEach((n,i)=>{n.forEach(s=>r[s]=e[s])}),r.filter(n=>n!==Rt)}const Oi=(e,t)=>{if(e===null)return"null";if(e===void 0)return"undefined";const r=e.constructor;switch(r){case RegExp:case Number:case Boolean:case Function:case Symbol:return e.toString();case String:return JSON.stringify(e);case Date:return e.toISOString()}if(Go(e))return r.name+"["+e.toString()+"]";if(t.has(e))throw Pc;try{if(t.add(e),Me(e))return"["+e.map(u=>Oi(u,t)).join(",")+"]";if(r===Object)return"{"+Object.keys(e).sort().map(u=>u+":"+Oi(e[u],t)).join(",")+"}";const n=Object.getPrototypeOf(e);if(n!==Object.prototype&&n!==Array.prototype&&Object.prototype.hasOwnProperty.call(n,"toString"))return r.name+"("+JSON.stringify(e.toString())+")";const[i,s]=qp(e);return r.name+Oi(i,t)}finally{t.delete(e)}},Up=e=>Oi(e,new Set);function Ac(e,t){return t=t||Kn,Ke(e)?null:t(e).toString()}function Wp(e,t,r=Ge){if(Vr(e))return e;const n=new Array,i=new Array;for(let s=0;s<e.length;s++){const u=e[s],l=t(u,s);Ke(l)?i.push(u):n.push([l,u])}return n.sort((s,u)=>r(s[0],u[0])),qn(i,n.map(s=>s[1]))}function Hp(e,t,r=Kn){if(e.length<1)return new Map;const n=new Map,i=new Map;for(let s=0;s<e.length;s++){const u=e[s],l=t(u,s),h=Ac(l,r);if(h===null)i.has(null)?i.get(null).push(u):i.set(null,[u]);else{const m=n.has(h)?n.get(h).find(v=>bt(v,l)):null;Ke(m)?(i.set(l,[u]),n.has(h)?n.get(h).push(l):n.set(h,[l])):i.get(m).push(u)}}return i}const Ga=5e4;function qn(e,...t){return e instanceof Array?t.reduce((r,n)=>{let i=Math.ceil(n.length/Ga),s=0;for(;i-- >0;)Array.prototype.push.apply(r,n.slice(s,s+Ga)),s+=Ga;return r},e):t.filter(Vi).reduce((r,n)=>(Object.assign(r,n),r),e)}function mo(e,t){return Vi(e)?e[t]:void 0}function zp(e,t){if(t<1)return e;for(;t--&&e.length===1;)e=e[0];return e}function Yr(e,t,r){let n=0;function i(u,l){let h=u;for(let m=0;m<l.length;m++){const v=l[m];if(/^\d+$/.exec(v)===null&&h instanceof Array){if(m===0&&n>0)break;n+=1;const _=l.slice(m);h=h.reduce((O,D)=>{const A=i(D,_);return A!==void 0&&O.push(A),O},[]);break}else h=mo(h,v);if(h===void 0)break}return h}const s=Dc.has(In(e).toLowerCase())?e:i(e,t.split("."));return s instanceof Array&&(r!=null&&r.unwrapArray)?zp(s,n):s}function ki(e,t,r){const n=t.split("."),i=n[0],s=n.slice(1).join("."),u=/^\d+$/.exec(i)!==null,l=n.length>1;let h,m;if(e instanceof Array)if(u)h=mo(e,Number(i)),l&&(h=ki(h,s,r)),h=[h];else{h=[];for(const v of e)m=ki(v,t,r),r!=null&&r.preserveMissing?(m===void 0&&(m=Rt),h.push(m)):m!==void 0&&h.push(m)}else{if(m=mo(e,i),l&&(m=ki(m,s,r)),m===void 0)return;h=r!=null&&r.preserveKeys?{...e}:{},h[i]=m}return h}function vo(e){if(e instanceof Array)for(let t=e.length-1;t>=0;t--)e[t]===Rt?e.splice(t,1):vo(e[t]);else if(Oe(e))for(const t in e)rt(e,t)&&vo(e[t])}const tu=/^\d+$/;function Pn(e,t,r,n){const i=t.split("."),s=i[0],u=i.slice(1).join(".");if(i.length===1)(Oe(e)||Me(e)&&tu.test(s))&&r(e,s);else{n!=null&&n.buildGraph&&Ke(e[s])&&(e[s]={});const l=e[s];if(!l)return;const h=!!(i.length>1&&tu.test(i[1]));l instanceof Array&&(n!=null&&n.descendArray)&&!h?l.forEach(m=>Pn(m,u,r,n)):Pn(l,u,r,n)}}function Qp(e,t,r){Pn(e,t,(n,i)=>{n[i]=Vo(r)?r(n[i]):r},{buildGraph:!0})}function ru(e,t,r){Pn(e,t,(n,i)=>{if(n instanceof Array){if(/^\d+$/.test(i))n.splice(parseInt(i),1);else if(r&&r.descendArray)for(const s of n)Oe(s)&&delete s[i]}else Oe(n)&&delete n[i]},r)}const Vp=/^\$[a-zA-Z0-9_]+$/;function kr(e){return Vp.test(e)}function Mc(e){if(Dc.has(In(e).toLowerCase()))return yn(e)?{$regex:e}:{$eq:e};if(Vi(e)){if(!Object.keys(e).some(kr))return{$eq:e};if(rt(e,"$regex")){const r={...e};return r.$regex=new RegExp(e.$regex,e.$options),delete r.$options,r}}return e}var mn=(e=>(e.CLONE_ALL="CLONE_ALL",e.CLONE_INPUT="CLONE_INPUT",e.CLONE_OUTPUT="CLONE_OUTPUT",e.CLONE_OFF="CLONE_OFF",e))(mn||{});class hr{constructor(t,r,n,i=Date.now()){this._opts=t,this._root=r,this._local=n,this.timestamp=i,this.update(r,n)}static init(t,r,n){return t instanceof hr?new hr(t._opts,Ke(t.root)?r:t.root,Object.assign({},t.local,n)):new hr(t,r,n)}update(t,r){var n;return this._root=t,this._local=r&&Object.assign({},r,{variables:Object.assign({},(n=this._local)==null?void 0:n.variables,r==null?void 0:r.variables)}),this}getOptions(){return Object.freeze({...this._opts,context:wr.from(this._opts.context)})}get root(){return this._root}get local(){return this._local}get idKey(){return this._opts.idKey}get collation(){var t;return(t=this._opts)==null?void 0:t.collation}get processingMode(){var t;return((t=this._opts)==null?void 0:t.processingMode)||"CLONE_OFF"}get useStrictMode(){var t;return(t=this._opts)==null?void 0:t.useStrictMode}get scriptEnabled(){var t;return(t=this._opts)==null?void 0:t.scriptEnabled}get useGlobalContext(){var t;return(t=this._opts)==null?void 0:t.useGlobalContext}get hashFunction(){var t;return(t=this._opts)==null?void 0:t.hashFunction}get collectionResolver(){var t;return(t=this._opts)==null?void 0:t.collectionResolver}get jsonSchemaValidator(){var t;return(t=this._opts)==null?void 0:t.jsonSchemaValidator}get variables(){var t;return(t=this._opts)==null?void 0:t.variables}get context(){var t;return(t=this._opts)==null?void 0:t.context}}function Mi(e){return e instanceof hr?e.getOptions():Object.freeze({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:"CLONE_OFF",...e,context:e!=null&&e.context?wr.from(e==null?void 0:e.context):wr.init({})})}var Hr=(e=>(e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window",e))(Hr||{});class wr{constructor(t){this.operators={accumulator:{},expression:{},pipeline:{},projection:{},query:{},window:{}};for(const[r,n]of Object.entries(t))this.addOperators(r,n)}static init(t={}){return new wr(t)}static from(t){return new wr(t.operators)}addOperators(t,r){for(const[n,i]of Object.entries(r))this.getOperator(t,n)||(this.operators[t][n]=i);return this}addAccumulatorOps(t){return this.addOperators("accumulator",t)}addExpressionOps(t){return this.addOperators("expression",t)}addQueryOps(t){return this.addOperators("query",t)}addPipelineOps(t){return this.addOperators("pipeline",t)}addProjectionOps(t){return this.addOperators("projection",t)}addWindowOps(t){return this.addOperators("window",t)}getOperator(t,r){return t in this.operators&&this.operators[t][r]||null}}const ur=wr.init();function nu(e,t){for(const[r,n]of Object.entries(t)){Ae(Vo(n)&&kr(r),`'${r}' is not a valid operator`);const i=dr(e,r,null);Ae(!i||n===i,`${r} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case"accumulator":ur.addAccumulatorOps(t);break;case"expression":ur.addExpressionOps(t);break;case"pipeline":ur.addPipelineOps(t);break;case"projection":ur.addProjectionOps(t);break;case"query":ur.addQueryOps(t);break;case"window":ur.addWindowOps(t);break}}function dr(e,t,r){const{context:n,useGlobalContext:i}=r||{},s=n?n.getOperator(e,t):null;return!s&&i?ur.getOperator(e,t):s}const iu={$$ROOT(e,t,r){return r.root},$$CURRENT(e,t,r){return e},$$REMOVE(e,t,r){},$$NOW(e,t,r){return new Date(r.timestamp)}},yo={$$KEEP(e,t,r){return e},$$PRUNE(e,t,r){},$$DESCEND(e,t,r){if(!rt(t,"$cond"))return e;let n;for(const[i,s]of Object.entries(e))if(Vi(s)){if(s instanceof Array){const u=[];for(let l of s)Oe(l)&&(l=au(l,t,r.update(l))),Ke(l)||u.push(l);n=u}else n=au(s,t,r.update(s));Ke(n)?delete e[i]:e[i]=n}return e}};function We(e,t,r,n){var s;const i=hr.init(n,e);if(r=r||"",kr(r)){const u=dr("expression",r,n);if(u)return u(e,t,i);const l=dr("accumulator",r,n);if(l)return e instanceof Array||(e=We(e,t,null,i),t=null),Ae(e instanceof Array,`'${r}' target must be an array.`),l(e,t,i.update(null,i.local));throw new Or(`operator '${r}' is not registered`)}if(At(t)&&t.length>0&&t[0]==="$"){if(rt(yo,t))return t;let u=i.root;const l=t.split(".");if(rt(iu,l[0]))u=iu[l[0]](e,null,i),t=t.slice(l[0].length+1);else if(l[0].slice(0,2)==="$$"){u=Object.assign({},i.variables,{this:e},(s=i.local)==null?void 0:s.variables);const h=l[0].slice(2);Ae(rt(u,h),`Use of undefined variable: ${h}`),t=t.slice(2)}else t=t.slice(1);return t===""?u:Yr(u,t)}if(Me(t))return t.map(u=>We(e,u,null,i));if(Oe(t)){const u={};for(const[l,h]of Object.entries(t))if(u[l]=We(e,h,l,i),["expression","accumulator"].some(m=>!!dr(m,l,n)))return Ae(Object.keys(t).length===1,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),u[l];return u}return t}function au(e,t,r){const n=We(e,t,null,r);return rt(yo,n)?yo[n](e,t,r):n}function zr(e){return e instanceof ou?e:new ou(e)}function Gp(...e){let t=0;return zr(()=>{for(;t<e.length;){const r=e[t].next();if(!r.done)return r;t++}return{done:!0}})}function Yp(e){return!!e&&typeof e=="object"&&(e==null?void 0:e.next)instanceof Function}function Jp(e,t){const r=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,r)}const go=new Error;function Xp(e,t,r){let n=!1,i=-1,s=0;return function(u){try{e:for(;!n;){let l=e();i++;let h=-1;const m=t.length;let v=!1;for(;++h<m;){const g=t[h];switch(g.action){case 0:l=g.func(l,i);break;case 1:if(!g.func(l,i))continue e;break;case 2:--g.count,g.count||(v=!0);break;case 3:--g.count,g.count||Jp(t,h);continue e;default:break e}}if(n=v,u)r[s++]=l;else return{value:l,done:!1}}}catch(l){if(l!==go)throw l}return n=!0,{done:n}}}let ou=class{constructor(t){this.iteratees=[],this.yieldedValues=[],this.isDone=!1;let r;if(t instanceof Function&&(t={next:t}),Yp(t)){const n=t;r=()=>{const i=n.next();if(i.done)throw go;return i.value}}else if(t instanceof Array){const n=t,i=n.length;let s=0;r=()=>{if(s<i)return n[s++];throw go}}else if(!(t instanceof Function))throw new Or("Lazy must be initialized with an array, generator, or function.");this.getNext=Xp(r,this.iteratees,this.yieldedValues)}push(t,r){return typeof r=="function"?this.iteratees.push({action:t,func:r}):typeof r=="number"&&this.iteratees.push({action:t,count:r}),this}next(){return this.getNext()}map(t){return this.push(0,t)}filter(t){return this.push(1,t)}take(t){return t>0?this.push(2,t):this}drop(t){return t>0?this.push(3,t):this}transform(t){const r=this;let n;return zr(()=>(n||(n=zr(t(r.value()))),n.next()))}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(t){for(;;){const r=this.next();if(r.done)break;if(t(r.value)===!1)return!1}return!0}reduce(t,r){let n=this.next();for(r===void 0&&!n.done&&(r=n.value,n=this.next());!n.done;)r=t(r,n.value),n=this.next();return r}size(){return this.reduce((t,r)=>++t,0)}[Symbol.iterator](){return this}};class Zp{constructor(t,r){this.pipeline=t,this.options=Mi(r)}stream(t){let r=zr(t);const n=this.options.processingMode;(n==mn.CLONE_ALL||n==mn.CLONE_INPUT)&&r.map(fo);const i=new Array;if(!Vr(this.pipeline))for(const s of this.pipeline){const u=Object.keys(s),l=u[0],h=dr(Hr.PIPELINE,l,this.options);Ae(u.length===1&&!!h,`invalid pipeline operator ${l}`),i.push(l),r=h(r,s[l],this.options)}return(n==mn.CLONE_OUTPUT||n==mn.CLONE_ALL&&Yo([["$group","$unwind"],i]).length)&&r.map(fo),r}run(t){return this.stream(t).value()}}class em{constructor(t,r,n,i){this.source=t,this.predicate=r,this.projection=n,this.options=i,this.operators=[],this.result=null,this.buffer=[]}fetch(){return this.result?this.result:(Oe(this.projection)&&this.operators.push({$project:this.projection}),this.result=zr(this.source).filter(this.predicate),this.operators.length>0&&(this.result=new Zp(this.operators,this.options).stream(this.result)),this.result)}fetchAll(){const t=zr([...this.buffer]);return this.buffer=[],Gp(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.operators.push({$skip:t}),this}limit(t){return this.operators.push({$limit:t}),this}sort(t){return this.operators.push({$sort:t}),this}collation(t){return this.options={...this.options,collation:t},this}next(){if(this.buffer.length>0)return this.buffer.pop();const t=this.fetch().next();if(!t.done)return t.value}hasNext(){if(this.buffer.length>0)return!0;const t=this.fetch().next();return t.done?!1:(this.buffer.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}}class Mt{constructor(t,r){this.condition=t,this.options=Mi(r),this.compiled=[],this.compile()}compile(){Ae(Oe(this.condition),`query criteria must be an object: ${JSON.stringify(this.condition)}`);const t={};for(const[r,n]of Object.entries(this.condition)){if(r==="$where")Object.assign(t,{field:r,expr:n});else if(Ur(["$and","$or","$nor","$expr","$jsonSchema"],r))this.processOperator(r,r,n);else{Ae(!kr(r),`unknown top level operator: ${r}`);for(const[i,s]of Object.entries(Mc(n)))this.processOperator(r,i,s)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,r,n){const i=dr(Hr.QUERY,r,this.options);if(!i)throw new Or(`unknown query operator ${r}`);const s=i(t,n,this.options);this.compiled.push(s)}test(t){for(let r=0,n=this.compiled.length;r<n;r++)if(!this.compiled[r](t))return!1;return!0}find(t,r){return new em(t,n=>this.test(n),r||{},this.options)}remove(t){return t.reduce((r,n)=>(this.test(n)||r.push(n),r),[])}}const tm=(e,t,r)=>{if(Vr(t)||!Oe(t))return e;let n=Ge;const i=r.collation;return Oe(i)&&At(i.locale)&&(n=nm(i)),e.transform(s=>{const u=Object.keys(t);for(const l of u.reverse()){const h=Hp(s,v=>Yr(v,l),r.hashFunction),m=Array.from(h.keys()).sort(n);t[l]===-1&&m.reverse(),s=[],m.reduce((v,g)=>qn(v,h.get(g)),s)}return s})},rm={1:"base",2:"accent",3:"variant"};function nm(e){const t={sensitivity:rm[e.strength||3],caseFirst:e.caseFirst==="off"?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:e.alternate==="shifted"};(e.caseLevel||!1)===!0&&(t.sensitivity==="base"&&(t.sensitivity="case"),t.sensitivity==="accent"&&(t.sensitivity="variant"));const r=new Intl.Collator(e.locale,t);return(n,i)=>{if(!At(n)||!At(i))return Ge(n,i);const s=r.compare(n,i);return s<0?-1:s>0?1:0}}function He(e){const t=(r,n,i)=>{const s={unwrapArray:!0},u=Math.max(1,r.split(".").length-1);return l=>{const h=Yr(l,r,s);return e(h,n,{...i,depth:u})}};return t.op="query",t}function Jr(e){return(t,r,n)=>{const i=We(t,r,null,n);return e(...i)}}function Jo(e,t,r){if(bt(e,t)||Ke(e)&&Ke(t))return!0;if(e instanceof Array){const n=bt.bind(null,t);return e.some(n)||Rc(e,r==null?void 0:r.depth).some(n)}return!1}function Tc(e,t,r){return!Jo(e,t,r)}function Nc(e,t,r){return Ke(e)?t.some(n=>n===null):Yo([Gr(e),t],r==null?void 0:r.hashFunction).length>0}function im(e,t,r){return!Nc(e,t,r)}function $c(e,t,r){return Gi(e,t,(n,i)=>Ge(n,i)<0)}function Lc(e,t,r){return Gi(e,t,(n,i)=>Ge(n,i)<=0)}function Bc(e,t,r){return Gi(e,t,(n,i)=>Ge(n,i)>0)}function jc(e,t,r){return Gi(e,t,(n,i)=>Ge(n,i)>=0)}function am(e,t,r){return Gr(e).some(n=>t.length===2&&n%t[0]===t[1])}function om(e,t,r){const n=Gr(e),i=s=>At(s)&&Wr(t.exec(s),r==null?void 0:r.useStrictMode);return n.some(i)||Rc(n,1).some(i)}function sm(e,t,r){return(t===!1||t===0)&&e===void 0||(t===!0||t===1)&&e!==void 0}function um(e,t,r){if(!Me(e)||!Me(t)||!e.length||!t.length)return!1;let n=!0;for(const i of t){if(!n)break;Oe(i)&&Ur(Object.keys(i),"$elemMatch")?n=Kc(e,i.$elemMatch,r):i instanceof RegExp?n=e.some(s=>typeof s=="string"&&i.test(s)):n=e.some(s=>bt(i,s))}return n}function cm(e,t,r){return Array.isArray(e)&&e.length===t}function lm(e){return kr(e)&&["$and","$or","$nor"].indexOf(e)===-1}function Kc(e,t,r){if(Me(e)&&!Vr(e)){let n=u=>u,i=t;Object.keys(t).every(lm)&&(i={temp:t},n=u=>({temp:u}));const s=new Mt(i,r);for(let u=0,l=e.length;u<l;u++)if(s.test(n(e[u])))return!0}return!1}const su=e=>e===null,uu=e=>et(e)&&e>=Mp&&e<=Ap&&e.toString().indexOf(".")===-1,cu=e=>et(e)&&e>=Np&&e<=Tp&&e.toString().indexOf(".")===-1,fm={array:Me,bool:Va,boolean:Va,date:Ai,decimal:et,double:et,int:uu,long:cu,number:et,null:su,object:Oe,regex:yn,regexp:yn,string:At,undefined:Ke,function:e=>{throw new Or("unsupported type key `function`.")},1:et,2:At,3:Oe,4:Me,6:Ke,8:Va,9:Ai,10:su,11:yn,16:uu,18:cu,19:et};function lu(e,t,r){const n=fm[t];return n?n(e):!1}function hm(e,t,r){return Array.isArray(t)?t.findIndex(n=>lu(e,n))>=0:lu(e,t)}function Gi(e,t,r){return Gr(e).some(n=>In(n)===In(t)&&r(n,t))}const dm=(e,t,r)=>{const n=We(e,t,null,r);return Wr(n,r.useStrictMode)&&n.every(i=>Wr(i,r.useStrictMode))},pm=(e,t,r)=>{const n=Gr(t);if(n.length==0)return!1;if(n.length==1)return!We(e,n[0],null,r);throw"Expression $not takes exactly 1 argument"},mm=(e,t,r)=>{const n=We(e,t,null,r),i=r.useStrictMode;return Wr(n,i)&&n.some(s=>Wr(s,i))},vm=Object.freeze(Object.defineProperty({__proto__:null,$and:dm,$not:pm,$or:mm},Symbol.toStringTag,{value:"Module"})),ym=(e,t,r)=>{const n=We(e,t,null,r);return n[0]>n[1]?1:n[0]<n[1]?-1:0},gm=Jr(Jo),bm=Jr(Bc),wm=Jr(jc),_m=Jr($c),Sm=Jr(Lc),Em=Jr(Tc),Om=Object.freeze(Object.defineProperty({__proto__:null,$cmp:ym,$eq:gm,$gt:bm,$gte:wm,$lt:_m,$lte:Sm,$ne:Em},Symbol.toStringTag,{value:"Module"})),fu=(e,t)=>{const r={};return e.split("").forEach((n,i)=>r[n]=t*(i+1)),r};({...fu("ABCDEFGHIKLM",1),...fu("NOPQRSTUVWXY",-1)});const hu={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function ot(e,t=hu){const r=Object.assign({},hu,t),n=new Set(Object.keys(r));return(i,s,u)=>{const l=We(i,s,null,u);if(n.has(`${l}`)){const h=r[`${l}`];if(h instanceof Error)throw new Or(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return h}return e(l)}}ot(Math.acos,{Infinity:1/0,0:new Error});ot(Math.acosh,{Infinity:1/0,0:new Error});ot(Math.asin);ot(Math.asinh,{Infinity:1/0,"-Infinity":-1/0});ot(Math.atan);ot(Math.atanh,{1:1/0,"-1":-1/0});ot(Math.cos);ot(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const km=Math.PI/180;ot(e=>e*km,{Infinity:1/0,"-Infinity":1/0});const xm=180/Math.PI;ot(e=>e*xm,{Infinity:1/0,"-Infinity":-1/0});ot(Math.sin);ot(Math.sinh,{"-Infinity":-1/0,Infinity:1/0});ot(Math.tan);const Im=(e,t,r)=>{if(Vr(t))return e;let n=Object.keys(t),i=!1;qc(t,r);const s=r.idKey;if(Ur(n,s)){const l=t[s];(l===0||l===!1)&&(n=n.filter(Cc.bind(null,[s])),i=n.length==0)}else n.push(s);const u=hr.init(r);return e.map(l=>bo(l,t,u.update(l),n,i))};function bo(e,t,r,n,i){let s={},u=!1,l=!1;const h=[];i&&h.push(r.idKey);for(const m of n){let v;const g=t[m];if(m!==r.idKey&&Ur([0,!1],g)&&(l=!0),m===r.idKey&&Vr(g))v=e[m];else if(At(g))v=We(e,g,m,r);else if(!Ur([1,!0],g))if(g instanceof Array)v=g.map(O=>{const D=We(e,O,null,r);return Ke(D)?null:D});else if(Oe(g)){const O=g,D=Object.keys(g),A=D.length==1?D[0]:"",L=dr(Hr.PROJECTION,A,r);if(L)A==="$slice"?Gr(O[A]).every(et)?(v=L(e,O[A],m,r),u=!0):v=We(e,O,m,r):v=L(e,O[A],m,r);else if(kr(A))v=We(e,O[A],A,r);else if(rt(e,m)){qc(O,r);let B=e[m];B instanceof Array?v=B.map(z=>bo(z,O,r,D,!1)):(B=Oe(B)?B:e,v=bo(B,O,r,D,!1))}else v=We(e,g,null,r)}else{h.push(m);continue}const _=ki(e,m,{preserveMissing:!0});_!==void 0&&ho(s,_,{flatten:!0}),Cc([0,1,!1,!0],g)&&(v===void 0?ru(s,m,{descendArray:!0}):Qp(s,m,v))}if(vo(s),(u||l||i)&&(s=qn({},e,s),h.length>0))for(const m of h)ru(s,m,{descendArray:!0});return s}function qc(e,t){const r=[!1,!1];for(const[n,i]of Object.entries(e)){if(n===(t==null?void 0:t.idKey))return;i===0||i===!1?r[0]=!0:(i===1||i===!0)&&(r[1]=!0),Ae(!(r[0]&&r[1]),"Projection cannot have a mix of inclusion and exclusion.")}}const Fc=(e,t,r)=>{Ae(Me(t),"Invalid expression: $and expects value to be an Array.");const n=t.map(i=>new Mt(i,r));return i=>n.every(s=>s.test(i))},Xo=(e,t,r)=>{Ae(Me(t),"Invalid expression. $or expects value to be an Array");const n=t.map(i=>new Mt(i,r));return i=>n.some(s=>s.test(i))},Uc=(e,t,r)=>{Ae(Me(t),"Invalid expression. $nor expects value to be an array.");const n=Xo("$or",t,r);return i=>!n(i)},Wc=(e,t,r)=>{const n={};n[e]=Mc(t);const i=new Mt(n,r);return s=>!i.test(s)},Hc=He(Jo),zc=He(Bc),Qc=He(jc),Vc=He(Nc),Gc=He($c),Yc=He(Lc),Jc=He(Tc),Xc=He(im);function Pm(e,t,r){return n=>We(n,t,null,r)}function Dm(e,t,r){if(!(r!=null&&r.jsonSchemaValidator))throw new Or("Missing option 'jsonSchemaValidator'. Configure to use '$jsonSchema' operator.");const n=r==null?void 0:r.jsonSchemaValidator(t);return i=>n(i)}const Zc=He(am),el=He(om);function Cm(e,t,r){Ae(r.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true");const n=t;return Ae(Vo(n),"$where only accepts a Function object"),i=>Wr(n.call(i),r==null?void 0:r.useStrictMode)}const Rm=He(um),tl=He(Kc),rl=He(cm),nl=He(sm),il=He(hm);var du=!1;function Am(e){return du||(nu(Hr.PIPELINE,{$sort:tm,$project:Im}),nu(Hr.QUERY,{$and:Fc,$eq:Hc,$elemMatch:tl,$exists:nl,$gt:zc,$gte:Qc,$in:Vc,$lt:Gc,$lte:Yc,$ne:Jc,$nin:Xc,$mod:Zc,$nor:Uc,$not:Wc,$or:Xo,$regex:el,$size:rl,$type:il}),du=!0),new Mt(e)}function Dn(e,t){var r=at(e.primaryKey);t=Se(t);var n=Qe(t);if(typeof n.skip!="number"&&(n.skip=0),n.selector?(n.selector=n.selector,Object.entries(n.selector).forEach(([m,v])=>{(typeof v!="object"||v===null)&&(n.selector[m]={$eq:v})})):n.selector={},n.index){var i=Ro(n.index);i.includes(r)||i.push(r),n.index=i}if(n.sort){var h=n.sort.find(m=>Qf(m)===r);h||(n.sort=n.sort.slice(0),n.sort.push({[r]:"asc"}))}else if(n.index)n.sort=n.index.map(m=>({[m]:"asc"}));else{if(e.indexes){var s=new Set;Object.entries(n.selector).forEach(([m,v])=>{var g=!1;typeof v=="object"&&v!==null?g=!!Object.keys(v).find(_=>Qo.has(_)):g=!0,g&&s.add(m)});var u=-1,l;e.indexes.forEach(m=>{var v=Ao(m)?m:[m],g=v.findIndex(_=>!s.has(_));g>0&&g>u&&(u=g,l=v)}),l&&(n.sort=l.map(m=>({[m]:"asc"})))}n.sort||(n.sort=[{[r]:"asc"}])}return n}function al(e,t){if(!t.sort)throw G("SNH",{query:t});var r=[];t.sort.forEach(i=>{var s=Object.keys(i)[0],u=Object.values(i)[0];r.push({key:s,direction:u,getValueFn:zf(s)})});var n=(i,s)=>{for(var u=0;u<r.length;++u){var l=r[u],h=l.getValueFn(i),m=l.getValueFn(s);if(h!==m){var v=l.direction==="asc"?Ge(h,m):Ge(m,h);return v}}};return n}function Zo(e,t){if(!t.sort)throw G("SNH",{query:t});var r=Am(t.selector),n=i=>r.test(i);return n}async function Tr(e,t){var r=await e.exec();if(!r)return null;if(Array.isArray(r))return Promise.all(r.map(i=>t(i)));if(r instanceof Map)return Promise.all([...r.values()].map(i=>t(i)));var n=await t(r);return n}function Mm(e,t){return!t.sort||t.sort.length===0?[e]:t.sort.map(r=>Object.keys(r)[0])}var Tm=new WeakMap;function Nm(e){return Pt(Tm,e,()=>{var t=e.collection,r=Dn(t.storageInstance.schema,Qe(e.mangoQuery)),n=t.schema.primaryPath,i=al(t.schema.jsonSchema,r),s=(m,v)=>{var g={docA:m,docB:v};return i(g.docA,g.docB)},u=Zo(t.schema.jsonSchema,r),l=m=>{var v={doc:m};return u(v.doc)},h={primaryKey:e.collection.schema.primaryPath,skip:r.skip,limit:r.limit,sortFields:Mm(n,r),sortComparator:s,queryMatcher:l};return h})}function $m(e,t){if(!e.collection.database.eventReduce)return{runFullQueryAgain:!0};var r=Nm(e),n=ae(e._result).docsData.slice(0),i=ae(e._result).docsDataMap,s=!1,u=t.map(h=>$d(h)).filter(Wf),l=u.find(h=>{var m={queryParams:r,changeEvent:h,previousResults:n,keyDocumentMap:i},v=Op(m);if(v==="runFullQueryAgain")return!0;if(v!=="doNothing")return s=!0,kp(v,r,h,n,i),!1});return l?{runFullQueryAgain:!0}:{runFullQueryAgain:!1,changed:s,newResults:n}}var Lm=function(){function e(){this._map=new Map}var t=e.prototype;return t.getByQuery=function(n){var i=n.toString();return Pt(this._map,i,()=>n)},e}();function Bm(){return new Lm}function pu(e,t){t.uncached=!0;var r=t.toString();e._map.delete(r)}function jm(e){return e.refCount$.observers.length}var Km=100,qm=30*1e3,Fm=(e,t)=>(r,n)=>{if(!(n._map.size<e)){var i=je()-t,s=[],u=Array.from(n._map.values());for(var l of u)if(!(jm(l)>0)){if(l._lastEnsureEqual===0&&l._creationTime<i){pu(n,l);continue}s.push(l)}var h=s.length-e;if(!(h<=0)){var m=s.sort((g,_)=>g._lastEnsureEqual-_._lastEnsureEqual),v=m.slice(0,h);v.forEach(g=>pu(n,g))}}},ol=Fm(Km,qm),Ya=new WeakSet;function Um(e){Ya.has(e)||(Ya.add(e),hh().then(()=>vh(200)).then(()=>{e.destroyed||e.cacheReplacementPolicy(e,e._queryCache),Ya.delete(e)}))}var sl=function(){function e(r,n,i){this.cacheItemByDocId=new Map,this.tasks=new Set,this.registry=typeof FinalizationRegistry=="function"?new FinalizationRegistry(s=>{var u=s.docId,l=this.cacheItemByDocId.get(u);l&&(l[0].delete(s.revisionHeight),l[0].size===0&&this.cacheItemByDocId.delete(u))}):void 0,this.primaryPath=r,this.changes$=n,this.documentCreator=i,n.subscribe(s=>{this.tasks.add(()=>{for(var u=this.cacheItemByDocId,l=0;l<s.length;l++){var h=s[l],m=u.get(h.documentId);if(m){var v=h.documentData;v||(v=h.previousDocumentData),m[1]=v}}}),this.tasks.size<=1&&Wi().then(()=>{this.processTasks()})})}var t=e.prototype;return t.processTasks=function(){if(this.tasks.size!==0){var n=Array.from(this.tasks);n.forEach(i=>i()),this.tasks.clear()}},t.getLatestDocumentData=function(n){this.processTasks();var i=yr(this.cacheItemByDocId,n);return i[1]},t.getLatestDocumentDataIfExists=function(n){this.processTasks();var i=this.cacheItemByDocId.get(n);if(i)return i[1]},Gt(e,[{key:"getCachedRxDocuments",get:function(){var r=mu(this);return kt(this,"getCachedRxDocuments",r)}},{key:"getCachedRxDocument",get:function(){var r=mu(this);return kt(this,"getCachedRxDocument",n=>r([n])[0])}}])}();function mu(e){var t=e.primaryPath,r=e.cacheItemByDocId,n=e.registry,i=ge.deepFreezeWhenDevMode,s=e.documentCreator,u=l=>{for(var h=new Array(l.length),m=[],v=0;v<l.length;v++){var g=l[v],_=g[t],O=Qt(g._rev),D=void 0,A=void 0,L=r.get(_);L?(D=L[0],A=D.get(O)):(D=new Map,L=[D,g],r.set(_,L));var B=A?A.deref():void 0;B||(g=i(g),B=s(g),D.set(O,Hm(B)),n&&m.push(B)),h[v]=B}return m.length>0&&n&&(e.tasks.add(()=>{for(var z=0;z<m.length;z++){var V=m[z];n.register(V,{docId:V.primary,revisionHeight:Qt(V.revision)})}}),e.tasks.size<=1&&Wi().then(()=>{e.processTasks()})),h};return u}function ul(e,t){var r=e.getCachedRxDocuments;return r(t)}var Wm=typeof WeakRef=="function",Hm=Wm?zm:Qm;function zm(e){return new WeakRef(e)}function Qm(e){return{deref(){return e}}}var vu=function(){function e(r,n,i){this.time=je(),this.query=r,this.count=i,this.documents=ul(this.query.collection._docCache,n)}var t=e.prototype;return t.getValue=function(n){var i=this.query.op;if(i==="count")return this.count;if(i==="findOne"){var s=this.documents.length===0?null:this.documents[0];if(!s&&n)throw G("QU10",{collection:this.query.collection.name,query:this.query.mangoQuery,op:i});return s}else return i==="findByIds"?this.docsMap:this.documents.slice(0)},Gt(e,[{key:"docsData",get:function(){return kt(this,"docsData",this.documents.map(r=>r._data))}},{key:"docsDataMap",get:function(){var r=new Map;return this.documents.forEach(n=>{r.set(n.primary,n._data)}),kt(this,"docsDataMap",r)}},{key:"docsMap",get:function(){for(var r=new Map,n=this.documents,i=0;i<n.length;i++){var s=n[i];r.set(s.primary,s)}return kt(this,"docsMap",r)}}])}(),Vm=0,Gm=function(){return++Vm},cl=function(){function e(r,n,i,s={}){this.id=Gm(),this._execOverDatabaseCount=0,this._creationTime=je(),this._lastEnsureEqual=0,this.uncached=!1,this.refCount$=new cr(null),this._result=null,this._latestChangeEvent=-1,this._lastExecStart=0,this._lastExecEnd=0,this._ensureEqualQueue=pt,this.op=r,this.mangoQuery=n,this.collection=i,this.other=s,n||(this.mangoQuery=xi()),this.isFindOneByIdQuery=Zm(this.collection.schema.primaryPath,n)}var t=e.prototype;return t._setResultData=function(n){if(typeof n>"u")throw G("QU18",{database:this.collection.database.name,collection:this.collection.name});if(typeof n=="number"){this._result=new vu(this,[],n);return}else n instanceof Map&&(n=Array.from(n.values()));var i=new vu(this,n,n.length);this._result=i},t._execOverDatabase=async function(){if(this._execOverDatabaseCount=this._execOverDatabaseCount+1,this._lastExecStart=je(),this.op==="count"){var n=this.getPreparedQuery(),i=await this.collection.storageInstance.count(n);if(i.mode==="slow"&&!this.collection.database.allowSlowCount)throw G("QU14",{collection:this.collection,queryObj:this.mangoQuery});return i.count}if(this.op==="findByIds"){var s=ae(this.mangoQuery.selector)[this.collection.schema.primaryPath].$in,u=new Map,l=[];if(s.forEach(v=>{var g=this.collection._docCache.getLatestDocumentDataIfExists(v);if(g){if(!g._deleted){var _=this.collection._docCache.getCachedRxDocument(g);u.set(v,_)}}else l.push(v)}),l.length>0){var h=await this.collection.storageInstance.findDocumentsById(l,!1);h.forEach(v=>{var g=this.collection._docCache.getCachedRxDocument(v);u.set(g.primary,g)})}return u}var m=Xm(this);return m.then(v=>(this._lastExecEnd=je(),v))},t.exec=async function(n){if(n&&this.op!=="findOne")throw G("QU9",{collection:this.collection.name,query:this.mangoQuery,op:this.op});await yu(this);var i=ae(this._result);return i.getValue(n)},t.toString=function(){var n=Ci({op:this.op,query:this.mangoQuery,other:this.other},!0),i=JSON.stringify(n);return this.toString=()=>i,i},t.getPreparedQuery=function(){var n={rxQuery:this,mangoQuery:Dn(this.collection.schema.jsonSchema,this.mangoQuery)};n.mangoQuery.selector._deleted={$eq:!1},n.mangoQuery.index&&n.mangoQuery.index.unshift("_deleted"),dt("prePrepareQuery",n);var i=Yi(this.collection.schema.jsonSchema,n.mangoQuery);return this.getPreparedQuery=()=>i,i},t.doesDocumentDataMatch=function(n){return n._deleted?!1:this.queryMatcher(n)},t.remove=function(){return this.exec().then(n=>Array.isArray(n)?Promise.all(n.map(i=>i.remove())):n.remove())},t.incrementalRemove=function(){return Tr(this.asRxQuery,n=>n.incrementalRemove())},t.update=function(n){throw ve("update")},t.patch=function(n){return Tr(this.asRxQuery,i=>i.patch(n))},t.incrementalPatch=function(n){return Tr(this.asRxQuery,i=>i.incrementalPatch(n))},t.modify=function(n){return Tr(this.asRxQuery,i=>i.modify(n))},t.incrementalModify=function(n){return Tr(this.asRxQuery,i=>i.incrementalModify(n))},t.where=function(n){throw ve("query-builder")},t.sort=function(n){throw ve("query-builder")},t.skip=function(n){throw ve("query-builder")},t.limit=function(n){throw ve("query-builder")},Gt(e,[{key:"$",get:function(){if(!this._$){var r=this.collection.$.pipe(ye(n=>!n.isLocal),jn(null),Ct(()=>yu(this)),Te(()=>this._result),Bn(Mn),xn((n,i)=>!!(n&&n.time===ae(i).time)),ye(n=>!!n),Te(n=>ae(n).getValue()));this._$=Ld(r,this.refCount$.pipe(ye(()=>!1)))}return this._$}},{key:"$$",get:function(){var r=this.collection.database.getReactivityFactory();return r.fromObservable(this.$,void 0,this.collection.database)}},{key:"queryMatcher",get:function(){var r=this.collection.schema.jsonSchema,n=Dn(this.collection.schema.jsonSchema,this.mangoQuery);return kt(this,"queryMatcher",Zo(r,n))}},{key:"asRxQuery",get:function(){return this}}])}();function xi(){return{selector:{}}}function Ym(e){return e.collection._queryCache.getByQuery(e)}function Nr(e,t,r,n){dt("preCreateRxQuery",{op:e,queryObj:t,collection:r,other:n});var i=new cl(e,t,r,n);return i=Ym(i),Um(r),i}function ll(e){var t=e.asRxQuery.collection._changeEventBuffer.getCounter();return e._latestChangeEvent>=t}async function yu(e){return e.collection.awaitBeforeReads.size>0&&await Promise.all(Array.from(e.collection.awaitBeforeReads).map(t=>t())),e.collection.database.destroyed||ll(e)?!1:(e._ensureEqualQueue=e._ensureEqualQueue.then(()=>Jm(e)),e._ensureEqualQueue)}function Jm(e){if(e._lastEnsureEqual=je(),e.collection.database.destroyed||ll(e))return pt;var t=!1,r=!1;if(e._latestChangeEvent===-1&&(r=!0),!r){var n=e.asRxQuery.collection._changeEventBuffer.getFrom(e._latestChangeEvent+1);if(n===null)r=!0;else{e._latestChangeEvent=e.asRxQuery.collection._changeEventBuffer.getCounter();var i=e.asRxQuery.collection._changeEventBuffer.reduceByLastOfDoc(n);if(e.op==="count"){var s=ae(e._result).count,u=s;i.forEach(h=>{var m=h.previousDocumentData&&e.doesDocumentDataMatch(h.previousDocumentData),v=e.doesDocumentDataMatch(h.documentData);!m&&v&&u++,m&&!v&&u--}),u!==s&&(t=!0,e._setResultData(u))}else{var l=$m(e,i);l.runFullQueryAgain?r=!0:l.changed&&(t=!0,e._setResultData(l.newResults))}}}return r?e._execOverDatabase().then(h=>(e._latestChangeEvent=e.collection._changeEventBuffer.getCounter(),typeof h=="number"?((!e._result||h!==e._result.count)&&(t=!0,e._setResultData(h)),t):((!e._result||!Gf(e.collection.schema.primaryPath,h,e._result.docsData))&&(t=!0,e._setResultData(h)),t))):Promise.resolve(t)}function Yi(e,t){if(!t.sort)throw G("SNH",{query:t});var r=xp(e,t);return{query:t,queryPlan:r}}async function Xm(e){var t=[],r=e.collection;if(e.isFindOneByIdQuery)if(Array.isArray(e.isFindOneByIdQuery)){var n=e.isFindOneByIdQuery;if(n=n.filter(v=>{var g=e.collection._docCache.getLatestDocumentDataIfExists(v);return g?(g._deleted||t.push(g),!1):!0}),n.length>0){var i=await r.storageInstance.findDocumentsById(n,!1);vr(t,i)}}else{var s=e.isFindOneByIdQuery,u=e.collection._docCache.getLatestDocumentDataIfExists(s);if(!u){var l=await r.storageInstance.findDocumentsById([s],!1);l[0]&&(u=l[0])}u&&!u._deleted&&t.push(u)}else{var h=e.getPreparedQuery(),m=await r.storageInstance.query(h);t=m.documents}return t}function Zm(e,t){if(!t.skip&&t.selector&&Object.keys(t.selector).length===1&&t.selector[e]){var r=t.selector[e];if(typeof r=="string")return r;if(Object.keys(r).length===1&&typeof r.$eq=="string"||Object.keys(r).length===1&&Array.isArray(r.$eq)&&!r.$eq.find(n=>typeof n!="string"))return r.$eq}return!1}var ev="_rxdb_internal";async function Fn(e,t){var r=await e.findDocumentsById([t],!1),n=r[0];if(n)return n}async function Cn(e,t,r){var n=await e.bulkWrite([t],r);if(n.error.length>0){var i=n.error[0];throw i}else{var s=at(e.schema.primaryKey),u=it(s,[t],n),l=u[0];return l}}function tv(e,t){var r=Fn(e,t),n=e.changeStream().pipe(Te(i=>i.events.find(s=>s.documentId===t)),ye(i=>!!i),Te(i=>Promise.resolve(ae(i).documentData)),jn(r),Nd(i=>i),ye(i=>!!i));return n}function Rn(e){return Object.assign({},...e)}function Ti(e,t,r,n){if(n)throw n.status===409?G("CONFLICT",{collection:e.name,id:t,writeError:n,data:r}):n.status===422?G("VD2",{collection:e.name,id:t,writeError:n,data:r}):n}function rv(e,t,r,n,i,s,u){for(var l=!!e.schema.attachments,h=[],m=[],v=[],g=An(10),_={id:g,events:[],checkpoint:null,context:i,startTime:je(),endTime:0},O=_.events,D=[],A=[],L=[],B=r.size>0,z,V=n.length,se=function(){var ee=n[X],Z=ee.document,ue=ee.previous,be=Z[t],xe=Z._deleted,Ie=ue&&ue._deleted,le=void 0;B&&(le=r.get(be));var we;if(le){var ut=le._rev;if(!ue||ue&&ut!==ue._rev){var pe={isError:!0,status:409,documentId:be,writeRow:ee,documentInDb:le};return v.push(pe),1}var he=l?Ja(ee):ee;l&&(xe?ue&&Object.keys(ue._attachments).forEach(Ce=>{A.push({documentId:be,attachmentId:Ce,digest:ae(ue)._attachments[Ce].digest})}):(Object.entries(Z._attachments).find(([Ce,Ve])=>{var _t=ue?ue._attachments[Ce]:void 0;return!_t&&!Ve.data&&(we={documentId:be,documentInDb:le,isError:!0,status:510,writeRow:ee,attachmentId:Ce}),!0}),we||Object.entries(Z._attachments).forEach(([Ce,Ve])=>{var _t=ue?ue._attachments[Ce]:void 0;if(!_t)D.push({documentId:be,attachmentId:Ce,attachmentData:Ve,digest:Ve.digest});else{var $t=he.document._attachments[Ce].digest;Ve.data&&_t.digest!==$t&&L.push({documentId:be,attachmentId:Ce,attachmentData:Ve,digest:Ve.digest})}}))),we?v.push(we):(l?m.push(Ja(he)):m.push(he),z=he);var me=null,oe=null,Be=null;if(Ie&&!xe)Be="INSERT",me=l?gt(Z):Z;else if(ue&&!Ie&&!xe)Be="UPDATE",me=l?gt(Z):Z,oe=ue;else if(xe)Be="DELETE",me=ae(Z),oe=ue;else throw G("SNH",{args:{writeRow:ee}});var xr={documentId:be,documentData:me,previousDocumentData:oe,operation:Be};O.push(xr)}else{var Le=!!xe;if(l&&Object.entries(Z._attachments).forEach(([Ce,Ve])=>{Ve.data?D.push({documentId:be,attachmentId:Ce,attachmentData:Ve,digest:Ve.digest}):(we={documentId:be,isError:!0,status:510,writeRow:ee,attachmentId:Ce},v.push(we))}),we||(l?h.push(Ja(ee)):h.push(ee),z=ee),!Le){var ke={documentId:be,operation:"INSERT",documentData:l?gt(Z):Z,previousDocumentData:l&&ue?gt(ue):ue};O.push(ke)}}},X=0;X<V;X++)se();return{bulkInsertDocs:h,bulkUpdateDocs:m,newestRow:z,errors:v,eventBulk:_,attachmentsAdd:D,attachmentsRemove:A,attachmentsUpdate:L}}function Ja(e){return{previous:e.previous,document:gt(e.document)}}function nv(e){return atob(e).length}function iv(e){var t=e.data;if(!t)return e;var r={length:nv(t),digest:e.digest,type:e.type};return r}function gt(e){if(!e._attachments||Object.keys(e._attachments).length===0)return e;var t=Se(e);return t._attachments={},Object.entries(e._attachments).forEach(([r,n])=>{t._attachments[r]=iv(n)}),t}function Un(e){return Object.assign({},e,{_meta:Se(e._meta)})}var fl=new WeakMap;function es(e,t,r){ge.deepFreezeWhenDevMode(r);var n=at(t.schema.primaryKey),i={originalStorageInstance:t,schema:t.schema,internals:t.internals,collectionName:t.collectionName,databaseName:t.databaseName,options:t.options,bulkWrite(s,u){for(var l=e.token,h=new Array(s.length),m=je(),v=0;v<s.length;v++){var g=s[v],_=Un(g.document);_._meta.lwt=m;var O=g.previous;_._rev=It(l,O),h[v]={document:_,previous:O}}return dt("preStorageWrite",{storageInstance:this.originalStorageInstance,rows:h}),e.lockedRun(()=>t.bulkWrite(h,u)).then(D=>{var A={error:[]},L=it(n,h,D);fl.set(A,L);var B=D.error.length===0?[]:D.error.filter(V=>V.status===409&&!V.writeRow.previous&&!V.writeRow.document._deleted&&ae(V.documentInDb)._deleted?!0:(A.error.push(V),!1));if(B.length>0){var z=B.map(V=>({previous:V.documentInDb,document:Object.assign({},V.writeRow.document,{_rev:It(e.token,V.documentInDb)})}));return e.lockedRun(()=>t.bulkWrite(z,u)).then(V=>{vr(A.error,V.error);var se=it(n,z,V);return vr(L,se),A})}return A})},query(s){return e.lockedRun(()=>t.query(s))},count(s){return e.lockedRun(()=>t.count(s))},findDocumentsById(s,u){return e.lockedRun(()=>t.findDocumentsById(s,u))},getAttachmentData(s,u,l){return e.lockedRun(()=>t.getAttachmentData(s,u,l))},getChangedDocumentsSince:t.getChangedDocumentsSince?(s,u)=>e.lockedRun(()=>t.getChangedDocumentsSince(ae(s),u)):void 0,cleanup(s){return e.lockedRun(()=>t.cleanup(s))},remove(){return e.storageInstances.delete(i),e.lockedRun(()=>t.remove())},close(){return e.storageInstances.delete(i),e.lockedRun(()=>t.close())},changeStream(){return t.changeStream()},conflictResultionTasks(){return t.conflictResultionTasks()},resolveConflictResultionTask(s){if(s.output.isEqual)return t.resolveConflictResultionTask(s);var u=Object.assign({},s.output.documentData,{_meta:_r(),_rev:ht(),_attachments:{}}),l=Se(u);return delete l._meta,delete l._rev,delete l._attachments,t.resolveConflictResultionTask({id:s.id,output:{isEqual:!1,documentData:l}})}};return e.storageInstances.add(i),i}function av(e){if(e.schema.keyCompression)throw G("UT5",{args:{params:e}});if(wo(e.schema))throw G("UT6",{args:{params:e}});if(e.schema.attachments&&e.schema.attachments.compression)throw G("UT7",{args:{params:e}})}function wo(e){return!!(e.encrypted&&e.encrypted.length>0||e.attachments&&e.attachments.encrypted)}function ov(e,t,r){var n=at(e.schema.primaryKey),i=r?r.lwt:Mo,s=r?r.id:"";return Dn(e.schema,{selector:{$or:[{"_meta.lwt":{$gt:i}},{"_meta.lwt":{$eq:i},[n]:{$gt:r?s:""}}],"_meta.lwt":{$gte:i}},sort:[{"_meta.lwt":"asc"},{[n]:"asc"}],skip:0,limit:t})}async function hl(e,t,r){if(e.getChangedDocumentsSince)return e.getChangedDocumentsSince(t,r);var n=at(e.schema.primaryKey),i=Yi(e.schema,ov(e,t,r)),s=await e.query(i),u=s.documents,l=Ff(u);return{documents:u,checkpoint:l?{id:l[n],lwt:l._meta.lwt}:r||{id:"",lwt:0}}}function it(e,t,r){var n=fl.get(r);if(n)return n;var i=[];if(r.error.length>0){for(var s=new Set,u=0;u<r.error.length;u++){var l=r.error[u];s.add(l.documentId)}for(var h=0;h<t.length;h++){var m=t[h].document;s.has(m[e])||i.push(gt(m))}}else{i.length=t.length-r.error.length;for(var v=0;v<t.length;v++){var g=t[v].document;i[v]=gt(g)}}return i}var dl=function(){function e(r,n,i,s){this.queueByDocId=new Map,this.isRunning=!1,this.storageInstance=r,this.primaryPath=n,this.preWrite=i,this.postWrite=s}var t=e.prototype;return t.addWrite=function(n,i){var s=n[this.primaryPath],u=Pt(this.queueByDocId,s,()=>[]),l=new Promise((h,m)=>{var v={lastKnownDocumentState:n,modifier:i,resolve:h,reject:m};ae(u).push(v),this.triggerRun()});return l},t.triggerRun=async function(){if(!(this.isRunning===!0||this.queueByDocId.size===0)){this.isRunning=!0;var n=[],i=this.queueByDocId;this.queueByDocId=new Map,await Promise.all(Array.from(i.entries()).map(async([u,l])=>{var h=sv(l.map(g=>g.lastKnownDocumentState)),m=h;for(var v of l)try{m=await v.modifier(Qe(m))}catch(g){v.reject(g),v.reject=()=>{},v.resolve=()=>{}}try{await this.preWrite(m,h)}catch(g){l.forEach(_=>_.reject(g));return}n.push({previous:h,document:m})}));var s=n.length>0?await this.storageInstance.bulkWrite(n,"incremental-write"):{error:[]};return await Promise.all(it(this.primaryPath,n,s).map(u=>{var l=u[this.primaryPath];this.postWrite(u);var h=yr(i,l);h.forEach(m=>m.resolve(u))})),s.error.forEach(u=>{var l=u.documentId,h=yr(i,l),m=Hi(u);if(m){var v=Pt(this.queueByDocId,l,()=>[]);h.reverse().forEach(_=>{_.lastKnownDocumentState=ae(m.documentInDb),ae(v).unshift(_)})}else{var g=Dh(u);h.forEach(_=>_.reject(g))}}),this.isRunning=!1,this.triggerRun()}},e}();function gu(e){var t=async r=>{var n=Vf(r);n._deleted=r._deleted;var i=await e(n),s=Object.assign({},i,{_meta:r._meta,_attachments:r._attachments,_rev:r._rev,_deleted:typeof i._deleted<"u"?i._deleted:r._deleted});return typeof s._deleted>"u"&&(s._deleted=!1),s};return t}function sv(e){var t=e[0],r=Qt(t._rev);return e.forEach(n=>{var i=Qt(n._rev);i>r&&(t=n,r=i)}),t}var Ji={get primaryPath(){var e=this;if(e.isInstanceOfRxDocument)return e.collection.schema.primaryPath},get primary(){var e=this;if(e.isInstanceOfRxDocument)return e._data[e.primaryPath]},get revision(){var e=this;if(e.isInstanceOfRxDocument)return e._data._rev},get deleted$(){var e=this;if(e.isInstanceOfRxDocument)return e.$.pipe(Te(t=>t._data._deleted))},get deleted$$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.deleted$,e.getLatest().deleted,e.collection.database)},get deleted(){var e=this;if(e.isInstanceOfRxDocument)return e._data._deleted},getLatest(){var e=this.collection._docCache.getLatestDocumentData(this.primary);return this.collection._docCache.getCachedRxDocument(e)},get $(){var e=this;return e.collection.$.pipe(ye(t=>!t.isLocal),ye(t=>t.documentId===this.primary),Te(t=>Oc(t)),jn(e.collection._docCache.getLatestDocumentData(this.primary)),xn((t,r)=>t._rev===r._rev),Te(t=>this.collection._docCache.getCachedRxDocument(t)),Bn(Mn))},get $$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.$,e.getLatest()._data,e.collection.database)},get$(e){if(ge.isDevMode()){if(e.includes(".item."))throw G("DOC1",{path:e});if(e===this.primaryPath)throw G("DOC2");if(this.collection.schema.finalFields.includes(e))throw G("DOC3",{path:e});var t=Kr(this.collection.schema.jsonSchema,e);if(!t)throw G("DOC4",{path:e})}return this.$.pipe(Te(r=>Vt(r,e)),xn())},get$$(e){var t=this.get$(e),r=this.collection.database.getReactivityFactory();return r.fromObservable(t,this.getLatest().get(e),this.collection.database)},populate(e){var t=Kr(this.collection.schema.jsonSchema,e),r=this.get(e);if(!r)return To;if(!t)throw G("DOC5",{path:e});if(!t.ref)throw G("DOC6",{path:e,schemaObj:t});var n=this.collection.database.collections[t.ref];if(!n)throw G("DOC7",{ref:t.ref,path:e,schemaObj:t});return t.type==="array"?n.findByIds(r).exec().then(i=>{var s=i.values();return Array.from(s)}):n.findOne(r).exec()},get(e){return vl(this,e)},toJSON(e=!1){if(e)return ge.deepFreezeWhenDevMode(this._data);var t=Se(this._data);return delete t._rev,delete t._attachments,delete t._deleted,delete t._meta,ge.deepFreezeWhenDevMode(t)},toMutableJSON(e=!1){return Qe(this.toJSON(e))},update(e){throw ve("update")},incrementalUpdate(e){throw ve("update")},updateCRDT(e){throw ve("crdt")},putAttachment(){throw ve("attachments")},getAttachment(){throw ve("attachments")},allAttachments(){throw ve("attachments")},get allAttachments$(){throw ve("attachments")},async modify(e,t){var r=this._data,n=await gu(e)(r);return this._saveData(n,r)},incrementalModify(e,t){return this.collection.incrementalWriteQueue.addWrite(this._data,gu(e)).then(r=>this.collection._docCache.getCachedRxDocument(r))},patch(e){var t=this._data,r=Qe(t);return Object.entries(e).forEach(([n,i])=>{r[n]=i}),this._saveData(r,t)},incrementalPatch(e){return this.incrementalModify(t=>(Object.entries(e).forEach(([r,n])=>{t[r]=n}),t))},async _saveData(e,t){if(e=Se(e),this._data._deleted)throw G("DOC11",{id:this.primary,document:this});await ml(this.collection,e,t);var r=[{previous:t,document:e}],n=await this.collection.storageInstance.bulkWrite(r,"rx-document-save-data"),i=n.error[0];return Ti(this.collection,this.primary,e,i),await this.collection._runHooks("post","save",e,this),this.collection._docCache.getCachedRxDocument(it(this.collection.schema.primaryPath,r,n)[0])},remove(){var e=this.collection;if(this.deleted)return Promise.reject(G("DOC13",{document:this,id:this.primary}));var t=Se(this._data),r;return e._runHooks("pre","remove",t,this).then(async()=>{t._deleted=!0;var n=[{previous:this._data,document:t}],i=await e.storageInstance.bulkWrite(n,"rx-document-remove"),s=i.error[0];return Ti(e,this.primary,t,s),it(this.collection.schema.primaryPath,n,i)[0]}).then(n=>(r=n,this.collection._runHooks("post","remove",t,this))).then(()=>this.collection._docCache.getCachedRxDocument(r))},incrementalRemove(){return this.incrementalModify(async e=>(await this.collection._runHooks("pre","remove",e,this),e._deleted=!0,e)).then(async e=>(await this.collection._runHooks("post","remove",e._data,e),e))},destroy(){throw G("DOC14")}};function pl(e=Ji){var t=function(n,i){this.collection=n,this._data=i,this._propertyCache=new Map,this.isInstanceOfRxDocument=!0};return t.prototype=e,t}function uv(e,t,r){var n=new e(t,r);return dt("createRxDocument",n),n}function ml(e,t,r){return t._meta=Object.assign({},r._meta,t._meta),ge.isDevMode()&&e.schema.validateChange(r,t),e._runHooks("pre","save",t,r)}function vl(e,t){return Pt(e._propertyCache,t,()=>{var r=Vt(e._data,t);if(typeof r!="object"||r===null||Array.isArray(r))return ge.deepFreezeWhenDevMode(r);var n=new Proxy(Se(r),{get(i,s){if(typeof s!="string")return i[s];var u=s.charAt(s.length-1);if(u==="$")if(s.endsWith("$$")){var l=s.slice(0,-2);return e.get$$(pn(t+"."+l))}else{var h=s.slice(0,-1);return e.get$(pn(t+"."+h))}else if(u==="_"){var m=s.slice(0,-1);return e.populate(pn(t+"."+m))}else{var v=i[s];return typeof v=="number"||typeof v=="string"||typeof v=="boolean"?v:vl(e,pn(t+"."+s))}}});return n})}var pr="collection",ts="storage-token",Ii="rx-migration-status",cv="RxInternalDocument",rs=zi({version:0,title:cv,primaryKey:{key:"id",fields:["context","key"],separator:"|"},type:"object",properties:{id:{type:"string",maxLength:200},key:{type:"string"},context:{type:"string",enum:[pr,ts,Ii,"OTHER"]},data:{type:"object",additionalProperties:!0}},indexes:[],required:["key","context","data"],additionalProperties:!1,sharding:{shards:1,mode:"collection"}});function Qr(e,t){return Sr(rs,{key:e,context:t})}async function yl(e){var t=Yi(e.schema,{selector:{context:pr,_deleted:{$eq:!1}},sort:[{id:"asc"}],skip:0}),r=await e.query(t),n=r.documents;return n}var gl="storageToken",lv=Qr(gl,ts);async function fv(e){var t=An(10),r=e.password?await e.hashFunction(JSON.stringify(e.password)):void 0,n={id:lv,context:ts,key:gl,data:{rxdbVersion:e.rxdbVersion,token:t,instanceToken:e.token,passwordHash:r},_deleted:!1,_meta:_r(),_rev:ht(),_attachments:{}},i=[{document:n}],s=await e.internalStore.bulkWrite(i,"internal-add-storage-token");if(!s.error[0])return it("id",i,s)[0];var u=ae(s.error[0]);if(u.isError&&Hi(u)){var l=u;if(!hv(l.documentInDb.data.rxdbVersion,e.rxdbVersion))throw G("DM5",{args:{database:e.name,databaseStateVersion:l.documentInDb.data.rxdbVersion,codeVersion:e.rxdbVersion}});if(r&&r!==l.documentInDb.data.passwordHash)throw G("DB1",{passwordHash:r,existingPasswordHash:l.documentInDb.data.passwordHash});var h=l.documentInDb;return ae(h)}throw u}function hv(e,t){if(!e||t.includes("beta")&&t!==e)return!1;var r=e.split(".")[0],n=t.split(".")[0];return r===n}async function dv(e,t,r){if(e.schema.version!==r.version)throw G("SNH",{schema:r,version:e.schema.version,name:e.name,collection:e,args:{storageCollectionName:t}});for(var n=_o(e.name,e.schema.jsonSchema),i=Qr(n,pr);;){var s=await Fn(e.database.internalStore,i),u=Qe(ae(s)),l=u.data.connectedStorages.find(h=>h.collectionName===t&&h.schema.version===r.version);if(l)return;u.data.connectedStorages.push({collectionName:t,schema:r});try{await Cn(e.database.internalStore,{previous:ae(s),document:u},"add-connected-storage-to-collection")}catch(h){if(!Hi(h))throw h}}}function _o(e,t){return e+"-"+t.version}function _i(e,t){return t=Se(t),t=Nh(e,t),typeof e.jsonSchema.primaryKey!="string"&&(t=Ch(e.primaryPath,e.jsonSchema,t)),t._meta=_r(),Object.prototype.hasOwnProperty.call(t,"_deleted")||(t._deleted=!1),Object.prototype.hasOwnProperty.call(t,"_attachments")||(t._attachments={}),Object.prototype.hasOwnProperty.call(t,"_rev")||(t._rev=ht()),t}async function pv(e,t){t.multiInstance=e.multiInstance;var r=await e.storage.createStorageInstance(t);return r}async function bl(e,t,r,n,i,s,u){var l=await yl(t),h=l.filter(_=>_.data.name===i),m=[];h.forEach(_=>{m.push({collectionName:_.data.name,schema:_.data.schema,isCollection:!0}),_.data.connectedStorages.forEach(O=>m.push({collectionName:O.collectionName,isCollection:!1,schema:O.schema}))});var v=new Set;if(m=m.filter(_=>{var O=_.collectionName+"||"+_.schema.version;return v.has(O)?!1:(v.add(O),!0)}),await Promise.all(m.map(async _=>{var O=await e.createStorageInstance({collectionName:_.collectionName,databaseInstanceToken:r,databaseName:n,multiInstance:!1,options:{},schema:_.schema,password:s,devMode:ge.isDevMode()});await O.remove(),_.isCollection&&await Tn("postRemoveRxCollection",{storage:e,databaseName:n,collectionName:i})})),u){var g=h.map(_=>{var O=Un(_);return O._deleted=!0,O._meta.lwt=je(),O._rev=It(r,_),{previous:_,document:O}});await t.bulkWrite(g,"rx-database-remove-collection-all")}}function lt(e){if(e.destroyed)throw G("COL21",{collection:e.name,version:e.schema.version})}var mv=function(){function e(r){this.subs=[],this.counter=0,this.eventCounterMap=new WeakMap,this.buffer=[],this.limit=100,this.tasks=new Set,this.collection=r,this.subs.push(this.collection.database.eventBulks$.pipe(ye(n=>n.collectionName===this.collection.name),ye(n=>{var i=n.events[0];return!i.isLocal})).subscribe(n=>{this.tasks.add(()=>this._handleChangeEvents(n.events)),this.tasks.size<=1&&Wi().then(()=>{this.processTasks()})}))}var t=e.prototype;return t.processTasks=function(){if(this.tasks.size!==0){var n=Array.from(this.tasks);n.forEach(i=>i()),this.tasks.clear()}},t._handleChangeEvents=function(n){var i=this.counter;this.counter=this.counter+n.length,n.length>this.limit?this.buffer=n.slice(n.length*-1):(vr(this.buffer,n),this.buffer=this.buffer.slice(this.limit*-1));for(var s=i+1,u=this.eventCounterMap,l=0;l<n.length;l++){var h=n[l];u.set(h,s+l)}},t.getCounter=function(){return this.processTasks(),this.counter},t.getBuffer=function(){return this.processTasks(),this.buffer},t.getArrayIndexByPointer=function(n){this.processTasks();var i=this.buffer[0],s=this.eventCounterMap.get(i);if(n<s)return null;var u=n-s;return u},t.getFrom=function(n){this.processTasks();var i=[],s=this.getArrayIndexByPointer(n);if(s===null)return null;for(;;){var u=this.buffer[s];if(s++,u)i.push(u);else return i}},t.runFrom=function(n,i){this.processTasks();var s=this.getFrom(n);if(s===null)throw new Error("out of bounds");s.forEach(u=>i(u))},t.reduceByLastOfDoc=function(n){return this.processTasks(),n.slice(0)},t.destroy=function(){this.tasks.clear(),this.subs.forEach(n=>n.unsubscribe())},e}();function vv(e){return new mv(e)}var yv=new WeakMap;function gv(e){var t=e.schema.getDocumentPrototype(),r=_v(e),n=Ji,i={};return[t,r,n].forEach(s=>{var u=Object.getOwnPropertyNames(s);u.forEach(l=>{var h=Object.getOwnPropertyDescriptor(s,l),m=!0;(l.startsWith("_")||l.endsWith("_")||l.startsWith("$")||l.endsWith("$"))&&(m=!1),typeof h.value=="function"?Object.defineProperty(i,l,{get(){return h.value.bind(this)},enumerable:m,configurable:!1}):(h.enumerable=m,h.configurable=!1,h.writable&&(h.writable=!1),Object.defineProperty(i,l,h))})}),i}function bv(e){return Pt(yv,e,()=>pl(gv(e)))}function wv(e,t,r){var n=uv(t,e,ge.deepFreezeWhenDevMode(r));return e._runHooksSync("post","create",r,n),dt("postCreateRxDocument",n),n}function _v(e){var t={};return Object.entries(e.methods).forEach(([r,n])=>{t[r]=n}),t}async function Ni(e,t){var r=Sr(e.input.metaInstance.schema,{isCheckpoint:"1",itemId:t}),n=await e.input.metaInstance.findDocumentsById([r],!1),i=n[0];if(e.lastCheckpointDoc[t]=i,i)return i.checkpointData}async function $i(e,t,r){e.checkpointQueue=e.checkpointQueue.then(async()=>{var n=e.lastCheckpointDoc[t];if(r&&!e.events.canceled.getValue()&&(!n||JSON.stringify(n.checkpointData)!==JSON.stringify(r))){var i={id:"",isCheckpoint:"1",itemId:t,_deleted:!1,_attachments:{},checkpointData:r,_meta:_r(),_rev:ht()};for(i.id=Sr(e.input.metaInstance.schema,i);!e.events.canceled.getValue();){if(n&&(i.checkpointData=Rn([n.checkpointData,i.checkpointData])),i._meta.lwt=je(),i._rev=It(await e.checkpointKey,n),e.events.canceled.getValue())return;var s=[{previous:n,document:i}],u=await e.input.metaInstance.bulkWrite(s,"replication-set-checkpoint"),l=it(e.primaryPath,s,u)[0];if(l){e.lastCheckpointDoc[t]=l;return}else{var h=u.error[0];if(h.status!==409)throw h;n=ae(h.documentInDb),i._rev=It(await e.checkpointKey,n)}}}}),await e.checkpointQueue}async function Sv(e){var t=await e.hashFunction([e.identifier,e.forkInstance.databaseName,e.forkInstance.collectionName].join("||"));return"rx_storage_replication_"+t}function bu(e,t,r,n,i){var s=Object.assign({},n,{_attachments:t&&n._attachments?n._attachments:{},_meta:r?n._meta:Object.assign({},i?i._meta:{},{lwt:je()}),_rev:r?n._rev:ht()});return s._rev||(s._rev=It(e,i)),s}function Wt(e,t,r){var n=Se(e);return t||delete n._attachments,r||(delete n._meta,delete n._rev),n}function So(e,t){return e.hasAttachments?t.map(r=>{var n=Qe(r.document);return n.docData=gt(n.docData),{document:n,previous:r.previous}}):t}function Eo(e){for(;;)if(e.underlyingPersistentStorage)e=e.underlyingPersistentStorage;else return e}var Pi="RxReplicationProtocolMetaData";function wu(e,t){var r=Rh(e),n={title:Pi,primaryKey:{key:"id",fields:["itemId","isCheckpoint"],separator:"|"},type:"object",version:e.version,additionalProperties:!1,properties:{id:{type:"string",minLength:1,maxLength:r+2},isCheckpoint:{type:"string",enum:["0","1"],minLength:1,maxLength:1},itemId:{type:"string",maxLength:r>4?r:4},checkpointData:{type:"object",additionalProperties:!0},docData:{type:"object",properties:e.properties},isResolvedConflict:{type:"string"}},keyCompression:e.keyCompression,required:["id","isCheckpoint","itemId"]};t&&(n.encrypted=["docData"]);var i=zi(n);return i}function wl(e,t){return e.input.metaInstance.findDocumentsById(t.map(r=>{var n=Sr(e.input.metaInstance.schema,{itemId:r,isCheckpoint:"0"});return n}),!0).then(r=>{var n={};return Object.values(r).forEach(i=>{n[i.itemId]={docData:i.docData,metaDocument:i}}),n})}async function Li(e,t,r,n){var i=t[e.primaryPath],s=r?Un(r):{id:"",isCheckpoint:"0",itemId:i,docData:t,_attachments:{},_deleted:!1,_rev:ht(),_meta:{lwt:0}};s.docData=t,n&&(s.isResolvedConflict=n),s._meta.lwt=je(),s.id=Sr(e.input.metaInstance.schema,s),s._rev=It(await e.checkpointKey,r);var u={previous:r,document:s};return u}async function Ev(e){if(e.input.initialCheckpoint&&e.input.initialCheckpoint.downstream){var t=await Ni(e,"down");t||await $i(e,"down",e.input.initialCheckpoint.downstream)}var r=await e.input.hashFunction(e.input.identifier),n=e.input.replicationHandler,i=0,s=[];function u(D){e.stats.down.addNewTask=e.stats.down.addNewTask+1;var A={time:i++,task:D};s.push(A),e.streamQueue.down=e.streamQueue.down.then(()=>{for(var L=[];s.length>0;){e.events.active.down.next(!0);var B=ae(s.shift());if(!(B.time<h)){if(B.task==="RESYNC")if(L.length===0){L.push(B.task);break}else break;L.push(B.task)}}if(L.length!==0)return L[0]==="RESYNC"?m():v(L)}).then(()=>{e.events.active.down.next(!1),!e.firstSyncDone.down.getValue()&&!e.events.canceled.getValue()&&e.firstSyncDone.down.next(!0)})}if(u("RESYNC"),!e.events.canceled.getValue()){var l=n.masterChangeStream$.pipe(Ct(async D=>(await fr(e.events.active.up.pipe(ye(A=>!A))),D))).subscribe(D=>{e.stats.down.masterChangeStreamEmit=e.stats.down.masterChangeStreamEmit+1,u(D)});fr(e.events.canceled.pipe(ye(D=>!!D))).then(()=>l.unsubscribe())}var h=-1;async function m(){if(e.stats.down.downstreamResyncOnce=e.stats.down.downstreamResyncOnce+1,!e.events.canceled.getValue()){e.checkpointQueue=e.checkpointQueue.then(()=>Ni(e,"down"));for(var D=await e.checkpointQueue,A=[];!e.events.canceled.getValue();){h=i++;var L=await n.masterChangesSince(D,e.input.pullBatchSize);if(L.documents.length===0||(D=Rn([D,L.checkpoint]),A.push(O(L.documents,D)),L.documents.length<e.input.pullBatchSize))break}await Promise.all(A)}}function v(D){e.stats.down.downstreamProcessChanges=e.stats.down.downstreamProcessChanges+1;var A=[],L=null;return D.forEach(B=>{if(B==="RESYNC")throw new Error("SNH");vr(A,B.documents),L=Rn([L,B.checkpoint])}),O(A,ae(L))}var g=ft,_={docs:{}};function O(D,A){var L=e.primaryPath;return e.stats.down.persistFromMaster=e.stats.down.persistFromMaster+1,D.forEach(B=>{var z=B[L];_.docs[z]=B}),_.checkpoint=A,g=g.then(()=>{var B=_.docs;_.docs={};var z=_.checkpoint,V=Object.keys(B);if(e.events.canceled.getValue()||V.length===0)return ft;var se=[],X={},ee={},Z=[];return Promise.all([e.input.forkInstance.findDocumentsById(V,!0),wl(e,V)]).then(([ue,be])=>{var xe=new Map;return ue.forEach(Ie=>xe.set(Ie[L],Ie)),Promise.all(V.map(async Ie=>{var le=xe.get(Ie),we=le?Wt(le,e.hasAttachments,!1):void 0,Le=B[Ie],ke=be[Ie];ke&&le&&ke.metaDocument.isResolvedConflict===le._rev&&await e.streamQueue.up;var ut=!ke||!we?!1:await e.input.conflictHandler({realMasterState:ke.docData,newDocumentState:we},"downstream-check-if-equal-0").then(Be=>Be.isEqual);if(!ut&&ke&&ke.docData._rev&&le&&le._meta[e.input.identifier]&&Qt(le._rev)===le._meta[e.input.identifier]&&(ut=!0),le&&ke&&ut===!1||le&&!ke)return ft;var pe=we?await e.input.conflictHandler({realMasterState:Le,newDocumentState:we},"downstream-check-if-equal-1").then(Be=>Be.isEqual):!1;if(we&&pe)return(!ke||ut===!1)&&Z.push(await Li(e,we,ke?ke.metaDocument:void 0)),ft;var he=Object.assign({},Le,le?{_meta:Se(le._meta),_attachments:e.hasAttachments&&Le._attachments?Le._attachments:{},_rev:ht()}:{_meta:{lwt:je()},_rev:ht(),_attachments:e.hasAttachments&&Le._attachments?Le._attachments:{}});if(Le._rev){var me=le?Qt(le._rev)+1:1;he._meta[e.input.identifier]=me,e.input.keepMeta&&(he._rev=Le._rev)}e.input.keepMeta&&Le._meta&&(he._meta=Le._meta);var oe={previous:le,document:he};oe.document._rev=oe.document._rev?oe.document._rev:It(r,oe.previous),se.push(oe),X[Ie]=oe,ee[Ie]=await Li(e,Le,ke?ke.metaDocument:void 0)}))}).then(async()=>{if(se.length>0)return e.input.forkInstance.bulkWrite(se,await e.downstreamBulkWriteFlag).then(ue=>{var be=it(e.primaryPath,se,ue);be.forEach(xe=>{var Ie=xe[L];e.events.processed.down.next(X[Ie]),Z.push(ee[Ie])}),ue.error.forEach(xe=>{xe.status!==409&&e.events.error.next(G("RC_PULL",{writeError:xe}))})})}).then(()=>{if(Z.length>0)return e.input.metaInstance.bulkWrite(So(e,Z),"replication-down-write-meta").then(ue=>{ue.error.forEach(be=>{e.events.error.next(G("RC_PULL",{id:be.documentId,writeError:be}))})})}).then(()=>{$i(e,"down",z)})}).catch(B=>e.events.error.next(B)),g}}var Bi=function(e,t){var r=gt(e.newDocumentState),n=gt(e.realMasterState);return En(r,n)?Promise.resolve({isEqual:!0}):Promise.resolve({isEqual:!1,documentData:e.realMasterState})};async function Ov(e,t,r){var n=e.input.conflictHandler,i=await n(t,"replication-resolve-conflict");if(!i.isEqual){var s=Object.assign({},i.documentData,{_meta:Se(r._meta),_rev:ht(),_attachments:Se(r._attachments)});return s._meta.lwt=je(),s._rev=It(await e.checkpointKey,r),{resolvedDoc:s,output:i}}}async function Oo(e,t,r,n){if(!r._attachments||n&&!n._attachments)throw new Error("_attachments missing");var i=r[e],s=new Set(n&&n._attachments?Object.keys(n._attachments):[]);return await Promise.all(Object.entries(r._attachments).map(async([u,l])=>{if((!s.has(u)||n&&ae(n._attachments)[u].digest!==l.digest)&&!l.data){var h=await t.getAttachmentData(i,u,l.digest);l.data=h}})),r}async function kv(e){if(e.input.initialCheckpoint&&e.input.initialCheckpoint.upstream){var t=await Ni(e,"up");t||await $i(e,"up",e.input.initialCheckpoint.upstream)}var r=e.input.replicationHandler;e.streamQueue.up=e.streamQueue.up.then(()=>m().then(()=>{v()}));var n=0,i=-1,s=[],u=pt,l={docs:{}},h=e.input.forkInstance.changeStream().subscribe(async _=>{if(_.context!==await e.downstreamBulkWriteFlag)return e.stats.up.forkChangeStreamEmit=e.stats.up.forkChangeStreamEmit+1,s.push({task:_,time:n++}),e.events.active.up.getValue()||e.events.active.up.next(!0),e.input.waitBeforePersist?e.input.waitBeforePersist().then(()=>v()):v()});fr(e.events.canceled.pipe(ye(_=>!!_))).then(()=>h.unsubscribe());async function m(){if(e.stats.up.upstreamInitialSync=e.stats.up.upstreamInitialSync+1,!e.events.canceled.getValue()){e.checkpointQueue=e.checkpointQueue.then(()=>Ni(e,"up"));for(var _=await e.checkpointQueue,O=new Set,D=async function(){i=n++,O.size>3&&await Promise.race(Array.from(O));var B=await hl(e.input.forkInstance,e.input.pushBatchSize,_);if(B.documents.length===0)return 1;_=Rn([_,B.checkpoint]);var z=g(B.documents,ae(_));O.add(z),z.catch().then(()=>O.delete(z))};!e.events.canceled.getValue()&&!await D(););var A=await Promise.all(O),L=A.find(B=>!!B);L?await m():!e.firstSyncDone.up.getValue()&&!e.events.canceled.getValue()&&e.firstSyncDone.up.next(!0)}}function v(){if(e.events.canceled.getValue()||s.length===0){e.events.active.up.next(!1);return}e.stats.up.processTasks=e.stats.up.processTasks+1,e.events.active.up.next(!0),e.streamQueue.up=e.streamQueue.up.then(()=>{for(var _=[],O={};s.length>0;){var D=ae(s.shift());D.time<i||(vr(_,D.task.events.map(L=>L.documentData)),O=Rn([O,D.task.checkpoint]))}var A=_.length===0?pt:g(_,O);return A.then(()=>{s.length===0?e.events.active.up.next(!1):v()})})}function g(_,O){return e.stats.up.persistToMaster=e.stats.up.persistToMaster+1,_.forEach(D=>{var A=D[e.primaryPath];l.docs[A]=D}),l.checkpoint=O,u=u.then(async()=>{if(e.events.canceled.getValue())return!1;var D=l.docs;l.docs={};var A=l.checkpoint,L=Object.keys(D);if(L.length===0)return!1;var B=await wl(e,L),z={},V=[],se={},X={};if(await Promise.all(L.map(async pe=>{var he=D[pe];X[pe]=he;var me=Wt(he,e.hasAttachments,!!e.input.keepMeta),oe=B[pe];oe&&oe.metaDocument.isResolvedConflict!==he._rev&&(await e.input.conflictHandler({realMasterState:oe.docData,newDocumentState:me},"upstream-check-if-equal")).isEqual||oe&&oe.docData._rev&&Qt(he._rev)===he._meta[e.input.identifier]||(V.push(pe),z[pe]={assumedMasterState:oe?oe.docData:void 0,newDocumentState:me},se[pe]=await Li(e,me,oe?oe.metaDocument:void 0))})),V.length===0)return!1;var ee=Object.values(z),Z=new Set,ue={},be=Uf(ee,e.input.pushBatchSize);await Promise.all(be.map(async pe=>{e.hasAttachments&&await Promise.all(pe.map(async me=>{me.newDocumentState=await Oo(e.primaryPath,e.input.forkInstance,Qe(me.newDocumentState),me.assumedMasterState)}));var he=await r.masterWrite(pe);he.forEach(me=>{var oe=me[e.primaryPath];Z.add(oe),ue[oe]=me})}));var xe=[];if(V.forEach(pe=>{Z.has(pe)||(e.events.processed.up.next(z[pe]),xe.push(se[pe]))}),e.events.canceled.getValue())return!1;xe.length>0&&await e.input.metaInstance.bulkWrite(So(e,xe),"replication-up-write-meta");var Ie=!1;if(Z.size>0){e.stats.up.persistToMasterHadConflicts=e.stats.up.persistToMasterHadConflicts+1;var le=[],we={};if(await Promise.all(Object.entries(ue).map(([pe,he])=>{var me=z[pe],oe={newDocumentState:me.newDocumentState,assumedMasterState:me.assumedMasterState,realMasterState:he};return Ov(e,oe,X[pe]).then(async Be=>{if(Be){e.events.resolvedConflicts.next({input:oe,output:Be.output}),le.push({previous:X[pe],document:Be.resolvedDoc});var xr=B[pe];we[pe]=await Li(e,ae(he),xr?xr.metaDocument:void 0,Be.resolvedDoc._rev)}})})),le.length>0){Ie=!0,e.stats.up.persistToMasterConflictWrites=e.stats.up.persistToMasterConflictWrites+1;var Le=await e.input.forkInstance.bulkWrite(le,"replication-up-write-conflict"),ke=[],ut=it(e.primaryPath,le,Le);ut.forEach(pe=>{var he=pe[e.primaryPath];ke.push(we[he])}),ke.length>0&&await e.input.metaInstance.bulkWrite(So(e,ke),"replication-up-write-conflict-meta")}}return $i(e,"up",A),Ie}).catch(D=>(e.events.error.next(D),!1)),u}}function xv(e){e=Se(e),e.forkInstance=Eo(e.forkInstance),e.metaInstance=Eo(e.metaInstance);var t=Sv(e),r={primaryPath:at(e.forkInstance.schema.primaryKey),hasAttachments:!!e.forkInstance.schema.attachments,input:e,checkpointKey:t,downstreamBulkWriteFlag:t.then(n=>"replication-downstream-"+n),events:{canceled:new cr(!1),active:{down:new cr(!0),up:new cr(!0)},processed:{down:new tt,up:new tt},resolvedConflicts:new tt,error:new tt},stats:{down:{addNewTask:0,downstreamProcessChanges:0,downstreamResyncOnce:0,masterChangeStreamEmit:0,persistFromMaster:0},up:{forkChangeStreamEmit:0,persistToMaster:0,persistToMasterConflictWrites:0,persistToMasterHadConflicts:0,processTasks:0,upstreamInitialSync:0}},firstSyncDone:{down:new cr(!1),up:new cr(!1)},streamQueue:{down:ft,up:ft},checkpointQueue:ft,lastCheckpointDoc:{}};return Ev(r),kv(r),r}function Iv(e){return fr(Ed([e.firstSyncDone.down.pipe(ye(t=>!!t)),e.firstSyncDone.up.pipe(ye(t=>!!t))])).then(()=>{})}function Pv(e,t,r,n=!1){e=Eo(e);var i=!!e.schema.attachments,s=at(e.schema.primaryKey),u={masterChangeStream$:e.changeStream().pipe(Ct(async l=>{var h={checkpoint:l.checkpoint,documents:await Promise.all(l.events.map(async m=>{var v=Wt(m.documentData,i,n);return i&&(v=await Oo(s,e,Qe(v),void 0)),v}))};return h})),masterChangesSince(l,h){return hl(e,h,l).then(async m=>({checkpoint:m.documents.length>0?m.checkpoint:l,documents:await Promise.all(m.documents.map(async v=>{var g=Wt(v,i,n);return i&&(g=await Oo(s,e,Qe(g),void 0)),g}))}))},async masterWrite(l){var h={};l.forEach(A=>{var L=A.newDocumentState[s];h[L]=A});var m=Object.keys(h),v=await e.findDocumentsById(m,!0),g=new Map;v.forEach(A=>g.set(A[s],A));var _=[],O=[];if(await Promise.all(Object.entries(h).map(async([A,L])=>{var B=g.get(A);B?B&&!L.assumedMasterState?_.push(Wt(B,i,n)):(await t({realMasterState:Wt(B,i,n),newDocumentState:ae(L.assumedMasterState)},"rxStorageInstanceToReplicationHandler-masterWrite")).isEqual===!0?O.push({previous:B,document:bu(r,i,n,L.newDocumentState,B)}):_.push(Wt(B,i,n)):O.push({document:bu(r,i,n,L.newDocumentState)})})),O.length>0){var D=await e.bulkWrite(O,"replication-master-write");D.error.forEach(A=>{if(A.status!==409)throw new Error("non conflict error");_.push(Wt(ae(A.documentInDb),i,n))})}return _}};return u}async function Dv(e){e.events.canceled.next(!0),e.events.active.up.complete(),e.events.active.down.complete(),e.events.processed.up.complete(),e.events.processed.down.complete(),e.events.resolvedConflicts.complete(),e.events.canceled.complete(),await e.checkpointQueue}var _l=["pre","post"],Sl=["insert","save","remove","create"],_u=!1,El=function(){function e(r,n,i,s,u={},l={},h={},m={},v={},g=ol,_={},O=Bi){this.storageInstance={},this.timeouts=new Set,this.incrementalWriteQueue={},this.awaitBeforeReads=new Set,this._incrementalUpsertQueues=new Map,this.synced=!1,this.hooks={},this._subs=[],this._docCache={},this._queryCache=Bm(),this.$={},this.checkpoint$={},this._changeEventBuffer={},this.onDestroy=[],this.destroyed=!1,this.onRemove=[],this.database=r,this.name=n,this.schema=i,this.internalStorageInstance=s,this.instanceCreationOptions=u,this.migrationStrategies=l,this.methods=h,this.attachments=m,this.options=v,this.cacheReplacementPolicy=g,this.statics=_,this.conflictHandler=O,Cv(this.asRxCollection)}var t=e.prototype;return t.prepare=async function(){this.storageInstance=es(this.database,this.internalStorageInstance,this.schema.jsonSchema),this.incrementalWriteQueue=new dl(this.storageInstance,this.schema.primaryPath,(h,m)=>ml(this,h,m),h=>this._runHooks("post","save",h));var n=this.database.eventBulks$.pipe(ye(h=>h.collectionName===this.name));this.$=n.pipe(Ct(h=>h.events)),this.checkpoint$=n.pipe(Te(h=>h.checkpoint)),this._changeEventBuffer=vv(this.asRxCollection);var i;this._docCache=new sl(this.schema.primaryPath,this.database.eventBulks$.pipe(ye(h=>h.collectionName===this.name&&!h.events[0].isLocal),Te(h=>h.events)),h=>(i||(i=bv(this.asRxCollection)),wv(this.asRxCollection,i,h)));var s=this.database.internalStore.changeStream().pipe(ye(h=>{var m=this.name+"-"+this.schema.version,v=h.events.find(g=>g.documentData.context==="collection"&&g.documentData.key===m&&g.operation==="DELETE");return!!v})).subscribe(async()=>{await this.destroy(),await Promise.all(this.onRemove.map(h=>h()))});this._subs.push(s);var u=await this.database.storageToken,l=this.storageInstance.changeStream().subscribe(h=>{for(var m=new Array(h.events.length),v=h.events,g=this.name,_=ge.deepFreezeWhenDevMode,O=0;O<v.length;O++){var D=v[O];m[O]={documentId:D.documentId,collectionName:g,isLocal:!1,operation:D.operation,documentData:_(D.documentData),previousDocumentData:_(D.previousDocumentData)}}var A={id:h.id,internal:!1,collectionName:this.name,storageToken:u,events:m,databaseToken:this.database.token,checkpoint:h.checkpoint,context:h.context,endTime:h.endTime,startTime:h.startTime};this.database.$emit(A)});return this._subs.push(l),this._subs.push(this.storageInstance.conflictResultionTasks().subscribe(h=>{this.conflictHandler(h.input,h.context).then(m=>{this.storageInstance.resolveConflictResultionTask({id:h.id,output:m})})})),ft},t.cleanup=function(n){throw lt(this),ve("cleanup")},t.migrationNeeded=function(){throw ve("migration-schema")},t.getMigrationState=function(){throw ve("migration-schema")},t.startMigration=function(n=10){return lt(this),this.getMigrationState().startMigration(n)},t.migratePromise=function(n=10){return this.getMigrationState().migratePromise(n)},t.insert=async function(n){lt(this);var i=await this.bulkInsert([n]),s=i.error[0];Ti(this,n[this.schema.primaryPath],n,s);var u=ae(i.success[0]);return u},t.bulkInsert=async function(n){if(lt(this),n.length===0)return{success:[],error:[]};var i=this.schema.primaryPath,s=new Set,u;if(this.hasHooks("pre","insert"))u=await Promise.all(n.map(L=>{var B=_i(this.schema,L);return this._runHooks("pre","insert",B).then(()=>(s.add(B[i]),{document:B}))}));else{u=new Array(n.length);for(var l=this.schema,h=0;h<n.length;h++){var m=n[h],v=_i(l,m);s.add(v[i]),u[h]={document:v}}}if(s.size!==n.length)throw G("COL22",{collection:this.name,args:{documents:n}});var g=await this.storageInstance.bulkWrite(u,"rx-collection-bulk-insert"),_,O=this,D={get success(){if(!_){var L=it(O.schema.primaryPath,u,g);_=ul(O._docCache,L)}return _},error:g.error};if(this.hasHooks("post","insert")){var A=new Map;u.forEach(L=>{var B=L.document;A.set(B[i],B)}),await Promise.all(D.success.map(L=>this._runHooks("post","insert",A.get(L.primary),L)))}return D},t.bulkRemove=async function(n){lt(this);var i=this.schema.primaryPath;if(n.length===0)return{success:[],error:[]};var s=await this.findByIds(n).exec(),u=[],l=new Map;Array.from(s.values()).forEach(O=>{var D=O.toMutableJSON(!0);u.push(D),l.set(O.primary,D)}),await Promise.all(u.map(O=>{var D=O[this.schema.primaryPath];return this._runHooks("pre","remove",O,s.get(D))}));var h=u.map(O=>{var D=Se(O);return D._deleted=!0,{previous:O,document:D}}),m=await this.storageInstance.bulkWrite(h,"rx-collection-bulk-remove"),v=it(this.schema.primaryPath,h,m),g=v.map(O=>O[i]);await Promise.all(g.map(O=>this._runHooks("post","remove",l.get(O),s.get(O))));var _=g.map(O=>yr(s,O));return{success:_,error:m.error}},t.bulkUpsert=async function(n){lt(this);var i=[],s=new Map;n.forEach(m=>{var v=_i(this.schema,m),g=v[this.schema.primaryPath];if(!g)throw G("COL3",{primaryPath:this.schema.primaryPath,data:v,schema:this.schema.jsonSchema});s.set(g,v),i.push(v)});var u=await this.bulkInsert(i),l=u.success.slice(0),h=[];return await Promise.all(u.error.map(async m=>{if(m.status!==409)h.push(m);else{var v=m.documentId,g=yr(s,v),_=ae(m.documentInDb),O=this._docCache.getCachedRxDocuments([_])[0],D=await O.incrementalModify(()=>g);l.push(D)}})),{error:h,success:l}},t.upsert=async function(n){lt(this);var i=await this.bulkUpsert([n]);return Ti(this.asRxCollection,n[this.schema.primaryPath],n,i.error[0]),i.success[0]},t.incrementalUpsert=function(n){lt(this);var i=_i(this.schema,n),s=i[this.schema.primaryPath];if(!s)throw G("COL4",{data:n});var u=this._incrementalUpsertQueues.get(s);return u||(u=ft),u=u.then(()=>Av(this,s,i)).then(l=>l.inserted?l.doc:Rv(l.doc,i)),this._incrementalUpsertQueues.set(s,u),u},t.find=function(n){if(lt(this),typeof n=="string")throw G("COL5",{queryObj:n});n||(n=xi());var i=Nr("find",n,this);return i},t.findOne=function(n){if(lt(this),typeof n=="number"||Array.isArray(n))throw Ze("COL6",{queryObj:n});var i;if(typeof n=="string")i=Nr("findOne",{selector:{[this.schema.primaryPath]:n},limit:1},this);else{if(n||(n=xi()),n.limit)throw G("QU6");n=Se(n),n.limit=1,i=Nr("findOne",n,this)}return i},t.count=function(n){lt(this),n||(n=xi());var i=Nr("count",n,this);return i},t.findByIds=function(n){lt(this);var i={selector:{[this.schema.primaryPath]:{$in:n.slice(0)}}},s=Nr("findByIds",i,this);return s},t.exportJSON=function(){throw ve("json-dump")},t.importJSON=function(n){throw ve("json-dump")},t.insertCRDT=function(n){throw ve("crdt")},t.addPipeline=function(n){throw ve("pipeline")},t.addHook=function(n,i,s,u=!1){if(typeof s!="function")throw Ze("COL7",{key:i,when:n});if(!_l.includes(n))throw Ze("COL8",{key:i,when:n});if(!Sl.includes(i))throw G("COL9",{key:i});if(n==="post"&&i==="create"&&u===!0)throw G("COL10",{when:n,key:i,parallel:u});var l=s.bind(this),h=u?"parallel":"series";this.hooks[i]=this.hooks[i]||{},this.hooks[i][n]=this.hooks[i][n]||{series:[],parallel:[]},this.hooks[i][n][h].push(l)},t.getHooks=function(n,i){return!this.hooks[i]||!this.hooks[i][n]?{series:[],parallel:[]}:this.hooks[i][n]},t.hasHooks=function(n,i){if(!this.hooks[i]||!this.hooks[i][n])return!1;var s=this.getHooks(n,i);return s?s.series.length>0||s.parallel.length>0:!1},t._runHooks=function(n,i,s,u){var l=this.getHooks(n,i);if(!l)return ft;var h=l.series.map(m=>()=>m(s,u));return yh(h).then(()=>Promise.all(l.parallel.map(m=>m(s,u))))},t._runHooksSync=function(n,i,s,u){if(this.hasHooks(n,i)){var l=this.getHooks(n,i);l&&l.series.forEach(h=>h(s,u))}},t.promiseWait=function(n){var i=new Promise(s=>{var u=setTimeout(()=>{this.timeouts.delete(u),s()},n);this.timeouts.add(u)});return i},t.destroy=async function(){return this.destroyed?pt:(await Promise.all(this.onDestroy.map(n=>n())),this.destroyed=!0,Array.from(this.timeouts).forEach(n=>clearTimeout(n)),this._changeEventBuffer&&this._changeEventBuffer.destroy(),this.database.requestIdlePromise().then(()=>this.storageInstance.close()).then(()=>(this._subs.forEach(n=>n.unsubscribe()),delete this.database.collections[this.name],Tn("postDestroyRxCollection",this).then(()=>!0))))},t.remove=async function(){await this.destroy(),await Promise.all(this.onRemove.map(n=>n())),await bl(this.database.storage,this.database.internalStore,this.database.token,this.database.name,this.name,this.database.password,this.database.hashFunction)},Gt(e,[{key:"insert$",get:function(){return this.$.pipe(ye(r=>r.operation==="INSERT"))}},{key:"update$",get:function(){return this.$.pipe(ye(r=>r.operation==="UPDATE"))}},{key:"remove$",get:function(){return this.$.pipe(ye(r=>r.operation==="DELETE"))}},{key:"asRxCollection",get:function(){return this}}])}();function Cv(e){if(!_u){_u=!0;var t=Object.getPrototypeOf(e);Sl.forEach(r=>{_l.map(n=>{var i=n+Gu(r);t[i]=function(s,u){return this.addHook(n,r,s,u)}})})}}function Rv(e,t){return e.incrementalModify(r=>t)}function Av(e,t,r){var n=e._docCache.getLatestDocumentDataIfExists(t);return n?Promise.resolve({doc:e._docCache.getCachedRxDocuments([n])[0],inserted:!1}):e.findOne(t).exec().then(i=>i?{doc:i,inserted:!1}:e.insert(r).then(s=>({doc:s,inserted:!0})))}function Mv({database:e,name:t,schema:r,instanceCreationOptions:n={},migrationStrategies:i={},autoMigrate:s=!0,statics:u={},methods:l={},attachments:h={},options:m={},localDocuments:v=!1,cacheReplacementPolicy:g=ol,conflictHandler:_=Bi}){var O={databaseInstanceToken:e.token,databaseName:e.name,collectionName:t,schema:r.jsonSchema,options:n,multiInstance:e.multiInstance,password:e.password,devMode:ge.isDevMode()};return dt("preCreateRxStorageInstance",O),pv(e,O).then(D=>{var A=new El(e,t,r,D,n,i,l,h,m,g,u,_);return A.prepare().then(()=>{Object.entries(u).forEach(([B,z])=>{Object.defineProperty(A,B,{get:()=>z.bind(A)})});var L=ft;return s&&A.schema.version!==0&&(L=A.migratePromise()),L}).then(()=>(dt("createRxCollection",{collection:A,creator:{name:t,schema:r,storageInstance:D,instanceCreationOptions:n,migrationStrategies:i,methods:l,attachments:h,options:m,cacheReplacementPolicy:g,localDocuments:v,statics:u}}),A)).catch(L=>D.close().then(()=>Promise.reject(L)))})}var Ol=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this._parallels=t||1,this._qC=0,this._iC=new Set,this._lHN=0,this._hPM=new Map,this._pHM=new Map};Ol.prototype={isIdle:function(){return this._qC<this._parallels},lock:function(){this._qC++},unlock:function(){this._qC--,ko(this)},wrapCall:function(t){var r=this;this.lock();var n;try{n=t()}catch(i){throw this.unlock(),i}return!n.then||typeof n.then!="function"?(this.unlock(),n):n.then(function(i){return r.unlock(),i}).catch(function(i){throw r.unlock(),i})},requestIdlePromise:function(t){var r=this;t=t||{};var n,i=new Promise(function(l){return n=l}),s=function(){Xa(r,i),n()};if(i._manRes=s,t.timeout){var u=setTimeout(function(){i._manRes()},t.timeout);i._timeoutObj=u}return this._iC.add(i),ko(this),i},cancelIdlePromise:function(t){Xa(this,t)},requestIdleCallback:function(t,r){var n=this._lHN++,i=this.requestIdlePromise(r);return this._hPM.set(n,i),this._pHM.set(i,n),i.then(function(){return t()}),n},cancelIdleCallback:function(t){var r=this._hPM.get(t);this.cancelIdlePromise(r)},clear:function(){var t=this;this._iC.forEach(function(r){return Xa(t,r)}),this._qC=0,this._iC.clear(),this._hPM=new Map,this._pHM=new Map}};function Tv(e){if(e._iC.size!==0){var t=e._iC.values(),r=t.next().value;r._manRes(),setTimeout(function(){return ko(e)},0)}}function Xa(e,t){if(t){if(t._timeoutObj&&clearTimeout(t._timeoutObj),e._pHM.has(t)){var r=e._pHM.get(t);e._hPM.delete(r),e._pHM.delete(t)}e._iC.delete(t)}}function ko(e){e._tryIR||e._iC.size===0||(e._tryIR=!0,setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}Tv(e),e._tryIR=!1},0)},0))}class ns{constructor(t){bi(this,"ttl");bi(this,"map",new Map);bi(this,"_to",!1);this.ttl=t}has(t){return this.map.has(t)}add(t){this.map.set(t,kl()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,Nv(this)},0))}clear(){this.map.clear()}}function Nv(e){const t=kl()-e.ttl,r=e.map[Symbol.iterator]();for(;;){const n=r.next().value;if(!n)return;const i=n[0];if(n[1]<t)e.map.delete(i);else return}}function kl(){return Date.now()}var ji=new Set,is=function(){function e(r,n,i,s,u,l,h=!1,m={},v,g,_,O,D){this.idleQueue=new Ol,this.rxdbVersion=Zu,this.storageInstances=new Set,this._subs=[],this.startupErrors=[],this.onDestroy=[],this.destroyed=!1,this.collections={},this.states={},this.eventBulks$=new tt,this.observable$=this.eventBulks$.pipe(Ct(A=>A.events)),this.storageToken=pt,this.storageTokenDocument=pt,this.emittedEventBulkIds=new ns(60*1e3),this.name=r,this.token=n,this.storage=i,this.instanceCreationOptions=s,this.password=u,this.multiInstance=l,this.eventReduce=h,this.options=m,this.internalStore=v,this.hashFunction=g,this.cleanupPolicy=_,this.allowSlowCount=O,this.reactivity=D,this.name!=="pseudoInstance"&&(this.internalStore=es(this.asRxDatabase,v,rs),this.storageTokenDocument=fv(this.asRxDatabase).catch(A=>this.startupErrors.push(A)),this.storageToken=this.storageTokenDocument.then(A=>A.data.token).catch(A=>this.startupErrors.push(A)))}var t=e.prototype;return t.getReactivityFactory=function(){if(!this.reactivity)throw G("DB14",{database:this.name});return this.reactivity},t.$emit=function(n){this.emittedEventBulkIds.has(n.id)||(this.emittedEventBulkIds.add(n.id),this.eventBulks$.next(n))},t.removeCollectionDoc=async function(n,i){var s=await Fn(this.internalStore,Qr(_o(n,i),pr));if(!s)throw G("SNH",{name:n,schema:i});var u=Un(s);u._deleted=!0,await this.internalStore.bulkWrite([{document:u,previous:s}],"rx-database-remove-collection")},t.addCollections=async function(n){var i={},s={},u=[],l={};await Promise.all(Object.entries(n).map(async([v,g])=>{var _=v,O=g.schema;i[_]=O;var D=Bh(O,this.hashFunction);if(s[_]=D,this.collections[v])throw G("DB3",{name:v});var A=_o(v,O),L={id:Qr(A,pr),key:A,context:pr,data:{name:_,schemaHash:await D.hash,schema:D.jsonSchema,version:D.version,connectedStorages:[]},_deleted:!1,_meta:_r(),_rev:ht(),_attachments:{}};u.push({document:L});var B=Object.assign({},g,{name:_,schema:D,database:this}),z=Se(g);z.database=this,z.name=v,dt("preCreateRxCollection",z),B.conflictHandler=z.conflictHandler,l[_]=B}));var h=await this.internalStore.bulkWrite(u,"rx-database-add-collection");await jv(this),await Promise.all(h.error.map(async v=>{if(v.status!==409)throw G("DB12",{database:this.name,writeError:v});var g=ae(v.documentInDb),_=g.data.name,O=s[_];if(g.data.schemaHash!==await O.hash)throw G("DB6",{database:this.name,collection:_,previousSchemaHash:g.data.schemaHash,schemaHash:await O.hash,previousSchema:g.data.schema,schema:ae(i[_])})}));var m={};return await Promise.all(Object.keys(n).map(async v=>{var g=l[v],_=await Mv(g);m[v]=_,this.collections[v]=_,this[v]||Object.defineProperty(this,v,{get:()=>this.collections[v]})})),m},t.lockedRun=function(n){return this.idleQueue.wrapCall(n)},t.requestIdlePromise=function(){return this.idleQueue.requestIdlePromise()},t.exportJSON=function(n){throw ve("json-dump")},t.addState=function(n){throw ve("state")},t.importJSON=function(n){throw ve("json-dump")},t.backup=function(n){throw ve("backup")},t.leaderElector=function(){throw ve("leader-election")},t.isLeader=function(){throw ve("leader-election")},t.waitForLeadership=function(){throw ve("leader-election")},t.migrationStates=function(){throw ve("migration-schema")},t.destroy=async function(){return this.destroyed||(this.destroyed=!0,await Tn("preDestroyRxDatabase",this),this.eventBulks$.complete(),this._subs.map(n=>n.unsubscribe()),this.name==="pseudoInstance")?pt:this.requestIdlePromise().then(()=>Promise.all(this.onDestroy.map(n=>n()))).then(()=>Promise.all(Object.keys(this.collections).map(n=>this.collections[n]).map(n=>n.destroy()))).then(()=>this.internalStore.close()).then(()=>ji.delete(this.storage.name+"|"+this.name)).then(()=>!0)},t.remove=function(){return this.destroy().then(()=>Lv(this.name,this.storage,this.password))},Gt(e,[{key:"$",get:function(){return this.observable$}},{key:"asRxDatabase",get:function(){return this}}])}();function $v(e,t){var r=t.name+"|"+e;if(ji.has(r))throw G("DB8",{name:e,storage:t.name,link:"https://rxdb.info/rx-database.html#ignoreduplicate"})}async function xl(e,t,r,n,i,s){var u=await t.createStorageInstance({databaseInstanceToken:e,databaseName:r,collectionName:ev,schema:rs,options:n,multiInstance:i,password:s,devMode:ge.isDevMode()});return u}function rb({storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:i=!0,eventReduce:s=!0,ignoreDuplicate:u=!1,options:l={},cleanupPolicy:h,allowSlowCount:m=!1,localDocuments:v=!1,hashFunction:g=Vu,reactivity:_}){dt("preCreateRxDatabase",{storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:i,eventReduce:s,ignoreDuplicate:u,options:l,localDocuments:v}),u||$v(r,e),ji.add(e.name+"|"+r);var O=An(10);return xl(O,e,r,t,i,n).catch(D=>{throw ji.delete(e.name+"|"+r),D}).then(D=>{var A=new is(r,O,e,t,n,i,s,l,D,g,h,m,_);return Tn("createRxDatabase",{database:A,creator:{storage:e,instanceCreationOptions:t,name:r,password:n,multiInstance:i,eventReduce:s,ignoreDuplicate:u,options:l,localDocuments:v}}).then(()=>A)})}async function Lv(e,t,r){var n=An(10),i=await xl(n,t,e,{},!1,r),s=await yl(i),u=new Set;s.forEach(h=>u.add(h.data.name));var l=Array.from(u);return await Promise.all(l.map(h=>bl(t,i,n,e,h,r))),await Tn("postRemoveRxDatabase",{databaseName:e,storage:t}),await i.remove(),l}function Bv(e){return e instanceof is}async function jv(e){if(await e.storageToken,e.startupErrors[0])throw e.startupErrors[0]}var Kv={RxSchema:ic.prototype,RxDocument:Ji,RxQuery:cl.prototype,RxCollection:El.prototype,RxDatabase:is.prototype},Za=new Set,Su=new Set;function qv(e){if(dt("preAddRxPlugin",{plugin:e,plugins:Za}),!Za.has(e)){{if(Su.has(e.name))throw G("PL3",{name:e.name,plugin:e});Za.add(e),Su.add(e.name)}if(!e.rxdb)throw Ze("PL1",{plugin:e});e.init&&e.init(),e.prototypes&&Object.entries(e.prototypes).forEach(([t,r])=>r(Kv[t])),e.overwritable&&Object.assign(ge,e.overwritable),e.hooks&&Object.entries(e.hooks).forEach(([t,r])=>{r.after&&kn[t].push(r.after),r.before&&kn[t].unshift(r.before)})}}function Fv(e){return e&&typeof e.then=="function"}Promise.resolve(!1);var Uv=Promise.resolve(!0),xt=Promise.resolve();function lr(e,t){return e||(e=0),new Promise(function(r){return setTimeout(function(){return r(t)},e)})}function Wv(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function Wn(){return Math.random().toString(36).substring(2)}var eo=0;function Hn(){var e=Date.now()*1e3;return e<=eo&&(e=eo+1),eo=e,e}function Hv(){return typeof navigator<"u"&&typeof navigator.locks<"u"&&typeof navigator.locks.request=="function"}var zv=Hn,Qv="native";function Vv(e){var t={time:Hn(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(r){t.messagesCallback&&t.messagesCallback(r.data)},t}function Gv(e){e.bc.close(),e.subFns=[]}function Yv(e,t){try{return e.bc.postMessage(t,!1),xt}catch(r){return Promise.reject(r)}}function Jv(e,t){e.messagesCallback=t}function Xv(){if(typeof globalThis<"u"&&globalThis.Deno&&globalThis.Deno.args)return!0;if((typeof window<"u"||typeof self<"u")&&typeof BroadcastChannel=="function"){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}else return!1}function Zv(){return 150}var ey={create:Vv,close:Gv,onMessage:Jv,postMessage:Yv,canBeUsed:Xv,type:Qv,averageResponseTime:Zv,microSeconds:zv};function as(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return typeof t.webWorkerSupport>"u"&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=1e3*45),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&typeof e.idb.onclose=="function"&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=1e3*60),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=1e3*60*2),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),typeof t.node.useFastPath>"u"&&(t.node.useFastPath=!0),t}var ty=Hn,ry="pubkey.broadcast-channel-0-",Tt="messages",Xi={durability:"relaxed"},ny="idb";function Il(){if(typeof indexedDB<"u")return indexedDB;if(typeof window<"u"){if(typeof window.mozIndexedDB<"u")return window.mozIndexedDB;if(typeof window.webkitIndexedDB<"u")return window.webkitIndexedDB;if(typeof window.msIndexedDB<"u")return window.msIndexedDB}return!1}function os(e){e.commit&&e.commit()}function iy(e){var t=Il(),r=ry+e,n=t.open(r);return n.onupgradeneeded=function(i){var s=i.target.result;s.createObjectStore(Tt,{keyPath:"id",autoIncrement:!0})},new Promise(function(i,s){n.onerror=function(u){return s(u)},n.onsuccess=function(){i(n.result)}})}function ay(e,t,r){var n=Date.now(),i={uuid:t,time:n,data:r},s=e.transaction([Tt],"readwrite",Xi);return new Promise(function(u,l){s.oncomplete=function(){return u()},s.onerror=function(m){return l(m)};var h=s.objectStore(Tt);h.add(i),os(s)})}function oy(e,t){var r=e.transaction(Tt,"readonly",Xi),n=r.objectStore(Tt),i=[],s=IDBKeyRange.bound(t+1,1/0);if(n.getAll){var u=n.getAll(s);return new Promise(function(h,m){u.onerror=function(v){return m(v)},u.onsuccess=function(v){h(v.target.result)}})}function l(){try{return s=IDBKeyRange.bound(t+1,1/0),n.openCursor(s)}catch{return n.openCursor()}}return new Promise(function(h,m){var v=l();v.onerror=function(g){return m(g)},v.onsuccess=function(g){var _=g.target.result;_?_.value.id<t+1?_.continue(t+1):(i.push(_.value),_.continue()):(os(r),h(i))}})}function sy(e,t){if(e.closed)return Promise.resolve([]);var r=e.db.transaction(Tt,"readwrite",Xi),n=r.objectStore(Tt);return Promise.all(t.map(function(i){var s=n.delete(i);return new Promise(function(u){s.onsuccess=function(){return u()}})}))}function uy(e,t){var r=Date.now()-t,n=e.transaction(Tt,"readonly",Xi),i=n.objectStore(Tt),s=[];return new Promise(function(u){i.openCursor().onsuccess=function(l){var h=l.target.result;if(h){var m=h.value;m.time<r?(s.push(m),h.continue()):(os(n),u(s))}else u(s)}})}function cy(e){return uy(e.db,e.options.idb.ttl).then(function(t){return sy(e,t.map(function(r){return r.id}))})}function ly(e,t){return t=as(t),iy(e).then(function(r){var n={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:Wn(),eMIs:new ns(t.idb.ttl*2),writeBlockPromise:xt,messagesCallback:null,readQueuePromises:[],db:r};return r.onclose=function(){n.closed=!0,t.idb.onclose&&t.idb.onclose()},Pl(n),n})}function Pl(e){e.closed||Dl(e).then(function(){return lr(e.options.idb.fallbackInterval)}).then(function(){return Pl(e)})}function fy(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}function Dl(e){return e.closed||!e.messagesCallback?xt:oy(e.db,e.lastCursorId).then(function(t){var r=t.filter(function(n){return!!n}).map(function(n){return n.id>e.lastCursorId&&(e.lastCursorId=n.id),n}).filter(function(n){return fy(n,e)}).sort(function(n,i){return n.time-i.time});return r.forEach(function(n){e.messagesCallback&&(e.eMIs.add(n.id),e.messagesCallback(n.data))}),xt})}function hy(e){e.closed=!0,e.db.close()}function dy(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return ay(e.db,e.uuid,t)}).then(function(){Wv(0,10)===0&&cy(e)}),e.writeBlockPromise}function py(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,Dl(e)}function my(){return!!Il()}function vy(e){return e.idb.fallbackInterval*2}var yy={create:ly,close:hy,onMessage:py,postMessage:dy,canBeUsed:my,type:ny,averageResponseTime:vy,microSeconds:ty},gy=Hn,by="pubkey.broadcastChannel-",wy="localstorage";function Cl(){var e;if(typeof window>"u")return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch{}return e}function Rl(e){return by+e}function _y(e,t){return new Promise(function(r){lr().then(function(){var n=Rl(e.channelName),i={token:Wn(),time:Date.now(),data:t,uuid:e.uuid},s=JSON.stringify(i);Cl().setItem(n,s);var u=document.createEvent("Event");u.initEvent("storage",!0,!0),u.key=n,u.newValue=s,window.dispatchEvent(u),r()})})}function Sy(e,t){var r=Rl(e),n=function(s){s.key===r&&t(JSON.parse(s.newValue))};return window.addEventListener("storage",n),n}function Ey(e){window.removeEventListener("storage",e)}function Oy(e,t){if(t=as(t),!Al())throw new Error("BroadcastChannel: localstorage cannot be used");var r=Wn(),n=new ns(t.localstorage.removeTimeout),i={channelName:e,uuid:r,eMIs:n};return i.listener=Sy(e,function(s){i.messagesCallback&&s.uuid!==r&&(!s.token||n.has(s.token)||s.data.time&&s.data.time<i.messagesCallbackTime||(n.add(s.token),i.messagesCallback(s.data)))}),i}function ky(e){Ey(e.listener)}function xy(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t}function Al(){var e=Cl();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch{return!1}return!0}function Iy(){var e=120,t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?e*2:e}var Py={create:Oy,close:ky,onMessage:xy,postMessage:_y,canBeUsed:Al,type:wy,averageResponseTime:Iy,microSeconds:gy},Ml=Hn,Dy="simulate",ss=new Set;function Cy(e){var t={time:Ml(),name:e,messagesCallback:null};return ss.add(t),t}function Ry(e){ss.delete(e)}var Tl=5;function Ay(e,t){return new Promise(function(r){return setTimeout(function(){var n=Array.from(ss);n.forEach(function(i){i.name===e.name&&i!==e&&i.messagesCallback&&i.time<t.time&&i.messagesCallback(t)}),r()},Tl)})}function My(e,t){e.messagesCallback=t}function Ty(){return!0}function Ny(){return Tl}var $y={create:Cy,close:Ry,onMessage:My,postMessage:Ay,canBeUsed:Ty,type:Dy,averageResponseTime:Ny,microSeconds:Ml},Eu=[ey,yy,Py];function Ly(e){var t=[].concat(e.methods,Eu).filter(Boolean);if(e.type){if(e.type==="simulate")return $y;var r=t.find(function(i){return i.type===e.type});if(r)return r;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter(function(i){return i.type!=="idb"}));var n=t.find(function(i){return i.canBeUsed()});if(n)return n;throw new Error("No usable method found in "+JSON.stringify(Eu.map(function(i){return i.type})))}var Nl=new Set,By=0,Zi=function(t,r){this.id=By++,Nl.add(this),this.name=t,this.options=as(r),this.method=Ly(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,jy(this)};Zi._pubkey=!0;Zi.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return Ou(this,"message",t)},postInternal:function(t){return Ou(this,"internal",t)},set onmessage(e){var t=this.method.microSeconds(),r={time:t,fn:e};xu(this,"message",this._onML),e&&typeof e=="function"?(this._onML=r,ku(this,"message",r)):this._onML=null},addEventListener:function(t,r){var n=this.method.microSeconds(),i={time:n,fn:r};ku(this,t,i)},removeEventListener:function(t,r){var n=this._addEL[t].find(function(i){return i.fn===r});xu(this,t,n)},close:function(){var t=this;if(!this.closed){Nl.delete(this),this.closed=!0;var r=this._prepP?this._prepP:xt;return this._onML=null,this._addEL.message=[],r.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(n){return n()}))}).then(function(){return t.method.close(t._state)})}},get type(){return this.method.type},get isClosed(){return this.closed}};function Ou(e,t,r){var n=e.method.microSeconds(),i={time:n,type:t,data:r},s=e._prepP?e._prepP:xt;return s.then(function(){var u=e.method.postMessage(e._state,i);return e._uMP.add(u),u.catch().then(function(){return e._uMP.delete(u)}),u})}function jy(e){var t=e.method.create(e.name,e.options);Fv(t)?(e._prepP=t,t.then(function(r){e._state=r})):e._state=t}function $l(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function ku(e,t,r){e._addEL[t].push(r),Ky(e)}function xu(e,t,r){e._addEL[t]=e._addEL[t].filter(function(n){return n!==r}),qy(e)}function Ky(e){if(!e._iL&&$l(e)){var t=function(i){e._addEL[i.type].forEach(function(s){i.time>=s.time&&s.fn(i.data)})},r=e.method.microSeconds();e._prepP?e._prepP.then(function(){e._iL=!0,e.method.onMessage(e._state,t,r)}):(e._iL=!0,e.method.onMessage(e._state,t,r))}}function qy(e){if(e._iL&&!$l(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}function Fy(e){if(typeof WorkerGlobalScope=="function"&&self instanceof WorkerGlobalScope){var t=self.close.bind(self);self.close=function(){return e(),t()}}else{if(typeof window.addEventListener!="function")return;window.addEventListener("beforeunload",function(){e()},!0),window.addEventListener("unload",function(){e()},!0)}}function Uy(e){process.on("exit",function(){return e()}),process.on("beforeExit",function(){return e().then(function(){return process.exit()})}),process.on("SIGINT",function(){return e().then(function(){return process.exit()})}),process.on("uncaughtException",function(t){return e().then(function(){console.trace(t),process.exit(101)})})}var Wy=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",Hy=Wy?Uy:Fy,gn=new Set,Iu=!1;function zy(){Iu||(Iu=!0,Hy(Vy))}function Qy(e){if(zy(),typeof e!="function")throw new Error("Listener is no function");gn.add(e);var t={remove:function(){return gn.delete(e)},run:function(){return gn.delete(e),e()}};return t}function Vy(){var e=[];return gn.forEach(function(t){e.push(t()),gn.delete(t)}),Promise.all(e)}function mr(e,t){var r={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(r)}function Ll(e){e.isLeader=!0,e._hasLeader=!0;var t=Qy(function(){return e.die()});e._unl.push(t);var r=function(i){i.context==="leader"&&i.action==="apply"&&mr(e,"tell"),i.context==="leader"&&i.action==="tell"&&!e._dpLC&&(e._dpLC=!0,e._dpL(),mr(e,"tell"))};return e.broadcastChannel.addEventListener("internal",r),e._lstns.push(r),mr(e,"tell")}var Bl=function(t,r){var n=this;this.broadcastChannel=t,t._befC.push(function(){return n.die()}),this._options=r,this.isLeader=!1,this.isDead=!1,this.token=Wn(),this._lstns=[],this._unl=[],this._dpL=function(){},this._dpLC=!1,this._wKMC={},this.lN="pubkey-bc||"+t.method.type+"||"+t.name};Bl.prototype={hasLeader:function(){var t=this;return navigator.locks.query().then(function(r){var n=r.held?r.held.filter(function(i){return i.name===t.lN}):[];return!!(n&&n.length>0)})},awaitLeadership:function(){var t=this;if(!this._wLMP){this._wKMC.c=new AbortController;var r=new Promise(function(n,i){t._wKMC.res=n,t._wKMC.rej=i});this._wLMP=new Promise(function(n){navigator.locks.request(t.lN,{signal:t._wKMC.c.signal},function(){return t._wKMC.c=void 0,Ll(t),n(),r}).catch(function(){})})}return this._wLMP},set onduplicate(e){},die:function(){var t=this;return this._lstns.forEach(function(r){return t.broadcastChannel.removeEventListener("internal",r)}),this._lstns=[],this._unl.forEach(function(r){return r.remove()}),this._unl=[],this.isLeader&&(this.isLeader=!1),this.isDead=!0,this._wKMC.res&&this._wKMC.res(),this._wKMC.c&&this._wKMC.c.abort("LeaderElectionWebLock.die() called"),mr(this,"death")}};var jl=function(t,r){var n=this;this.broadcastChannel=t,this._options=r,this.isLeader=!1,this._hasLeader=!1,this.isDead=!1,this.token=Wn(),this._aplQ=xt,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var i=function(u){u.context==="leader"&&(u.action==="death"&&(n._hasLeader=!1),u.action==="tell"&&(n._hasLeader=!0))};this.broadcastChannel.addEventListener("internal",i),this._lstns.push(i)};jl.prototype={hasLeader:function(){return Promise.resolve(this._hasLeader)},applyOnce:function(t){var r=this;if(this.isLeader)return lr(0,!0);if(this.isDead)return lr(0,!1);if(this._aplQC>1)return this._aplQ;var n=function(){if(r.isLeader)return Uv;var s=!1,u,l=new Promise(function(v){u=function(){s=!0,v()}}),h=function(g){g.context==="leader"&&g.token!=r.token&&(g.action==="apply"&&g.token>r.token&&u(),g.action==="tell"&&(u(),r._hasLeader=!0))};r.broadcastChannel.addEventListener("internal",h);var m=t?r._options.responseTime*4:r._options.responseTime;return mr(r,"apply").then(function(){return Promise.race([lr(m),l.then(function(){return Promise.reject(new Error)})])}).then(function(){return mr(r,"apply")}).then(function(){return Promise.race([lr(m),l.then(function(){return Promise.reject(new Error)})])}).catch(function(){}).then(function(){return r.broadcastChannel.removeEventListener("internal",h),s?!1:Ll(r).then(function(){return!0})})};return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then(function(){return n()}).then(function(){r._aplQC=r._aplQC-1}),this._aplQ.then(function(){return r.isLeader})},awaitLeadership:function(){return this._aLP||(this._aLP=Gy(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var t=this;return this._lstns.forEach(function(r){return t.broadcastChannel.removeEventListener("internal",r)}),this._lstns=[],this._unl.forEach(function(r){return r.remove()}),this._unl=[],this.isLeader&&(this._hasLeader=!1,this.isLeader=!1),this.isDead=!0,mr(this,"death")}};function Gy(e){return e.isLeader?xt:new Promise(function(t){var r=!1;function n(){r||(r=!0,e.broadcastChannel.removeEventListener("internal",s),t(!0))}e.applyOnce().then(function(){e.isLeader&&n()});var i=function u(){return lr(e._options.fallbackInterval).then(function(){if(!(e.isDead||r))if(e.isLeader)n();else return e.applyOnce(!0).then(function(){e.isLeader?n():u()})})};i();var s=function(l){l.context==="leader"&&l.action==="death"&&(e._hasLeader=!1,e.applyOnce().then(function(){e.isLeader&&n()}))};e.broadcastChannel.addEventListener("internal",s),e._lstns.push(s)})}function Yy(e,t){return e||(e={}),e=JSON.parse(JSON.stringify(e)),e.fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options)),e}function Jy(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=Yy(t,e);var r=Hv()?new Bl(e,t):new jl(e,t);return e._befC.push(function(){return r.die()}),e._leaderElector=r,r}var Ki=new Map;function Xy(e,t,r,n){var i=Ki.get(t);return i||(i={bc:new Zi(["RxDB:",e,r].join("|")),refs:new Set},Ki.set(t,i)),i.refs.add(n),i.bc}function Pu(e,t){var r=Ki.get(e);if(r&&(r.refs.delete(t),r.refs.size===0))return Ki.delete(e),r.bc.close()}function Zy(e,t,r,n){if(t.multiInstance){var i=Xy(e,t.databaseInstanceToken,r.databaseName,r),s=new tt,u=_=>{_.storageName===e&&_.databaseName===t.databaseName&&_.collectionName===t.collectionName&&_.version===t.schema.version&&s.next(_.eventBulk)};i.addEventListener("message",u);var l=r.changeStream(),h=!1,m=l.subscribe(_=>{h||i.postMessage({storageName:e,databaseName:t.databaseName,collectionName:t.collectionName,version:t.schema.version,eventBulk:_})});r.changeStream=function(){return s.asObservable().pipe(Ad(l))};var v=r.close.bind(r);r.close=async function(){return h=!0,m.unsubscribe(),i.removeEventListener("message",u),await Pu(t.databaseInstanceToken,r),v()};var g=r.remove.bind(r);r.remove=async function(){return h=!0,m.unsubscribe(),i.removeEventListener("message",u),await Pu(t.databaseInstanceToken,r),g()}}}var Kl={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Us,function(){var r=function(a,o){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,f){c.__proto__=f}||function(c,f){for(var d in f)Object.prototype.hasOwnProperty.call(f,d)&&(c[d]=f[d])})(a,o)},n=function(){return(n=Object.assign||function(a){for(var o,c=1,f=arguments.length;c<f;c++)for(var d in o=arguments[c])Object.prototype.hasOwnProperty.call(o,d)&&(a[d]=o[d]);return a}).apply(this,arguments)};function i(a,o,c){for(var f,d=0,p=o.length;d<p;d++)!f&&d in o||((f=f||Array.prototype.slice.call(o,0,d))[d]=o[d]);return a.concat(f||Array.prototype.slice.call(o))}var s=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Us,u=Object.keys,l=Array.isArray;function h(a,o){return typeof o!="object"||u(o).forEach(function(c){a[c]=o[c]}),a}typeof Promise>"u"||s.Promise||(s.Promise=Promise);var m=Object.getPrototypeOf,v={}.hasOwnProperty;function g(a,o){return v.call(a,o)}function _(a,o){typeof o=="function"&&(o=o(m(a))),(typeof Reflect>"u"?u:Reflect.ownKeys)(o).forEach(function(c){D(a,c,o[c])})}var O=Object.defineProperty;function D(a,o,c,f){O(a,o,h(c&&g(c,"get")&&typeof c.get=="function"?{get:c.get,set:c.set,configurable:!0}:{value:c,configurable:!0,writable:!0},f))}function A(a){return{from:function(o){return a.prototype=Object.create(o.prototype),D(a.prototype,"constructor",a),{extend:_.bind(null,a.prototype)}}}}var L=Object.getOwnPropertyDescriptor,B=[].slice;function z(a,o,c){return B.call(a,o,c)}function V(a,o){return o(a)}function se(a){if(!a)throw new Error("Assertion Failed")}function X(a){s.setImmediate?setImmediate(a):setTimeout(a,0)}function ee(a,o){if(typeof o=="string"&&g(a,o))return a[o];if(!o)return a;if(typeof o!="string"){for(var c=[],f=0,d=o.length;f<d;++f){var p=ee(a,o[f]);c.push(p)}return c}var y=o.indexOf(".");if(y!==-1){var b=a[o.substr(0,y)];return b==null?void 0:ee(b,o.substr(y+1))}}function Z(a,o,c){if(a&&o!==void 0&&!("isFrozen"in Object&&Object.isFrozen(a)))if(typeof o!="string"&&"length"in o){se(typeof c!="string"&&"length"in c);for(var f=0,d=o.length;f<d;++f)Z(a,o[f],c[f])}else{var p,y,b=o.indexOf(".");b!==-1?(p=o.substr(0,b),(y=o.substr(b+1))===""?c===void 0?l(a)&&!isNaN(parseInt(p))?a.splice(p,1):delete a[p]:a[p]=c:Z(b=!(b=a[p])||!g(a,p)?a[p]={}:b,y,c)):c===void 0?l(a)&&!isNaN(parseInt(o))?a.splice(o,1):delete a[o]:a[o]=c}}function ue(a){var o,c={};for(o in a)g(a,o)&&(c[o]=a[o]);return c}var be=[].concat;function xe(a){return be.apply([],a)}var Et="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(xe([8,16,32,64].map(function(a){return["Int","Uint","Float"].map(function(o){return o+a+"Array"})}))).filter(function(a){return s[a]}),Ie=new Set(Et.map(function(a){return s[a]})),le=null;function we(a){return le=new WeakMap,a=function o(c){if(!c||typeof c!="object")return c;var f=le.get(c);if(f)return f;if(l(c)){f=[],le.set(c,f);for(var d=0,p=c.length;d<p;++d)f.push(o(c[d]))}else if(Ie.has(c.constructor))f=c;else{var y,b=m(c);for(y in f=b===Object.prototype?{}:Object.create(b),le.set(c,f),c)g(c,y)&&(f[y]=o(c[y]))}return f}(a),le=null,a}var Le={}.toString;function ke(a){return Le.call(a).slice(8,-1)}var ut=typeof Symbol<"u"?Symbol.iterator:"@@iterator",pe=typeof ut=="symbol"?function(a){var o;return a!=null&&(o=a[ut])&&o.apply(a)}:function(){return null};function he(a,o){return o=a.indexOf(o),0<=o&&a.splice(o,1),0<=o}var me={};function oe(a){var o,c,f,d;if(arguments.length===1){if(l(a))return a.slice();if(this===me&&typeof a=="string")return[a];if(d=pe(a)){for(c=[];!(f=d.next()).done;)c.push(f.value);return c}if(a==null)return[a];if(typeof(o=a.length)!="number")return[a];for(c=new Array(o);o--;)c[o]=a[o];return c}for(o=arguments.length,c=new Array(o);o--;)c[o]=arguments[o];return c}var Be=typeof Symbol<"u"?function(a){return a[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},tn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ct=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(tn),xr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ce(a,o){this.name=a,this.message=o}function Ve(a,o){return a+". Errors: "+Object.keys(o).map(function(c){return o[c].toString()}).filter(function(c,f,d){return d.indexOf(c)===f}).join(`
`)}function _t(a,o,c,f){this.failures=o,this.failedKeys=f,this.successCount=c,this.message=Ve(a,o)}function $t(a,o){this.name="BulkError",this.failures=Object.keys(o).map(function(c){return o[c]}),this.failuresByPos=o,this.message=Ve(a,this.failures)}A(Ce).from(Error).extend({toString:function(){return this.name+": "+this.message}}),A(_t).from(Ce),A($t).from(Ce);var ra=ct.reduce(function(a,o){return a[o]=o+"Error",a},{}),af=Ce,J=ct.reduce(function(a,o){var c=o+"Error";function f(d,p){this.name=c,d?typeof d=="string"?(this.message="".concat(d).concat(p?`
 `+p:""),this.inner=p||null):typeof d=="object"&&(this.message="".concat(d.name," ").concat(d.message),this.inner=d):(this.message=xr[o]||c,this.inner=null)}return A(f).from(af),a[o]=f,a},{});J.Syntax=SyntaxError,J.Type=TypeError,J.Range=RangeError;var cs=tn.reduce(function(a,o){return a[o+"Error"]=J[o],a},{}),zn=ct.reduce(function(a,o){return["Syntax","Type","Range"].indexOf(o)===-1&&(a[o+"Error"]=J[o]),a},{});function de(){}function Zr(a){return a}function of(a,o){return a==null||a===Zr?o:function(c){return o(a(c))}}function Yt(a,o){return function(){a.apply(this,arguments),o.apply(this,arguments)}}function sf(a,o){return a===de?o:function(){var c=a.apply(this,arguments);c!==void 0&&(arguments[0]=c);var f=this.onsuccess,d=this.onerror;this.onsuccess=null,this.onerror=null;var p=o.apply(this,arguments);return f&&(this.onsuccess=this.onsuccess?Yt(f,this.onsuccess):f),d&&(this.onerror=this.onerror?Yt(d,this.onerror):d),p!==void 0?p:c}}function uf(a,o){return a===de?o:function(){a.apply(this,arguments);var c=this.onsuccess,f=this.onerror;this.onsuccess=this.onerror=null,o.apply(this,arguments),c&&(this.onsuccess=this.onsuccess?Yt(c,this.onsuccess):c),f&&(this.onerror=this.onerror?Yt(f,this.onerror):f)}}function cf(a,o){return a===de?o:function(c){var f=a.apply(this,arguments);h(c,f);var d=this.onsuccess,p=this.onerror;return this.onsuccess=null,this.onerror=null,c=o.apply(this,arguments),d&&(this.onsuccess=this.onsuccess?Yt(d,this.onsuccess):d),p&&(this.onerror=this.onerror?Yt(p,this.onerror):p),f===void 0?c===void 0?void 0:c:h(f,c)}}function lf(a,o){return a===de?o:function(){return o.apply(this,arguments)!==!1&&a.apply(this,arguments)}}function na(a,o){return a===de?o:function(){var c=a.apply(this,arguments);if(c&&typeof c.then=="function"){for(var f=this,d=arguments.length,p=new Array(d);d--;)p[d]=arguments[d];return c.then(function(){return o.apply(f,p)})}return o.apply(this,arguments)}}zn.ModifyError=_t,zn.DexieError=Ce,zn.BulkError=$t;var mt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ls(a){mt=a}var en={},fs=100,Et=typeof Promise>"u"?[]:function(){var a=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[a,m(a),a];var o=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[o,m(o),a]}(),tn=Et[0],ct=Et[1],Et=Et[2],ct=ct&&ct.then,Jt=tn&&tn.constructor,ia=!!Et,rn=function(a,o){nn.push([a,o]),Qn&&(queueMicrotask(hf),Qn=!1)},aa=!0,Qn=!0,Xt=[],Vn=[],oa=Zr,Lt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:de,pgp:!1,env:{},finalize:de},Y=Lt,nn=[],Zt=0,Gn=[];function H(a){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var o=this._PSD=Y;if(typeof a!="function"){if(a!==en)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&ua(this,this._value))}this._state=null,this._value=null,++o.ref,function c(f,d){try{d(function(p){if(f._state===null){if(p===f)throw new TypeError("A promise cannot be resolved with itself.");var y=f._lib&&Ir();p&&typeof p.then=="function"?c(f,function(b,S){p instanceof H?p._then(b,S):p.then(b,S)}):(f._state=!0,f._value=p,ds(f)),y&&Pr()}},ua.bind(null,f))}catch(p){ua(f,p)}}(this,a)}var sa={get:function(){var a=Y,o=Zn;function c(f,d){var p=this,y=!a.global&&(a!==Y||o!==Zn),b=y&&!jt(),S=new H(function(k,P){ca(p,new hs(ms(f,a,y,b),ms(d,a,y,b),k,P,a))});return this._consoleTask&&(S._consoleTask=this._consoleTask),S}return c.prototype=en,c},set:function(a){D(this,"then",a&&a.prototype===en?sa:{get:function(){return a},set:sa.set})}};function hs(a,o,c,f,d){this.onFulfilled=typeof a=="function"?a:null,this.onRejected=typeof o=="function"?o:null,this.resolve=c,this.reject=f,this.psd=d}function ua(a,o){var c,f;Vn.push(o),a._state===null&&(c=a._lib&&Ir(),o=oa(o),a._state=!1,a._value=o,f=a,Xt.some(function(d){return d._value===f._value})||Xt.push(f),ds(a),c&&Pr())}function ds(a){var o=a._listeners;a._listeners=[];for(var c=0,f=o.length;c<f;++c)ca(a,o[c]);var d=a._PSD;--d.ref||d.finalize(),Zt===0&&(++Zt,rn(function(){--Zt==0&&la()},[]))}function ca(a,o){if(a._state!==null){var c=a._state?o.onFulfilled:o.onRejected;if(c===null)return(a._state?o.resolve:o.reject)(a._value);++o.psd.ref,++Zt,rn(ff,[c,a,o])}else a._listeners.push(o)}function ff(a,o,c){try{var f,d=o._value;!o._state&&Vn.length&&(Vn=[]),f=mt&&o._consoleTask?o._consoleTask.run(function(){return a(d)}):a(d),o._state||Vn.indexOf(d)!==-1||function(p){for(var y=Xt.length;y;)if(Xt[--y]._value===p._value)return Xt.splice(y,1)}(o),c.resolve(f)}catch(p){c.reject(p)}finally{--Zt==0&&la(),--c.psd.ref||c.psd.finalize()}}function hf(){er(Lt,function(){Ir()&&Pr()})}function Ir(){var a=aa;return Qn=aa=!1,a}function Pr(){var a,o,c;do for(;0<nn.length;)for(a=nn,nn=[],c=a.length,o=0;o<c;++o){var f=a[o];f[0].apply(null,f[1])}while(0<nn.length);Qn=aa=!0}function la(){var a=Xt;Xt=[],a.forEach(function(f){f._PSD.onunhandled.call(null,f._value,f)});for(var o=Gn.slice(0),c=o.length;c;)o[--c]()}function Yn(a){return new H(en,!1,a)}function Ee(a,o){var c=Y;return function(){var f=Ir(),d=Y;try{return Kt(c,!0),a.apply(this,arguments)}catch(p){o&&o(p)}finally{Kt(d,!1),f&&Pr()}}}_(H.prototype,{then:sa,_then:function(a,o){ca(this,new hs(null,null,a,o,Y))},catch:function(a){if(arguments.length===1)return this.then(null,a);var o=a,c=arguments[1];return typeof o=="function"?this.then(null,function(f){return(f instanceof o?c:Yn)(f)}):this.then(null,function(f){return(f&&f.name===o?c:Yn)(f)})},finally:function(a){return this.then(function(o){return H.resolve(a()).then(function(){return o})},function(o){return H.resolve(a()).then(function(){return Yn(o)})})},timeout:function(a,o){var c=this;return a<1/0?new H(function(f,d){var p=setTimeout(function(){return d(new J.Timeout(o))},a);c.then(f,d).finally(clearTimeout.bind(null,p))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&D(H.prototype,Symbol.toStringTag,"Dexie.Promise"),Lt.env=ps(),_(H,{all:function(){var a=oe.apply(null,arguments).map(ei);return new H(function(o,c){a.length===0&&o([]);var f=a.length;a.forEach(function(d,p){return H.resolve(d).then(function(y){a[p]=y,--f||o(a)},c)})})},resolve:function(a){return a instanceof H?a:a&&typeof a.then=="function"?new H(function(o,c){a.then(o,c)}):new H(en,!0,a)},reject:Yn,race:function(){var a=oe.apply(null,arguments).map(ei);return new H(function(o,c){a.map(function(f){return H.resolve(f).then(o,c)})})},PSD:{get:function(){return Y},set:function(a){return Y=a}},totalEchoes:{get:function(){return Zn}},newPSD:Bt,usePSD:er,scheduler:{get:function(){return rn},set:function(a){rn=a}},rejectionMapper:{get:function(){return oa},set:function(a){oa=a}},follow:function(a,o){return new H(function(c,f){return Bt(function(d,p){var y=Y;y.unhandleds=[],y.onunhandled=p,y.finalize=Yt(function(){var b,S=this;b=function(){S.unhandleds.length===0?d():p(S.unhandleds[0])},Gn.push(function k(){b(),Gn.splice(Gn.indexOf(k),1)}),++Zt,rn(function(){--Zt==0&&la()},[])},y.finalize),a()},o,c,f)})}}),Jt&&(Jt.allSettled&&D(H,"allSettled",function(){var a=oe.apply(null,arguments).map(ei);return new H(function(o){a.length===0&&o([]);var c=a.length,f=new Array(c);a.forEach(function(d,p){return H.resolve(d).then(function(y){return f[p]={status:"fulfilled",value:y}},function(y){return f[p]={status:"rejected",reason:y}}).then(function(){return--c||o(f)})})})}),Jt.any&&typeof AggregateError<"u"&&D(H,"any",function(){var a=oe.apply(null,arguments).map(ei);return new H(function(o,c){a.length===0&&c(new AggregateError([]));var f=a.length,d=new Array(f);a.forEach(function(p,y){return H.resolve(p).then(function(b){return o(b)},function(b){d[y]=b,--f||c(new AggregateError(d))})})})}),Jt.withResolvers&&(H.withResolvers=Jt.withResolvers));var Ne={awaits:0,echoes:0,id:0},df=0,Jn=[],Xn=0,Zn=0,pf=0;function Bt(a,o,c,f){var d=Y,p=Object.create(d);return p.parent=d,p.ref=0,p.global=!1,p.id=++pf,Lt.env,p.env=ia?{Promise:H,PromiseProp:{value:H,configurable:!0,writable:!0},all:H.all,race:H.race,allSettled:H.allSettled,any:H.any,resolve:H.resolve,reject:H.reject}:{},o&&h(p,o),++d.ref,p.finalize=function(){--this.parent.ref||this.parent.finalize()},f=er(p,a,c,f),p.ref===0&&p.finalize(),f}function Dr(){return Ne.id||(Ne.id=++df),++Ne.awaits,Ne.echoes+=fs,Ne.id}function jt(){return!!Ne.awaits&&(--Ne.awaits==0&&(Ne.id=0),Ne.echoes=Ne.awaits*fs,!0)}function ei(a){return Ne.echoes&&a&&a.constructor===Jt?(Dr(),a.then(function(o){return jt(),o},function(o){return jt(),Pe(o)})):a}function mf(){var a=Jn[Jn.length-1];Jn.pop(),Kt(a,!1)}function Kt(a,o){var c,f=Y;(o?!Ne.echoes||Xn++&&a===Y:!Xn||--Xn&&a===Y)||queueMicrotask(o?(function(d){++Zn,Ne.echoes&&--Ne.echoes!=0||(Ne.echoes=Ne.awaits=Ne.id=0),Jn.push(Y),Kt(d,!0)}).bind(null,a):mf),a!==Y&&(Y=a,f===Lt&&(Lt.env=ps()),ia&&(c=Lt.env.Promise,o=a.env,(f.global||a.global)&&(Object.defineProperty(s,"Promise",o.PromiseProp),c.all=o.all,c.race=o.race,c.resolve=o.resolve,c.reject=o.reject,o.allSettled&&(c.allSettled=o.allSettled),o.any&&(c.any=o.any))))}function ps(){var a=s.Promise;return ia?{Promise:a,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:a.all,race:a.race,allSettled:a.allSettled,any:a.any,resolve:a.resolve,reject:a.reject}:{}}function er(a,o,c,f,d){var p=Y;try{return Kt(a,!0),o(c,f,d)}finally{Kt(p,!1)}}function ms(a,o,c,f){return typeof a!="function"?a:function(){var d=Y;c&&Dr(),Kt(o,!0);try{return a.apply(this,arguments)}finally{Kt(d,!1),f&&queueMicrotask(jt)}}}function fa(a){Promise===Jt&&Ne.echoes===0?Xn===0?a():enqueueNativeMicroTask(a):setTimeout(a,0)}(""+ct).indexOf("[native code]")===-1&&(Dr=jt=de);var Pe=H.reject,tr="￿",St="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",vs="String expected.",Cr=[],ti="__dbnames",ha="readonly",da="readwrite";function rr(a,o){return a?o?function(){return a.apply(this,arguments)&&o.apply(this,arguments)}:a:o}var ys={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ri(a){return typeof a!="string"||/\./.test(a)?function(o){return o}:function(o){return o[a]===void 0&&a in o&&delete(o=we(o))[a],o}}function gs(){throw J.Type()}function ce(a,o){try{var c=bs(a),f=bs(o);if(c!==f)return c==="Array"?1:f==="Array"?-1:c==="binary"?1:f==="binary"?-1:c==="string"?1:f==="string"?-1:c==="Date"?1:f!=="Date"?NaN:-1;switch(c){case"number":case"Date":case"string":return o<a?1:a<o?-1:0;case"binary":return function(d,p){for(var y=d.length,b=p.length,S=y<b?y:b,k=0;k<S;++k)if(d[k]!==p[k])return d[k]<p[k]?-1:1;return y===b?0:y<b?-1:1}(ws(a),ws(o));case"Array":return function(d,p){for(var y=d.length,b=p.length,S=y<b?y:b,k=0;k<S;++k){var P=ce(d[k],p[k]);if(P!==0)return P}return y===b?0:y<b?-1:1}(a,o)}}catch{}return NaN}function bs(a){var o=typeof a;return o!="object"?o:ArrayBuffer.isView(a)?"binary":(a=ke(a),a==="ArrayBuffer"?"binary":a)}function ws(a){return a instanceof Uint8Array?a:ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a)}var _s=(_e.prototype._trans=function(a,o,c){var f=this._tx||Y.trans,d=this.name,p=mt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(a==="readonly"?"read":"write"," ").concat(this.name));function y(k,P,w){if(!w.schema[d])throw new J.NotFound("Table "+d+" not part of transaction");return o(w.idbtrans,w)}var b=Ir();try{var S=f&&f.db._novip===this.db._novip?f===Y.trans?f._promise(a,y,c):Bt(function(){return f._promise(a,y,c)},{trans:f,transless:Y.transless||Y}):function k(P,w,R,E){if(P.idbdb&&(P._state.openComplete||Y.letThrough||P._vip)){var I=P._createTransaction(w,R,P._dbSchema);try{I.create(),P._state.PR1398_maxLoop=3}catch(C){return C.name===ra.InvalidState&&P.isOpen()&&0<--P._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),P.close({disableAutoOpen:!1}),P.open().then(function(){return k(P,w,R,E)})):Pe(C)}return I._promise(w,function(C,x){return Bt(function(){return Y.trans=I,E(C,x,I)})}).then(function(C){if(w==="readwrite")try{I.idbtrans.commit()}catch{}return w==="readonly"?C:I._completion.then(function(){return C})})}if(P._state.openComplete)return Pe(new J.DatabaseClosed(P._state.dbOpenError));if(!P._state.isBeingOpened){if(!P._state.autoOpen)return Pe(new J.DatabaseClosed);P.open().catch(de)}return P._state.dbReadyPromise.then(function(){return k(P,w,R,E)})}(this.db,a,[this.name],y);return p&&(S._consoleTask=p,S=S.catch(function(k){return console.trace(k),Pe(k)})),S}finally{b&&Pr()}},_e.prototype.get=function(a,o){var c=this;return a&&a.constructor===Object?this.where(a).first(o):a==null?Pe(new J.Type("Invalid argument to Table.get()")):this._trans("readonly",function(f){return c.core.get({trans:f,key:a}).then(function(d){return c.hook.reading.fire(d)})}).then(o)},_e.prototype.where=function(a){if(typeof a=="string")return new this.db.WhereClause(this,a);if(l(a))return new this.db.WhereClause(this,"[".concat(a.join("+"),"]"));var o=u(a);if(o.length===1)return this.where(o[0]).equals(a[o[0]]);var c=this.schema.indexes.concat(this.schema.primKey).filter(function(b){if(b.compound&&o.every(function(k){return 0<=b.keyPath.indexOf(k)})){for(var S=0;S<o.length;++S)if(o.indexOf(b.keyPath[S])===-1)return!1;return!0}return!1}).sort(function(b,S){return b.keyPath.length-S.keyPath.length})[0];if(c&&this.db._maxKey!==tr){var p=c.keyPath.slice(0,o.length);return this.where(p).equals(p.map(function(S){return a[S]}))}!c&&mt&&console.warn("The query ".concat(JSON.stringify(a)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(o.join("+"),"]"));var f=this.schema.idxByName;function d(b,S){return ce(b,S)===0}var y=o.reduce(function(w,S){var k=w[0],P=w[1],w=f[S],R=a[S];return[k||w,k||!w?rr(P,w&&w.multi?function(E){return E=ee(E,S),l(E)&&E.some(function(I){return d(R,I)})}:function(E){return d(R,ee(E,S))}):P]},[null,null]),p=y[0],y=y[1];return p?this.where(p.name).equals(a[p.keyPath]).filter(y):c?this.filter(y):this.where(o).equals("")},_e.prototype.filter=function(a){return this.toCollection().and(a)},_e.prototype.count=function(a){return this.toCollection().count(a)},_e.prototype.offset=function(a){return this.toCollection().offset(a)},_e.prototype.limit=function(a){return this.toCollection().limit(a)},_e.prototype.each=function(a){return this.toCollection().each(a)},_e.prototype.toArray=function(a){return this.toCollection().toArray(a)},_e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},_e.prototype.orderBy=function(a){return new this.db.Collection(new this.db.WhereClause(this,l(a)?"[".concat(a.join("+"),"]"):a))},_e.prototype.reverse=function(){return this.toCollection().reverse()},_e.prototype.mapToClass=function(a){var o,c=this.db,f=this.name;function d(){return o!==null&&o.apply(this,arguments)||this}(this.schema.mappedClass=a).prototype instanceof gs&&(function(S,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function P(){this.constructor=S}r(S,k),S.prototype=k===null?Object.create(k):(P.prototype=k.prototype,new P)}(d,o=a),Object.defineProperty(d.prototype,"db",{get:function(){return c},enumerable:!1,configurable:!0}),d.prototype.table=function(){return f},a=d);for(var p=new Set,y=a.prototype;y;y=m(y))Object.getOwnPropertyNames(y).forEach(function(S){return p.add(S)});function b(S){if(!S)return S;var k,P=Object.create(a.prototype);for(k in S)if(!p.has(k))try{P[k]=S[k]}catch{}return P}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=b,this.hook("reading",b),a},_e.prototype.defineClass=function(){return this.mapToClass(function(a){h(this,a)})},_e.prototype.add=function(a,o){var c=this,f=this.schema.primKey,d=f.auto,p=f.keyPath,y=a;return p&&d&&(y=ri(p)(a)),this._trans("readwrite",function(b){return c.core.mutate({trans:b,type:"add",keys:o!=null?[o]:null,values:[y]})}).then(function(b){return b.numFailures?H.reject(b.failures[0]):b.lastResult}).then(function(b){if(p)try{Z(a,p,b)}catch{}return b})},_e.prototype.update=function(a,o){return typeof a!="object"||l(a)?this.where(":id").equals(a).modify(o):(a=ee(a,this.schema.primKey.keyPath),a===void 0?Pe(new J.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(a).modify(o))},_e.prototype.put=function(a,o){var c=this,f=this.schema.primKey,d=f.auto,p=f.keyPath,y=a;return p&&d&&(y=ri(p)(a)),this._trans("readwrite",function(b){return c.core.mutate({trans:b,type:"put",values:[y],keys:o!=null?[o]:null})}).then(function(b){return b.numFailures?H.reject(b.failures[0]):b.lastResult}).then(function(b){if(p)try{Z(a,p,b)}catch{}return b})},_e.prototype.delete=function(a){var o=this;return this._trans("readwrite",function(c){return o.core.mutate({trans:c,type:"delete",keys:[a]})}).then(function(c){return c.numFailures?H.reject(c.failures[0]):void 0})},_e.prototype.clear=function(){var a=this;return this._trans("readwrite",function(o){return a.core.mutate({trans:o,type:"deleteRange",range:ys})}).then(function(o){return o.numFailures?H.reject(o.failures[0]):void 0})},_e.prototype.bulkGet=function(a){var o=this;return this._trans("readonly",function(c){return o.core.getMany({keys:a,trans:c}).then(function(f){return f.map(function(d){return o.hook.reading.fire(d)})})})},_e.prototype.bulkAdd=function(a,o,c){var f=this,d=Array.isArray(o)?o:void 0,p=(c=c||(d?void 0:o))?c.allKeys:void 0;return this._trans("readwrite",function(y){var k=f.schema.primKey,b=k.auto,k=k.keyPath;if(k&&d)throw new J.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(d&&d.length!==a.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var S=a.length,k=k&&b?a.map(ri(k)):a;return f.core.mutate({trans:y,type:"add",keys:d,values:k,wantResults:p}).then(function(I){var w=I.numFailures,R=I.results,E=I.lastResult,I=I.failures;if(w===0)return p?R:E;throw new $t("".concat(f.name,".bulkAdd(): ").concat(w," of ").concat(S," operations failed"),I)})})},_e.prototype.bulkPut=function(a,o,c){var f=this,d=Array.isArray(o)?o:void 0,p=(c=c||(d?void 0:o))?c.allKeys:void 0;return this._trans("readwrite",function(y){var k=f.schema.primKey,b=k.auto,k=k.keyPath;if(k&&d)throw new J.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(d&&d.length!==a.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var S=a.length,k=k&&b?a.map(ri(k)):a;return f.core.mutate({trans:y,type:"put",keys:d,values:k,wantResults:p}).then(function(I){var w=I.numFailures,R=I.results,E=I.lastResult,I=I.failures;if(w===0)return p?R:E;throw new $t("".concat(f.name,".bulkPut(): ").concat(w," of ").concat(S," operations failed"),I)})})},_e.prototype.bulkUpdate=function(a){var o=this,c=this.core,f=a.map(function(y){return y.key}),d=a.map(function(y){return y.changes}),p=[];return this._trans("readwrite",function(y){return c.getMany({trans:y,keys:f,cache:"clone"}).then(function(b){var S=[],k=[];a.forEach(function(w,R){var E=w.key,I=w.changes,C=b[R];if(C){for(var x=0,M=Object.keys(I);x<M.length;x++){var T=M[x],N=I[T];if(T===o.schema.primKey.keyPath){if(ce(N,E)!==0)throw new J.Constraint("Cannot update primary key in bulkUpdate()")}else Z(C,T,N)}p.push(R),S.push(E),k.push(C)}});var P=S.length;return c.mutate({trans:y,type:"put",keys:S,values:k,updates:{keys:f,changeSpecs:d}}).then(function(w){var R=w.numFailures,E=w.failures;if(R===0)return P;for(var I=0,C=Object.keys(E);I<C.length;I++){var x,M=C[I],T=p[Number(M)];T!=null&&(x=E[M],delete E[M],E[T]=x)}throw new $t("".concat(o.name,".bulkUpdate(): ").concat(R," of ").concat(P," operations failed"),E)})})})},_e.prototype.bulkDelete=function(a){var o=this,c=a.length;return this._trans("readwrite",function(f){return o.core.mutate({trans:f,type:"delete",keys:a})}).then(function(y){var d=y.numFailures,p=y.lastResult,y=y.failures;if(d===0)return p;throw new $t("".concat(o.name,".bulkDelete(): ").concat(d," of ").concat(c," operations failed"),y)})},_e);function _e(){}function an(a){function o(y,b){if(b){for(var S=arguments.length,k=new Array(S-1);--S;)k[S-1]=arguments[S];return c[y].subscribe.apply(null,k),a}if(typeof y=="string")return c[y]}var c={};o.addEventType=p;for(var f=1,d=arguments.length;f<d;++f)p(arguments[f]);return o;function p(y,b,S){if(typeof y!="object"){var k;b=b||lf;var P={subscribers:[],fire:S=S||de,subscribe:function(w){P.subscribers.indexOf(w)===-1&&(P.subscribers.push(w),P.fire=b(P.fire,w))},unsubscribe:function(w){P.subscribers=P.subscribers.filter(function(R){return R!==w}),P.fire=P.subscribers.reduce(b,S)}};return c[y]=o[y]=P}u(k=y).forEach(function(w){var R=k[w];if(l(R))p(w,k[w][0],k[w][1]);else{if(R!=="asap")throw new J.InvalidArgument("Invalid event config");var E=p(w,Zr,function(){for(var I=arguments.length,C=new Array(I);I--;)C[I]=arguments[I];E.subscribers.forEach(function(x){X(function(){x.apply(null,C)})})})}})}}function on(a,o){return A(o).from({prototype:a}),o}function Rr(a,o){return!(a.filter||a.algorithm||a.or)&&(o?a.justLimit:!a.replayFilter)}function pa(a,o){a.filter=rr(a.filter,o)}function ma(a,o,c){var f=a.replayFilter;a.replayFilter=f?function(){return rr(f(),o())}:o,a.justLimit=c&&!f}function ni(a,o){if(a.isPrimKey)return o.primaryKey;var c=o.getIndexByKeyPath(a.index);if(!c)throw new J.Schema("KeyPath "+a.index+" on object store "+o.name+" is not indexed");return c}function Ss(a,o,c){var f=ni(a,o.schema);return o.openCursor({trans:c,values:!a.keysOnly,reverse:a.dir==="prev",unique:!!a.unique,query:{index:f,range:a.range}})}function ii(a,o,c,f){var d=a.replayFilter?rr(a.filter,a.replayFilter()):a.filter;if(a.or){var p={},y=function(b,S,k){var P,w;d&&!d(S,k,function(R){return S.stop(R)},function(R){return S.fail(R)})||((w=""+(P=S.primaryKey))=="[object ArrayBuffer]"&&(w=""+new Uint8Array(P)),g(p,w)||(p[w]=!0,o(b,S,k)))};return Promise.all([a.or._iterate(y,c),Es(Ss(a,f,c),a.algorithm,y,!a.keysOnly&&a.valueMapper)])}return Es(Ss(a,f,c),rr(a.algorithm,d),o,!a.keysOnly&&a.valueMapper)}function Es(a,o,c,f){var d=Ee(f?function(p,y,b){return c(f(p),y,b)}:c);return a.then(function(p){if(p)return p.start(function(){var y=function(){return p.continue()};o&&!o(p,function(b){return y=b},function(b){p.stop(b),y=de},function(b){p.fail(b),y=de})||d(p.value,p,function(b){return y=b}),y()})})}var Et=Symbol(),sn=(Os.prototype.execute=function(a){if(this.add!==void 0){var o=this.add;if(l(o))return i(i([],l(a)?a:[],!0),o).sort();if(typeof o=="number")return(Number(a)||0)+o;if(typeof o=="bigint")try{return BigInt(a)+o}catch{return BigInt(0)+o}throw new TypeError("Invalid term ".concat(o))}if(this.remove!==void 0){var c=this.remove;if(l(c))return l(a)?a.filter(function(f){return!c.includes(f)}).sort():[];if(typeof c=="number")return Number(a)-c;if(typeof c=="bigint")try{return BigInt(a)-c}catch{return BigInt(0)-c}throw new TypeError("Invalid subtrahend ".concat(c))}return o=(o=this.replacePrefix)===null||o===void 0?void 0:o[0],o&&typeof a=="string"&&a.startsWith(o)?this.replacePrefix[1]+a.substring(o.length):a},Os);function Os(a){Object.assign(this,a)}var vf=(fe.prototype._read=function(a,o){var c=this._ctx;return c.error?c.table._trans(null,Pe.bind(null,c.error)):c.table._trans("readonly",a).then(o)},fe.prototype._write=function(a){var o=this._ctx;return o.error?o.table._trans(null,Pe.bind(null,o.error)):o.table._trans("readwrite",a,"locked")},fe.prototype._addAlgorithm=function(a){var o=this._ctx;o.algorithm=rr(o.algorithm,a)},fe.prototype._iterate=function(a,o){return ii(this._ctx,a,o,this._ctx.table.core)},fe.prototype.clone=function(a){var o=Object.create(this.constructor.prototype),c=Object.create(this._ctx);return a&&h(c,a),o._ctx=c,o},fe.prototype.raw=function(){return this._ctx.valueMapper=null,this},fe.prototype.each=function(a){var o=this._ctx;return this._read(function(c){return ii(o,a,c,o.table.core)})},fe.prototype.count=function(a){var o=this;return this._read(function(c){var f=o._ctx,d=f.table.core;if(Rr(f,!0))return d.count({trans:c,query:{index:ni(f,d.schema),range:f.range}}).then(function(y){return Math.min(y,f.limit)});var p=0;return ii(f,function(){return++p,!1},c,d).then(function(){return p})}).then(a)},fe.prototype.sortBy=function(a,o){var c=a.split(".").reverse(),f=c[0],d=c.length-1;function p(S,k){return k?p(S[c[k]],k-1):S[f]}var y=this._ctx.dir==="next"?1:-1;function b(S,k){return ce(p(S,d),p(k,d))*y}return this.toArray(function(S){return S.sort(b)}).then(o)},fe.prototype.toArray=function(a){var o=this;return this._read(function(c){var f=o._ctx;if(f.dir==="next"&&Rr(f,!0)&&0<f.limit){var d=f.valueMapper,p=ni(f,f.table.core.schema);return f.table.core.query({trans:c,limit:f.limit,values:!0,query:{index:p,range:f.range}}).then(function(b){return b=b.result,d?b.map(d):b})}var y=[];return ii(f,function(b){return y.push(b)},c,f.table.core).then(function(){return y})},a)},fe.prototype.offset=function(a){var o=this._ctx;return a<=0||(o.offset+=a,Rr(o)?ma(o,function(){var c=a;return function(f,d){return c===0||(c===1?--c:d(function(){f.advance(c),c=0}),!1)}}):ma(o,function(){var c=a;return function(){return--c<0}})),this},fe.prototype.limit=function(a){return this._ctx.limit=Math.min(this._ctx.limit,a),ma(this._ctx,function(){var o=a;return function(c,f,d){return--o<=0&&f(d),0<=o}},!0),this},fe.prototype.until=function(a,o){return pa(this._ctx,function(c,f,d){return!a(c.value)||(f(d),o)}),this},fe.prototype.first=function(a){return this.limit(1).toArray(function(o){return o[0]}).then(a)},fe.prototype.last=function(a){return this.reverse().first(a)},fe.prototype.filter=function(a){var o;return pa(this._ctx,function(c){return a(c.value)}),(o=this._ctx).isMatch=rr(o.isMatch,a),this},fe.prototype.and=function(a){return this.filter(a)},fe.prototype.or=function(a){return new this.db.WhereClause(this._ctx.table,a,this)},fe.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},fe.prototype.desc=function(){return this.reverse()},fe.prototype.eachKey=function(a){var o=this._ctx;return o.keysOnly=!o.isMatch,this.each(function(c,f){a(f.key,f)})},fe.prototype.eachUniqueKey=function(a){return this._ctx.unique="unique",this.eachKey(a)},fe.prototype.eachPrimaryKey=function(a){var o=this._ctx;return o.keysOnly=!o.isMatch,this.each(function(c,f){a(f.primaryKey,f)})},fe.prototype.keys=function(a){var o=this._ctx;o.keysOnly=!o.isMatch;var c=[];return this.each(function(f,d){c.push(d.key)}).then(function(){return c}).then(a)},fe.prototype.primaryKeys=function(a){var o=this._ctx;if(o.dir==="next"&&Rr(o,!0)&&0<o.limit)return this._read(function(f){var d=ni(o,o.table.core.schema);return o.table.core.query({trans:f,values:!1,limit:o.limit,query:{index:d,range:o.range}})}).then(function(f){return f.result}).then(a);o.keysOnly=!o.isMatch;var c=[];return this.each(function(f,d){c.push(d.primaryKey)}).then(function(){return c}).then(a)},fe.prototype.uniqueKeys=function(a){return this._ctx.unique="unique",this.keys(a)},fe.prototype.firstKey=function(a){return this.limit(1).keys(function(o){return o[0]}).then(a)},fe.prototype.lastKey=function(a){return this.reverse().firstKey(a)},fe.prototype.distinct=function(){var a=this._ctx,a=a.index&&a.table.schema.idxByName[a.index];if(!a||!a.multi)return this;var o={};return pa(this._ctx,function(d){var f=d.primaryKey.toString(),d=g(o,f);return o[f]=!0,!d}),this},fe.prototype.modify=function(a){var o=this,c=this._ctx;return this._write(function(f){var d,p,y;y=typeof a=="function"?a:(d=u(a),p=d.length,function(x){for(var M=!1,T=0;T<p;++T){var N=d[T],$=a[N],j=ee(x,N);$ instanceof sn?(Z(x,N,$.execute(j)),M=!0):j!==$&&(Z(x,N,$),M=!0)}return M});var b=c.table.core,w=b.schema.primaryKey,S=w.outbound,k=w.extractKey,P=200,w=o.db._options.modifyChunkSize;w&&(P=typeof w=="object"?w[b.name]||w["*"]||200:w);function R(x,N){var T=N.failures,N=N.numFailures;I+=x-N;for(var $=0,j=u(T);$<j.length;$++){var U=j[$];E.push(T[U])}}var E=[],I=0,C=[];return o.clone().primaryKeys().then(function(x){function M(N){var $=Math.min(P,x.length-N);return b.getMany({trans:f,keys:x.slice(N,N+$),cache:"immutable"}).then(function(j){for(var U=[],K=[],q=S?[]:null,W=[],F=0;F<$;++F){var Q=j[F],re={value:we(Q),primKey:x[N+F]};y.call(re,re.value,re)!==!1&&(re.value==null?W.push(x[N+F]):S||ce(k(Q),k(re.value))===0?(K.push(re.value),S&&q.push(x[N+F])):(W.push(x[N+F]),U.push(re.value)))}return Promise.resolve(0<U.length&&b.mutate({trans:f,type:"add",values:U}).then(function(ne){for(var ie in ne.failures)W.splice(parseInt(ie),1);R(U.length,ne)})).then(function(){return(0<K.length||T&&typeof a=="object")&&b.mutate({trans:f,type:"put",keys:q,values:K,criteria:T,changeSpec:typeof a!="function"&&a,isAdditionalChunk:0<N}).then(function(ne){return R(K.length,ne)})}).then(function(){return(0<W.length||T&&a===va)&&b.mutate({trans:f,type:"delete",keys:W,criteria:T,isAdditionalChunk:0<N}).then(function(ne){return R(W.length,ne)})}).then(function(){return x.length>N+$&&M(N+P)})})}var T=Rr(c)&&c.limit===1/0&&(typeof a!="function"||a===va)&&{index:c.index,range:c.range};return M(0).then(function(){if(0<E.length)throw new _t("Error modifying one or more objects",E,I,C);return x.length})})})},fe.prototype.delete=function(){var a=this._ctx,o=a.range;return Rr(a)&&(a.isPrimKey||o.type===3)?this._write(function(c){var f=a.table.core.schema.primaryKey,d=o;return a.table.core.count({trans:c,query:{index:f,range:d}}).then(function(p){return a.table.core.mutate({trans:c,type:"deleteRange",range:d}).then(function(y){var b=y.failures;if(y.lastResult,y.results,y=y.numFailures,y)throw new _t("Could not delete some values",Object.keys(b).map(function(S){return b[S]}),p-y);return p-y})})}):this.modify(va)},fe);function fe(){}var va=function(a,o){return o.value=null};function yf(a,o){return a<o?-1:a===o?0:1}function gf(a,o){return o<a?-1:a===o?0:1}function Je(a,o,c){return a=a instanceof xs?new a.Collection(a):a,a._ctx.error=new(c||TypeError)(o),a}function Ar(a){return new a.Collection(a,function(){return ks("")}).limit(0)}function ai(a,o,c,f){var d,p,y,b,S,k,P,w=c.length;if(!c.every(function(I){return typeof I=="string"}))return Je(a,vs);function R(I){d=I==="next"?function(x){return x.toUpperCase()}:function(x){return x.toLowerCase()},p=I==="next"?function(x){return x.toLowerCase()}:function(x){return x.toUpperCase()},y=I==="next"?yf:gf;var C=c.map(function(x){return{lower:p(x),upper:d(x)}}).sort(function(x,M){return y(x.lower,M.lower)});b=C.map(function(x){return x.upper}),S=C.map(function(x){return x.lower}),P=(k=I)==="next"?"":f}R("next"),a=new a.Collection(a,function(){return qt(b[0],S[w-1]+f)}),a._ondirectionchange=function(I){R(I)};var E=0;return a._addAlgorithm(function(I,C,x){var M=I.key;if(typeof M!="string")return!1;var T=p(M);if(o(T,S,E))return!0;for(var N=null,$=E;$<w;++$){var j=function(U,K,q,W,F,Q){for(var re=Math.min(U.length,W.length),ne=-1,ie=0;ie<re;++ie){var Xe=K[ie];if(Xe!==W[ie])return F(U[ie],q[ie])<0?U.substr(0,ie)+q[ie]+q.substr(ie+1):F(U[ie],W[ie])<0?U.substr(0,ie)+W[ie]+q.substr(ie+1):0<=ne?U.substr(0,ne)+K[ne]+q.substr(ne+1):null;F(U[ie],Xe)<0&&(ne=ie)}return re<W.length&&Q==="next"?U+q.substr(U.length):re<U.length&&Q==="prev"?U.substr(0,q.length):ne<0?null:U.substr(0,ne)+W[ne]+q.substr(ne+1)}(M,T,b[$],S[$],y,k);j===null&&N===null?E=$+1:(N===null||0<y(N,j))&&(N=j)}return C(N!==null?function(){I.continue(N+P)}:x),!1}),a}function qt(a,o,c,f){return{type:2,lower:a,upper:o,lowerOpen:c,upperOpen:f}}function ks(a){return{type:1,lower:a,upper:a}}var xs=(Object.defineProperty($e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),$e.prototype.between=function(a,o,c,f){c=c!==!1,f=f===!0;try{return 0<this._cmp(a,o)||this._cmp(a,o)===0&&(c||f)&&(!c||!f)?Ar(this):new this.Collection(this,function(){return qt(a,o,!c,!f)})}catch{return Je(this,St)}},$e.prototype.equals=function(a){return a==null?Je(this,St):new this.Collection(this,function(){return ks(a)})},$e.prototype.above=function(a){return a==null?Je(this,St):new this.Collection(this,function(){return qt(a,void 0,!0)})},$e.prototype.aboveOrEqual=function(a){return a==null?Je(this,St):new this.Collection(this,function(){return qt(a,void 0,!1)})},$e.prototype.below=function(a){return a==null?Je(this,St):new this.Collection(this,function(){return qt(void 0,a,!1,!0)})},$e.prototype.belowOrEqual=function(a){return a==null?Je(this,St):new this.Collection(this,function(){return qt(void 0,a)})},$e.prototype.startsWith=function(a){return typeof a!="string"?Je(this,vs):this.between(a,a+tr,!0,!0)},$e.prototype.startsWithIgnoreCase=function(a){return a===""?this.startsWith(a):ai(this,function(o,c){return o.indexOf(c[0])===0},[a],tr)},$e.prototype.equalsIgnoreCase=function(a){return ai(this,function(o,c){return o===c[0]},[a],"")},$e.prototype.anyOfIgnoreCase=function(){var a=oe.apply(me,arguments);return a.length===0?Ar(this):ai(this,function(o,c){return c.indexOf(o)!==-1},a,"")},$e.prototype.startsWithAnyOfIgnoreCase=function(){var a=oe.apply(me,arguments);return a.length===0?Ar(this):ai(this,function(o,c){return c.some(function(f){return o.indexOf(f)===0})},a,tr)},$e.prototype.anyOf=function(){var a=this,o=oe.apply(me,arguments),c=this._cmp;try{o.sort(c)}catch{return Je(this,St)}if(o.length===0)return Ar(this);var f=new this.Collection(this,function(){return qt(o[0],o[o.length-1])});f._ondirectionchange=function(p){c=p==="next"?a._ascending:a._descending,o.sort(c)};var d=0;return f._addAlgorithm(function(p,y,b){for(var S=p.key;0<c(S,o[d]);)if(++d===o.length)return y(b),!1;return c(S,o[d])===0||(y(function(){p.continue(o[d])}),!1)}),f},$e.prototype.notEqual=function(a){return this.inAnyRange([[-1/0,a],[a,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},$e.prototype.noneOf=function(){var a=oe.apply(me,arguments);if(a.length===0)return new this.Collection(this);try{a.sort(this._ascending)}catch{return Je(this,St)}var o=a.reduce(function(c,f){return c?c.concat([[c[c.length-1][1],f]]):[[-1/0,f]]},null);return o.push([a[a.length-1],this.db._maxKey]),this.inAnyRange(o,{includeLowers:!1,includeUppers:!1})},$e.prototype.inAnyRange=function(M,o){var c=this,f=this._cmp,d=this._ascending,p=this._descending,y=this._min,b=this._max;if(M.length===0)return Ar(this);if(!M.every(function(T){return T[0]!==void 0&&T[1]!==void 0&&d(T[0],T[1])<=0}))return Je(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",J.InvalidArgument);var S=!o||o.includeLowers!==!1,k=o&&o.includeUppers===!0,P,w=d;function R(T,N){return w(T[0],N[0])}try{(P=M.reduce(function(T,N){for(var $=0,j=T.length;$<j;++$){var U=T[$];if(f(N[0],U[1])<0&&0<f(N[1],U[0])){U[0]=y(U[0],N[0]),U[1]=b(U[1],N[1]);break}}return $===j&&T.push(N),T},[])).sort(R)}catch{return Je(this,St)}var E=0,I=k?function(T){return 0<d(T,P[E][1])}:function(T){return 0<=d(T,P[E][1])},C=S?function(T){return 0<p(T,P[E][0])}:function(T){return 0<=p(T,P[E][0])},x=I,M=new this.Collection(this,function(){return qt(P[0][0],P[P.length-1][1],!S,!k)});return M._ondirectionchange=function(T){w=T==="next"?(x=I,d):(x=C,p),P.sort(R)},M._addAlgorithm(function(T,N,$){for(var j,U=T.key;x(U);)if(++E===P.length)return N($),!1;return!I(j=U)&&!C(j)||(c._cmp(U,P[E][1])===0||c._cmp(U,P[E][0])===0||N(function(){w===d?T.continue(P[E][0]):T.continue(P[E][1])}),!1)}),M},$e.prototype.startsWithAnyOf=function(){var a=oe.apply(me,arguments);return a.every(function(o){return typeof o=="string"})?a.length===0?Ar(this):this.inAnyRange(a.map(function(o){return[o,o+tr]})):Je(this,"startsWithAnyOf() only works with strings")},$e);function $e(){}function vt(a){return Ee(function(o){return un(o),a(o.target.error),!1})}function un(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()}var cn="storagemutated",ya="x-storagemutated-1",Ft=an(null,cn),bf=(yt.prototype._lock=function(){return se(!Y.global),++this._reculock,this._reculock!==1||Y.global||(Y.lockOwnerFor=this),this},yt.prototype._unlock=function(){if(se(!Y.global),--this._reculock==0)for(Y.global||(Y.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var a=this._blockedFuncs.shift();try{er(a[1],a[0])}catch{}}return this},yt.prototype._locked=function(){return this._reculock&&Y.lockOwnerFor!==this},yt.prototype.create=function(a){var o=this;if(!this.mode)return this;var c=this.db.idbdb,f=this.db._state.dbOpenError;if(se(!this.idbtrans),!a&&!c)switch(f&&f.name){case"DatabaseClosedError":throw new J.DatabaseClosed(f);case"MissingAPIError":throw new J.MissingAPI(f.message,f);default:throw new J.OpenFailed(f)}if(!this.active)throw new J.TransactionInactive;return se(this._completion._state===null),(a=this.idbtrans=a||(this.db.core||c).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ee(function(d){un(d),o._reject(a.error)}),a.onabort=Ee(function(d){un(d),o.active&&o._reject(new J.Abort(a.error)),o.active=!1,o.on("abort").fire(d)}),a.oncomplete=Ee(function(){o.active=!1,o._resolve(),"mutatedParts"in a&&Ft.storagemutated.fire(a.mutatedParts)}),this},yt.prototype._promise=function(a,o,c){var f=this;if(a==="readwrite"&&this.mode!=="readwrite")return Pe(new J.ReadOnly("Transaction is readonly"));if(!this.active)return Pe(new J.TransactionInactive);if(this._locked())return new H(function(p,y){f._blockedFuncs.push([function(){f._promise(a,o,c).then(p,y)},Y])});if(c)return Bt(function(){var p=new H(function(y,b){f._lock();var S=o(y,b,f);S&&S.then&&S.then(y,b)});return p.finally(function(){return f._unlock()}),p._lib=!0,p});var d=new H(function(p,y){var b=o(p,y,f);b&&b.then&&b.then(p,y)});return d._lib=!0,d},yt.prototype._root=function(){return this.parent?this.parent._root():this},yt.prototype.waitFor=function(a){var o,c=this._root(),f=H.resolve(a);c._waitingFor?c._waitingFor=c._waitingFor.then(function(){return f}):(c._waitingFor=f,c._waitingQueue=[],o=c.idbtrans.objectStore(c.storeNames[0]),function p(){for(++c._spinCount;c._waitingQueue.length;)c._waitingQueue.shift()();c._waitingFor&&(o.get(-1/0).onsuccess=p)}());var d=c._waitingFor;return new H(function(p,y){f.then(function(b){return c._waitingQueue.push(Ee(p.bind(null,b)))},function(b){return c._waitingQueue.push(Ee(y.bind(null,b)))}).finally(function(){c._waitingFor===d&&(c._waitingFor=null)})})},yt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new J.Abort))},yt.prototype.table=function(a){var o=this._memoizedTables||(this._memoizedTables={});if(g(o,a))return o[a];var c=this.schema[a];if(!c)throw new J.NotFound("Table "+a+" not part of transaction");return c=new this.db.Table(a,c,this),c.core=this.db.core.table(a),o[a]=c},yt);function yt(){}function ga(a,o,c,f,d,p,y){return{name:a,keyPath:o,unique:c,multi:f,auto:d,compound:p,src:(c&&!y?"&":"")+(f?"*":"")+(d?"++":"")+Is(o)}}function Is(a){return typeof a=="string"?a:a?"["+[].join.call(a,"+")+"]":""}function ba(a,o,c){return{name:a,primKey:o,indexes:c,mappedClass:null,idxByName:(f=function(d){return[d.name,d]},c.reduce(function(d,p,y){return y=f(p,y),y&&(d[y[0]]=y[1]),d},{}))};var f}var ln=function(a){try{return a.only([[]]),ln=function(){return[[]]},[[]]}catch{return ln=function(){return tr},tr}};function wa(a){return a==null?function(){}:typeof a=="string"?(o=a).split(".").length===1?function(c){return c[o]}:function(c){return ee(c,o)}:function(c){return ee(c,a)};var o}function Ps(a){return[].slice.call(a)}var wf=0;function fn(a){return a==null?":id":typeof a=="string"?a:"[".concat(a.join("+"),"]")}function _f(a,o,S){function f(x){if(x.type===3)return null;if(x.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var E=x.lower,I=x.upper,C=x.lowerOpen,x=x.upperOpen;return E===void 0?I===void 0?null:o.upperBound(I,!!x):I===void 0?o.lowerBound(E,!!C):o.bound(E,I,!!C,!!x)}function d(R){var E,I=R.name;return{name:I,schema:R,mutate:function(C){var x=C.trans,M=C.type,T=C.keys,N=C.values,$=C.range;return new Promise(function(j,U){j=Ee(j);var K=x.objectStore(I),q=K.keyPath==null,W=M==="put"||M==="add";if(!W&&M!=="delete"&&M!=="deleteRange")throw new Error("Invalid operation type: "+M);var F,Q=(T||N||{length:1}).length;if(T&&N&&T.length!==N.length)throw new Error("Given keys array must have same length as given values array.");if(Q===0)return j({numFailures:0,failures:{},results:[],lastResult:void 0});function re(ze){++Xe,un(ze)}var ne=[],ie=[],Xe=0;if(M==="deleteRange"){if($.type===4)return j({numFailures:Xe,failures:ie,results:[],lastResult:void 0});$.type===3?ne.push(F=K.clear()):ne.push(F=K.delete(f($)))}else{var q=W?q?[N,T]:[N,null]:[T,null],te=q[0],Fe=q[1];if(W)for(var Ue=0;Ue<Q;++Ue)ne.push(F=Fe&&Fe[Ue]!==void 0?K[M](te[Ue],Fe[Ue]):K[M](te[Ue])),F.onerror=re;else for(Ue=0;Ue<Q;++Ue)ne.push(F=K[M](te[Ue])),F.onerror=re}function gi(ze){ze=ze.target.result,ne.forEach(function(ar,Ba){return ar.error!=null&&(ie[Ba]=ar.error)}),j({numFailures:Xe,failures:ie,results:M==="delete"?T:ne.map(function(ar){return ar.result}),lastResult:ze})}F.onerror=function(ze){re(ze),gi(ze)},F.onsuccess=gi})},getMany:function(C){var x=C.trans,M=C.keys;return new Promise(function(T,N){T=Ee(T);for(var $,j=x.objectStore(I),U=M.length,K=new Array(U),q=0,W=0,F=function(ne){ne=ne.target,K[ne._pos]=ne.result,++W===q&&T(K)},Q=vt(N),re=0;re<U;++re)M[re]!=null&&(($=j.get(M[re]))._pos=re,$.onsuccess=F,$.onerror=Q,++q);q===0&&T(K)})},get:function(C){var x=C.trans,M=C.key;return new Promise(function(T,N){T=Ee(T);var $=x.objectStore(I).get(M);$.onsuccess=function(j){return T(j.target.result)},$.onerror=vt(N)})},query:(E=k,function(C){return new Promise(function(x,M){x=Ee(x);var T,N,$,q=C.trans,j=C.values,U=C.limit,F=C.query,K=U===1/0?void 0:U,W=F.index,F=F.range,q=q.objectStore(I),W=W.isPrimaryKey?q:q.index(W.name),F=f(F);if(U===0)return x({result:[]});E?((K=j?W.getAll(F,K):W.getAllKeys(F,K)).onsuccess=function(Q){return x({result:Q.target.result})},K.onerror=vt(M)):(T=0,N=!j&&"openKeyCursor"in W?W.openKeyCursor(F):W.openCursor(F),$=[],N.onsuccess=function(Q){var re=N.result;return re?($.push(j?re.value:re.primaryKey),++T===U?x({result:$}):void re.continue()):x({result:$})},N.onerror=vt(M))})}),openCursor:function(C){var x=C.trans,M=C.values,T=C.query,N=C.reverse,$=C.unique;return new Promise(function(j,U){j=Ee(j);var W=T.index,K=T.range,q=x.objectStore(I),q=W.isPrimaryKey?q:q.index(W.name),W=N?$?"prevunique":"prev":$?"nextunique":"next",F=!M&&"openKeyCursor"in q?q.openKeyCursor(f(K),W):q.openCursor(f(K),W);F.onerror=vt(U),F.onsuccess=Ee(function(Q){var re,ne,ie,Xe,te=F.result;te?(te.___id=++wf,te.done=!1,re=te.continue.bind(te),ne=(ne=te.continuePrimaryKey)&&ne.bind(te),ie=te.advance.bind(te),Xe=function(){throw new Error("Cursor not stopped")},te.trans=x,te.stop=te.continue=te.continuePrimaryKey=te.advance=function(){throw new Error("Cursor not started")},te.fail=Ee(U),te.next=function(){var Fe=this,Ue=1;return this.start(function(){return Ue--?Fe.continue():Fe.stop()}).then(function(){return Fe})},te.start=function(Fe){function Ue(){if(F.result)try{Fe()}catch(ze){te.fail(ze)}else te.done=!0,te.start=function(){throw new Error("Cursor behind last entry")},te.stop()}var gi=new Promise(function(ze,ar){ze=Ee(ze),F.onerror=vt(ar),te.fail=ar,te.stop=function(Ba){te.stop=te.continue=te.continuePrimaryKey=te.advance=Xe,ze(Ba)}});return F.onsuccess=Ee(function(ze){F.onsuccess=Ue,Ue()}),te.continue=re,te.continuePrimaryKey=ne,te.advance=ie,Ue(),gi},j(te)):j(null)},U)})},count:function(C){var x=C.query,M=C.trans,T=x.index,N=x.range;return new Promise(function($,j){var U=M.objectStore(I),K=T.isPrimaryKey?U:U.index(T.name),U=f(N),K=U?K.count(U):K.count();K.onsuccess=Ee(function(q){return $(q.target.result)}),K.onerror=vt(j)})}}}var p,y,b,P=(y=S,b=Ps((p=a).objectStoreNames),{schema:{name:p.name,tables:b.map(function(R){return y.objectStore(R)}).map(function(R){var E=R.keyPath,x=R.autoIncrement,I=l(E),C={},x={name:R.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:E==null,compound:I,keyPath:E,autoIncrement:x,unique:!0,extractKey:wa(E)},indexes:Ps(R.indexNames).map(function(M){return R.index(M)}).map(function($){var T=$.name,N=$.unique,j=$.multiEntry,$=$.keyPath,j={name:T,compound:l($),keyPath:$,unique:N,multiEntry:j,extractKey:wa($)};return C[fn($)]=j}),getIndexByKeyPath:function(M){return C[fn(M)]}};return C[":id"]=x.primaryKey,E!=null&&(C[fn(E)]=x.primaryKey),x})},hasGetAll:0<b.length&&"getAll"in y.objectStore(b[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),S=P.schema,k=P.hasGetAll,P=S.tables.map(d),w={};return P.forEach(function(R){return w[R.name]=R}),{stack:"dbcore",transaction:a.transaction.bind(a),table:function(R){if(!w[R])throw new Error("Table '".concat(R,"' not found"));return w[R]},MIN_KEY:-1/0,MAX_KEY:ln(o),schema:S}}function Sf(a,o,c,f){var d=c.IDBKeyRange;return c.indexedDB,{dbcore:(f=_f(o,d,f),a.dbcore.reduce(function(p,y){return y=y.create,n(n({},p),y(p))},f))}}function oi(a,f){var c=f.db,f=Sf(a._middlewares,c,a._deps,f);a.core=f.dbcore,a.tables.forEach(function(d){var p=d.name;a.core.schema.tables.some(function(y){return y.name===p})&&(d.core=a.core.table(p),a[p]instanceof a.Table&&(a[p].core=d.core))})}function si(a,o,c,f){c.forEach(function(d){var p=f[d];o.forEach(function(y){var b=function S(k,P){return L(k,P)||(k=m(k))&&S(k,P)}(y,d);(!b||"value"in b&&b.value===void 0)&&(y===a.Transaction.prototype||y instanceof a.Transaction?D(y,d,{get:function(){return this.table(d)},set:function(S){O(this,d,{value:S,writable:!0,configurable:!0,enumerable:!0})}}):y[d]=new a.Table(d,p))})})}function _a(a,o){o.forEach(function(c){for(var f in c)c[f]instanceof a.Table&&delete c[f]})}function Ef(a,o){return a._cfg.version-o._cfg.version}function Of(a,o,c,f){var d=a._dbSchema;c.objectStoreNames.contains("$meta")&&!d.$meta&&(d.$meta=ba("$meta",Cs("")[0],[]),a._storeNames.push("$meta"));var p=a._createTransaction("readwrite",a._storeNames,d);p.create(c),p._completion.catch(f);var y=p._reject.bind(p),b=Y.transless||Y;Bt(function(){return Y.trans=p,Y.transless=b,o!==0?(oi(a,c),k=o,((S=p).storeNames.includes("$meta")?S.table("$meta").get("version").then(function(P){return P??k}):H.resolve(k)).then(function(P){return R=P,E=p,I=c,C=[],P=(w=a)._versions,x=w._dbSchema=ci(0,w.idbdb,I),(P=P.filter(function(M){return M._cfg.version>=R})).length!==0?(P.forEach(function(M){C.push(function(){var T=x,N=M._cfg.dbschema;li(w,T,I),li(w,N,I),x=w._dbSchema=N;var $=Sa(T,N);$.add.forEach(function(W){Ea(I,W[0],W[1].primKey,W[1].indexes)}),$.change.forEach(function(W){if(W.recreate)throw new J.Upgrade("Not yet support for changing primary key");var F=I.objectStore(W.name);W.add.forEach(function(Q){return ui(F,Q)}),W.change.forEach(function(Q){F.deleteIndex(Q.name),ui(F,Q)}),W.del.forEach(function(Q){return F.deleteIndex(Q)})});var j=M._cfg.contentUpgrade;if(j&&M._cfg.version>R){oi(w,I),E._memoizedTables={};var U=ue(N);$.del.forEach(function(W){U[W]=T[W]}),_a(w,[w.Transaction.prototype]),si(w,[w.Transaction.prototype],u(U),U),E.schema=U;var K,q=Be(j);return q&&Dr(),$=H.follow(function(){var W;(K=j(E))&&q&&(W=jt.bind(null,null),K.then(W,W))}),K&&typeof K.then=="function"?H.resolve(K):$.then(function(){return K})}}),C.push(function(T){var N,$,j=M._cfg.dbschema;N=j,$=T,[].slice.call($.db.objectStoreNames).forEach(function(U){return N[U]==null&&$.db.deleteObjectStore(U)}),_a(w,[w.Transaction.prototype]),si(w,[w.Transaction.prototype],w._storeNames,w._dbSchema),E.schema=w._dbSchema}),C.push(function(T){w.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(w.idbdb.version/10)===M._cfg.version?(w.idbdb.deleteObjectStore("$meta"),delete w._dbSchema.$meta,w._storeNames=w._storeNames.filter(function(N){return N!=="$meta"})):T.objectStore("$meta").put(M._cfg.version,"version"))})}),function M(){return C.length?H.resolve(C.shift()(E.idbtrans)).then(M):H.resolve()}().then(function(){Ds(x,I)})):H.resolve();var w,R,E,I,C,x}).catch(y)):(u(d).forEach(function(P){Ea(c,P,d[P].primKey,d[P].indexes)}),oi(a,c),void H.follow(function(){return a.on.populate.fire(p)}).catch(y));var S,k})}function kf(a,o){Ds(a._dbSchema,o),o.db.version%10!=0||o.objectStoreNames.contains("$meta")||o.db.createObjectStore("$meta").add(Math.ceil(o.db.version/10-1),"version");var c=ci(0,a.idbdb,o);li(a,a._dbSchema,o);for(var f=0,d=Sa(c,a._dbSchema).change;f<d.length;f++){var p=function(y){if(y.change.length||y.recreate)return console.warn("Unable to patch indexes of table ".concat(y.name," because it has changes on the type of index or primary key.")),{value:void 0};var b=o.objectStore(y.name);y.add.forEach(function(S){mt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(y.name,".").concat(S.src)),ui(b,S)})}(d[f]);if(typeof p=="object")return p.value}}function Sa(a,o){var c,f={del:[],add:[],change:[]};for(c in a)o[c]||f.del.push(c);for(c in o){var d=a[c],p=o[c];if(d){var y={name:c,def:p,recreate:!1,del:[],add:[],change:[]};if(""+(d.primKey.keyPath||"")!=""+(p.primKey.keyPath||"")||d.primKey.auto!==p.primKey.auto)y.recreate=!0,f.change.push(y);else{var b=d.idxByName,S=p.idxByName,k=void 0;for(k in b)S[k]||y.del.push(k);for(k in S){var P=b[k],w=S[k];P?P.src!==w.src&&y.change.push(w):y.add.push(w)}(0<y.del.length||0<y.add.length||0<y.change.length)&&f.change.push(y)}}else f.add.push([c,p])}return f}function Ea(a,o,c,f){var d=a.db.createObjectStore(o,c.keyPath?{keyPath:c.keyPath,autoIncrement:c.auto}:{autoIncrement:c.auto});return f.forEach(function(p){return ui(d,p)}),d}function Ds(a,o){u(a).forEach(function(c){o.db.objectStoreNames.contains(c)||(mt&&console.debug("Dexie: Creating missing table",c),Ea(o,c,a[c].primKey,a[c].indexes))})}function ui(a,o){a.createIndex(o.name,o.keyPath,{unique:o.unique,multiEntry:o.multi})}function ci(a,o,c){var f={};return z(o.objectStoreNames,0).forEach(function(d){for(var p=c.objectStore(d),y=ga(Is(k=p.keyPath),k||"",!0,!1,!!p.autoIncrement,k&&typeof k!="string",!0),b=[],S=0;S<p.indexNames.length;++S){var P=p.index(p.indexNames[S]),k=P.keyPath,P=ga(P.name,k,!!P.unique,!!P.multiEntry,!1,k&&typeof k!="string",!1);b.push(P)}f[d]=ba(d,y,b)}),f}function li(a,o,c){for(var f=c.db.objectStoreNames,d=0;d<f.length;++d){var p=f[d],y=c.objectStore(p);a._hasGetAll="getAll"in y;for(var b=0;b<y.indexNames.length;++b){var S=y.indexNames[b],k=y.index(S).keyPath,P=typeof k=="string"?k:"["+z(k).join("+")+"]";!o[p]||(k=o[p].idxByName[P])&&(k.name=S,delete o[p].idxByName[P],o[p].idxByName[S]=k)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(a._hasGetAll=!1)}function Cs(a){return a.split(",").map(function(o,c){var f=(o=o.trim()).replace(/([&*]|\+\+)/g,""),d=/^\[/.test(f)?f.match(/^\[(.*)\]$/)[1].split("+"):f;return ga(f,d||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),l(d),c===0)})}var xf=(fi.prototype._parseStoresSpec=function(a,o){u(a).forEach(function(c){if(a[c]!==null){var f=Cs(a[c]),d=f.shift();if(d.unique=!0,d.multi)throw new J.Schema("Primary key cannot be multi-valued");f.forEach(function(p){if(p.auto)throw new J.Schema("Only primary key can be marked as autoIncrement (++)");if(!p.keyPath)throw new J.Schema("Index must have a name and cannot be an empty string")}),o[c]=ba(c,d,f)}})},fi.prototype.stores=function(c){var o=this.db;this._cfg.storesSource=this._cfg.storesSource?h(this._cfg.storesSource,c):c;var c=o._versions,f={},d={};return c.forEach(function(p){h(f,p._cfg.storesSource),d=p._cfg.dbschema={},p._parseStoresSpec(f,d)}),o._dbSchema=d,_a(o,[o._allTables,o,o.Transaction.prototype]),si(o,[o._allTables,o,o.Transaction.prototype,this._cfg.tables],u(d),d),o._storeNames=u(d),this},fi.prototype.upgrade=function(a){return this._cfg.contentUpgrade=na(this._cfg.contentUpgrade||de,a),this},fi);function fi(){}function Oa(a,o){var c=a._dbNamesDB;return c||(c=a._dbNamesDB=new Ot(ti,{addons:[],indexedDB:a,IDBKeyRange:o})).version(1).stores({dbnames:"name"}),c.table("dbnames")}function ka(a){return a&&typeof a.databases=="function"}function xa(a){return Bt(function(){return Y.letThrough=!0,a()})}function Ia(a){return!("from"in a)}var qe=function(a,o){if(!this){var c=new qe;return a&&"d"in a&&h(c,a),c}h(this,arguments.length?{d:1,from:a,to:1<arguments.length?o:a}:{d:0})};function hn(a,o,c){var f=ce(o,c);if(!isNaN(f)){if(0<f)throw RangeError();if(Ia(a))return h(a,{from:o,to:c,d:1});var d=a.l,f=a.r;if(ce(c,a.from)<0)return d?hn(d,o,c):a.l={from:o,to:c,d:1,l:null,r:null},As(a);if(0<ce(o,a.to))return f?hn(f,o,c):a.r={from:o,to:c,d:1,l:null,r:null},As(a);ce(o,a.from)<0&&(a.from=o,a.l=null,a.d=f?f.d+1:1),0<ce(c,a.to)&&(a.to=c,a.r=null,a.d=a.l?a.l.d+1:1),c=!a.r,d&&!a.l&&dn(a,d),f&&c&&dn(a,f)}}function dn(a,o){Ia(o)||function c(f,S){var p=S.from,y=S.to,b=S.l,S=S.r;hn(f,p,y),b&&c(f,b),S&&c(f,S)}(a,o)}function Rs(a,o){var c=hi(o),f=c.next();if(f.done)return!1;for(var d=f.value,p=hi(a),y=p.next(d.from),b=y.value;!f.done&&!y.done;){if(ce(b.from,d.to)<=0&&0<=ce(b.to,d.from))return!0;ce(d.from,b.from)<0?d=(f=c.next(b.from)).value:b=(y=p.next(d.from)).value}return!1}function hi(a){var o=Ia(a)?null:{s:0,n:a};return{next:function(c){for(var f=0<arguments.length;o;)switch(o.s){case 0:if(o.s=1,f)for(;o.n.l&&ce(c,o.n.from)<0;)o={up:o,n:o.n.l,s:1};else for(;o.n.l;)o={up:o,n:o.n.l,s:1};case 1:if(o.s=2,!f||ce(c,o.n.to)<=0)return{value:o.n,done:!1};case 2:if(o.n.r){o.s=3,o={up:o,n:o.n.r,s:0};continue}case 3:o=o.up}return{done:!0}}}}function As(a){var o,c,f=(((o=a.r)===null||o===void 0?void 0:o.d)||0)-(((c=a.l)===null||c===void 0?void 0:c.d)||0),d=1<f?"r":f<-1?"l":"";d&&(o=d=="r"?"l":"r",c=n({},a),f=a[d],a.from=f.from,a.to=f.to,a[d]=f[d],c[d]=f[o],(a[o]=c).d=Ms(c)),a.d=Ms(a)}function Ms(c){var o=c.r,c=c.l;return(o?c?Math.max(o.d,c.d):o.d:c?c.d:0)+1}function di(a,o){return u(o).forEach(function(c){a[c]?dn(a[c],o[c]):a[c]=function f(d){var p,y,b={};for(p in d)g(d,p)&&(y=d[p],b[p]=!y||typeof y!="object"||Ie.has(y.constructor)?y:f(y));return b}(o[c])}),a}function Pa(a,o){return a.all||o.all||Object.keys(a).some(function(c){return o[c]&&Rs(o[c],a[c])})}_(qe.prototype,((ct={add:function(a){return dn(this,a),this},addKey:function(a){return hn(this,a,a),this},addKeys:function(a){var o=this;return a.forEach(function(c){return hn(o,c,c)}),this},hasKey:function(a){var o=hi(this).next(a).value;return o&&ce(o.from,a)<=0&&0<=ce(o.to,a)}})[ut]=function(){return hi(this)},ct));var nr={},Da={},Ca=!1;function pi(a){di(Da,a),Ca||(Ca=!0,setTimeout(function(){Ca=!1,Ra(Da,!(Da={}))},0))}function Ra(a,o){o===void 0&&(o=!1);var c=new Set;if(a.all)for(var f=0,d=Object.values(nr);f<d.length;f++)Ts(y=d[f],a,c,o);else for(var p in a){var y,b=/^idb\:\/\/(.*)\/(.*)\//.exec(p);b&&(p=b[1],b=b[2],(y=nr["idb://".concat(p,"/").concat(b)])&&Ts(y,a,c,o))}c.forEach(function(S){return S()})}function Ts(a,o,c,f){for(var d=[],p=0,y=Object.entries(a.queries.query);p<y.length;p++){for(var b=y[p],S=b[0],k=[],P=0,w=b[1];P<w.length;P++){var R=w[P];Pa(o,R.obsSet)?R.subscribers.forEach(function(x){return c.add(x)}):f&&k.push(R)}f&&d.push([S,k])}if(f)for(var E=0,I=d;E<I.length;E++){var C=I[E],S=C[0],k=C[1];a.queries.query[S]=k}}function If(a){var o=a._state,c=a._deps.indexedDB;if(o.isBeingOpened||a.idbdb)return o.dbReadyPromise.then(function(){return o.dbOpenError?Pe(o.dbOpenError):a});o.isBeingOpened=!0,o.dbOpenError=null,o.openComplete=!1;var f=o.openCanceller,d=Math.round(10*a.verno),p=!1;function y(){if(o.openCanceller!==f)throw new J.DatabaseClosed("db.open() was cancelled")}function b(){return new H(function(R,E){if(y(),!c)throw new J.MissingAPI;var I=a.name,C=o.autoSchema||!d?c.open(I):c.open(I,d);if(!C)throw new J.MissingAPI;C.onerror=vt(E),C.onblocked=Ee(a._fireOnBlocked),C.onupgradeneeded=Ee(function(x){var M;P=C.transaction,o.autoSchema&&!a._options.allowEmptyDB?(C.onerror=un,P.abort(),C.result.close(),(M=c.deleteDatabase(I)).onsuccess=M.onerror=Ee(function(){E(new J.NoSuchDatabase("Database ".concat(I," doesnt exist")))})):(P.onerror=vt(E),x=x.oldVersion>Math.pow(2,62)?0:x.oldVersion,w=x<1,a.idbdb=C.result,p&&kf(a,P),Of(a,x/10,P,E))},E),C.onsuccess=Ee(function(){P=null;var x,M,T,N,$,j=a.idbdb=C.result,U=z(j.objectStoreNames);if(0<U.length)try{var K=j.transaction((N=U).length===1?N[0]:N,"readonly");if(o.autoSchema)M=j,T=K,(x=a).verno=M.version/10,T=x._dbSchema=ci(0,M,T),x._storeNames=z(M.objectStoreNames,0),si(x,[x._allTables],u(T),T);else if(li(a,a._dbSchema,K),(($=Sa(ci(0,($=a).idbdb,K),$._dbSchema)).add.length||$.change.some(function(q){return q.add.length||q.change.length}))&&!p)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),j.close(),d=j.version+1,p=!0,R(b());oi(a,K)}catch{}Cr.push(a),j.onversionchange=Ee(function(q){o.vcFired=!0,a.on("versionchange").fire(q)}),j.onclose=Ee(function(q){a.on("close").fire(q)}),w&&($=a._deps,K=I,j=$.indexedDB,$=$.IDBKeyRange,ka(j)||K===ti||Oa(j,$).put({name:K}).catch(de)),R()},E)}).catch(function(R){switch(R==null?void 0:R.name){case"UnknownError":if(0<o.PR1398_maxLoop)return o.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),b();break;case"VersionError":if(0<d)return d=0,b()}return H.reject(R)})}var S,k=o.dbReadyResolve,P=null,w=!1;return H.race([f,(typeof navigator>"u"?H.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(R){function E(){return indexedDB.databases().finally(R)}S=setInterval(E,100),E()}).finally(function(){return clearInterval(S)}):Promise.resolve()).then(b)]).then(function(){return y(),o.onReadyBeingFired=[],H.resolve(xa(function(){return a.on.ready.fire(a.vip)})).then(function R(){if(0<o.onReadyBeingFired.length){var E=o.onReadyBeingFired.reduce(na,de);return o.onReadyBeingFired=[],H.resolve(xa(function(){return E(a.vip)})).then(R)}})}).finally(function(){o.openCanceller===f&&(o.onReadyBeingFired=null,o.isBeingOpened=!1)}).catch(function(R){o.dbOpenError=R;try{P&&P.abort()}catch{}return f===o.openCanceller&&a._close(),Pe(R)}).finally(function(){o.openComplete=!0,k()}).then(function(){var R;return w&&(R={},a.tables.forEach(function(E){E.schema.indexes.forEach(function(I){I.name&&(R["idb://".concat(a.name,"/").concat(E.name,"/").concat(I.name)]=new qe(-1/0,[[[]]]))}),R["idb://".concat(a.name,"/").concat(E.name,"/")]=R["idb://".concat(a.name,"/").concat(E.name,"/:dels")]=new qe(-1/0,[[[]]])}),Ft(cn).fire(R),Ra(R,!0)),a})}function Aa(a){function o(p){return a.next(p)}var c=d(o),f=d(function(p){return a.throw(p)});function d(p){return function(S){var b=p(S),S=b.value;return b.done?S:S&&typeof S.then=="function"?S.then(c,f):l(S)?Promise.all(S).then(c,f):c(S)}}return d(o)()}function mi(a,o,c){for(var f=l(a)?a.slice():[a],d=0;d<c;++d)f.push(o);return f}var Pf={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(a){return n(n({},a),{table:function(o){var c=a.table(o),f=c.schema,d={},p=[];function y(w,R,E){var I=fn(w),C=d[I]=d[I]||[],x=w==null?0:typeof w=="string"?1:w.length,M=0<R,M=n(n({},E),{name:M?"".concat(I,"(virtual-from:").concat(E.name,")"):E.name,lowLevelIndex:E,isVirtual:M,keyTail:R,keyLength:x,extractKey:wa(w),unique:!M&&E.unique});return C.push(M),M.isPrimaryKey||p.push(M),1<x&&y(x===2?w[0]:w.slice(0,x-1),R+1,E),C.sort(function(T,N){return T.keyTail-N.keyTail}),M}o=y(f.primaryKey.keyPath,0,f.primaryKey),d[":id"]=[o];for(var b=0,S=f.indexes;b<S.length;b++){var k=S[b];y(k.keyPath,0,k)}function P(w){var R,E=w.query.index;return E.isVirtual?n(n({},w),{query:{index:E.lowLevelIndex,range:(R=w.query.range,E=E.keyTail,{type:R.type===1?2:R.type,lower:mi(R.lower,R.lowerOpen?a.MAX_KEY:a.MIN_KEY,E),lowerOpen:!0,upper:mi(R.upper,R.upperOpen?a.MIN_KEY:a.MAX_KEY,E),upperOpen:!0})}}):w}return n(n({},c),{schema:n(n({},f),{primaryKey:o,indexes:p,getIndexByKeyPath:function(w){return(w=d[fn(w)])&&w[0]}}),count:function(w){return c.count(P(w))},query:function(w){return c.query(P(w))},openCursor:function(w){var R=w.query.index,E=R.keyTail,I=R.isVirtual,C=R.keyLength;return I?c.openCursor(P(w)).then(function(M){return M&&x(M)}):c.openCursor(w);function x(M){return Object.create(M,{continue:{value:function(T){T!=null?M.continue(mi(T,w.reverse?a.MAX_KEY:a.MIN_KEY,E)):w.unique?M.continue(M.key.slice(0,C).concat(w.reverse?a.MIN_KEY:a.MAX_KEY,E)):M.continue()}},continuePrimaryKey:{value:function(T,N){M.continuePrimaryKey(mi(T,a.MAX_KEY,E),N)}},primaryKey:{get:function(){return M.primaryKey}},key:{get:function(){var T=M.key;return C===1?T[0]:T.slice(0,C)}},value:{get:function(){return M.value}}})}}})}})}};function Ma(a,o,c,f){return c=c||{},f=f||"",u(a).forEach(function(d){var p,y,b;g(o,d)?(p=a[d],y=o[d],typeof p=="object"&&typeof y=="object"&&p&&y?(b=ke(p))!==ke(y)?c[f+d]=o[d]:b==="Object"?Ma(p,y,c,f+d+"."):p!==y&&(c[f+d]=o[d]):p!==y&&(c[f+d]=o[d])):c[f+d]=void 0}),u(o).forEach(function(d){g(a,d)||(c[f+d]=o[d])}),c}function Ta(a,o){return o.type==="delete"?o.keys:o.keys||o.values.map(a.extractKey)}var Df={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(a){return n(n({},a),{table:function(o){var c=a.table(o),f=c.schema.primaryKey;return n(n({},c),{mutate:function(d){var p=Y.trans,y=p.table(o).hook,b=y.deleting,S=y.creating,k=y.updating;switch(d.type){case"add":if(S.fire===de)break;return p._promise("readwrite",function(){return P(d)},!0);case"put":if(S.fire===de&&k.fire===de)break;return p._promise("readwrite",function(){return P(d)},!0);case"delete":if(b.fire===de)break;return p._promise("readwrite",function(){return P(d)},!0);case"deleteRange":if(b.fire===de)break;return p._promise("readwrite",function(){return function w(R,E,I){return c.query({trans:R,values:!1,query:{index:f,range:E},limit:I}).then(function(C){var x=C.result;return P({type:"delete",keys:x,trans:R}).then(function(M){return 0<M.numFailures?Promise.reject(M.failures[0]):x.length<I?{failures:[],numFailures:0,lastResult:void 0}:w(R,n(n({},E),{lower:x[x.length-1],lowerOpen:!0}),I)})})}(d.trans,d.range,1e4)},!0)}return c.mutate(d);function P(w){var R,E,I,C=Y.trans,x=w.keys||Ta(f,w);if(!x)throw new Error("Keys missing");return(w=w.type==="add"||w.type==="put"?n(n({},w),{keys:x}):n({},w)).type!=="delete"&&(w.values=i([],w.values)),w.keys&&(w.keys=i([],w.keys)),R=c,I=x,((E=w).type==="add"?Promise.resolve([]):R.getMany({trans:E.trans,keys:I,cache:"immutable"})).then(function(M){var T=x.map(function(N,$){var j,U,K,q=M[$],W={onerror:null,onsuccess:null};return w.type==="delete"?b.fire.call(W,N,q,C):w.type==="add"||q===void 0?(j=S.fire.call(W,N,w.values[$],C),N==null&&j!=null&&(w.keys[$]=N=j,f.outbound||Z(w.values[$],f.keyPath,N))):(j=Ma(q,w.values[$]),(U=k.fire.call(W,j,N,q,C))&&(K=w.values[$],Object.keys(U).forEach(function(F){g(K,F)?K[F]=U[F]:Z(K,F,U[F])}))),W});return c.mutate(w).then(function(N){for(var $=N.failures,j=N.results,U=N.numFailures,N=N.lastResult,K=0;K<x.length;++K){var q=(j||x)[K],W=T[K];q==null?W.onerror&&W.onerror($[K]):W.onsuccess&&W.onsuccess(w.type==="put"&&M[K]?w.values[K]:q)}return{failures:$,results:j,numFailures:U,lastResult:N}}).catch(function(N){return T.forEach(function($){return $.onerror&&$.onerror(N)}),Promise.reject(N)})})}}})}})}};function Ns(a,o,c){try{if(!o||o.keys.length<a.length)return null;for(var f=[],d=0,p=0;d<o.keys.length&&p<a.length;++d)ce(o.keys[d],a[p])===0&&(f.push(c?we(o.values[d]):o.values[d]),++p);return f.length===a.length?f:null}catch{return null}}var Cf={stack:"dbcore",level:-1,create:function(a){return{table:function(o){var c=a.table(o);return n(n({},c),{getMany:function(f){if(!f.cache)return c.getMany(f);var d=Ns(f.keys,f.trans._cache,f.cache==="clone");return d?H.resolve(d):c.getMany(f).then(function(p){return f.trans._cache={keys:f.keys,values:f.cache==="clone"?we(p):p},p})},mutate:function(f){return f.type!=="add"&&(f.trans._cache=null),c.mutate(f)}})}}}};function $s(a,o){return a.trans.mode==="readonly"&&!!a.subscr&&!a.trans.explicit&&a.trans.db._options.cache!=="disabled"&&!o.schema.primaryKey.outbound}function Ls(a,o){switch(a){case"query":return o.values&&!o.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Rf={stack:"dbcore",level:0,name:"Observability",create:function(a){var o=a.schema.name,c=new qe(a.MIN_KEY,a.MAX_KEY);return n(n({},a),{transaction:function(f,d,p){if(Y.subscr&&d!=="readonly")throw new J.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Y.querier));return a.transaction(f,d,p)},table:function(f){var d=a.table(f),p=d.schema,y=p.primaryKey,w=p.indexes,b=y.extractKey,S=y.outbound,k=y.autoIncrement&&w.filter(function(E){return E.compound&&E.keyPath.includes(y.keyPath)}),P=n(n({},d),{mutate:function(E){function I(F){return F="idb://".concat(o,"/").concat(f,"/").concat(F),N[F]||(N[F]=new qe)}var C,x,M,T=E.trans,N=E.mutatedParts||(E.mutatedParts={}),$=I(""),j=I(":dels"),U=E.type,W=E.type==="deleteRange"?[E.range]:E.type==="delete"?[E.keys]:E.values.length<50?[Ta(y,E).filter(function(F){return F}),E.values]:[],K=W[0],q=W[1],W=E.trans._cache;return l(K)?($.addKeys(K),(W=U==="delete"||K.length===q.length?Ns(K,W):null)||j.addKeys(K),(W||q)&&(C=I,x=W,M=q,p.indexes.forEach(function(F){var Q=C(F.name||"");function re(ie){return ie!=null?F.extractKey(ie):null}function ne(ie){return F.multiEntry&&l(ie)?ie.forEach(function(Xe){return Q.addKey(Xe)}):Q.addKey(ie)}(x||M).forEach(function(ie,Fe){var te=x&&re(x[Fe]),Fe=M&&re(M[Fe]);ce(te,Fe)!==0&&(te!=null&&ne(te),Fe!=null&&ne(Fe))})}))):K?(q={from:(q=K.lower)!==null&&q!==void 0?q:a.MIN_KEY,to:(q=K.upper)!==null&&q!==void 0?q:a.MAX_KEY},j.add(q),$.add(q)):($.add(c),j.add(c),p.indexes.forEach(function(F){return I(F.name).add(c)})),d.mutate(E).then(function(F){return!K||E.type!=="add"&&E.type!=="put"||($.addKeys(F.results),k&&k.forEach(function(Q){for(var re=E.values.map(function(te){return Q.extractKey(te)}),ne=Q.keyPath.findIndex(function(te){return te===y.keyPath}),ie=0,Xe=F.results.length;ie<Xe;++ie)re[ie][ne]=F.results[ie];I(Q.name).addKeys(re)})),T.mutatedParts=di(T.mutatedParts||{},N),F})}}),w=function(I){var C=I.query,I=C.index,C=C.range;return[I,new qe((I=C.lower)!==null&&I!==void 0?I:a.MIN_KEY,(C=C.upper)!==null&&C!==void 0?C:a.MAX_KEY)]},R={get:function(E){return[y,new qe(E.key)]},getMany:function(E){return[y,new qe().addKeys(E.keys)]},count:w,query:w,openCursor:w};return u(R).forEach(function(E){P[E]=function(I){var C=Y.subscr,x=!!C,M=$s(Y,d)&&Ls(E,I)?I.obsSet={}:C;if(x){var T=function(q){return q="idb://".concat(o,"/").concat(f,"/").concat(q),M[q]||(M[q]=new qe)},N=T(""),$=T(":dels"),C=R[E](I),x=C[0],C=C[1];if((E==="query"&&x.isPrimaryKey&&!I.values?$:T(x.name||"")).add(C),!x.isPrimaryKey){if(E!=="count"){var j=E==="query"&&S&&I.values&&d.query(n(n({},I),{values:!1}));return d[E].apply(this,arguments).then(function(q){if(E==="query"){if(S&&I.values)return j.then(function(re){return re=re.result,N.addKeys(re),q});var W=I.values?q.result.map(b):q.result;(I.values?N:$).addKeys(W)}else if(E==="openCursor"){var F=q,Q=I.values;return F&&Object.create(F,{key:{get:function(){return $.addKey(F.primaryKey),F.key}},primaryKey:{get:function(){var re=F.primaryKey;return $.addKey(re),re}},value:{get:function(){return Q&&N.addKey(F.primaryKey),F.value}}})}return q})}$.add(c)}}return d[E].apply(this,arguments)}}),P}})}};function Bs(a,o,c){if(c.numFailures===0)return o;if(o.type==="deleteRange")return null;var f=o.keys?o.keys.length:"values"in o&&o.values?o.values.length:1;return c.numFailures===f?null:(o=n({},o),l(o.keys)&&(o.keys=o.keys.filter(function(d,p){return!(p in c.failures)})),"values"in o&&l(o.values)&&(o.values=o.values.filter(function(d,p){return!(p in c.failures)})),o)}function Na(a,o){return c=a,((f=o).lower===void 0||(f.lowerOpen?0<ce(c,f.lower):0<=ce(c,f.lower)))&&(a=a,(o=o).upper===void 0||(o.upperOpen?ce(a,o.upper)<0:ce(a,o.upper)<=0));var c,f}function js(a,o,R,f,d,p){if(!R||R.length===0)return a;var y=o.query.index,b=y.multiEntry,S=o.query.range,k=f.schema.primaryKey.extractKey,P=y.extractKey,w=(y.lowLevelIndex||y).extractKey,R=R.reduce(function(E,I){var C=E,x=[];if(I.type==="add"||I.type==="put")for(var M=new qe,T=I.values.length-1;0<=T;--T){var N,$=I.values[T],j=k($);M.hasKey(j)||(N=P($),(b&&l(N)?N.some(function(F){return Na(F,S)}):Na(N,S))&&(M.addKey(j),x.push($)))}switch(I.type){case"add":var U=new qe().addKeys(o.values?E.map(function(Q){return k(Q)}):E),C=E.concat(o.values?x.filter(function(Q){return Q=k(Q),!U.hasKey(Q)&&(U.addKey(Q),!0)}):x.map(function(Q){return k(Q)}).filter(function(Q){return!U.hasKey(Q)&&(U.addKey(Q),!0)}));break;case"put":var K=new qe().addKeys(I.values.map(function(Q){return k(Q)}));C=E.filter(function(Q){return!K.hasKey(o.values?k(Q):Q)}).concat(o.values?x:x.map(function(Q){return k(Q)}));break;case"delete":var q=new qe().addKeys(I.keys);C=E.filter(function(Q){return!q.hasKey(o.values?k(Q):Q)});break;case"deleteRange":var W=I.range;C=E.filter(function(Q){return!Na(k(Q),W)})}return C},a);return R===a?a:(R.sort(function(E,I){return ce(w(E),w(I))||ce(k(E),k(I))}),o.limit&&o.limit<1/0&&(R.length>o.limit?R.length=o.limit:a.length===o.limit&&R.length<o.limit&&(d.dirty=!0)),p?Object.freeze(R):R)}function Ks(a,o){return ce(a.lower,o.lower)===0&&ce(a.upper,o.upper)===0&&!!a.lowerOpen==!!o.lowerOpen&&!!a.upperOpen==!!o.upperOpen}function Af(a,o){return function(c,f,d,p){if(c===void 0)return f!==void 0?-1:0;if(f===void 0)return 1;if((f=ce(c,f))===0){if(d&&p)return 0;if(d)return 1;if(p)return-1}return f}(a.lower,o.lower,a.lowerOpen,o.lowerOpen)<=0&&0<=function(c,f,d,p){if(c===void 0)return f!==void 0?1:0;if(f===void 0)return-1;if((f=ce(c,f))===0){if(d&&p)return 0;if(d)return-1;if(p)return 1}return f}(a.upper,o.upper,a.upperOpen,o.upperOpen)}function Mf(a,o,c,f){a.subscribers.add(c),f.addEventListener("abort",function(){var d,p;a.subscribers.delete(c),a.subscribers.size===0&&(d=a,p=o,setTimeout(function(){d.subscribers.size===0&&he(p,d)},3e3))})}var Tf={stack:"dbcore",level:0,name:"Cache",create:function(a){var o=a.schema.name;return n(n({},a),{transaction:function(c,f,d){var p,y,b=a.transaction(c,f,d);return f==="readwrite"&&(y=(p=new AbortController).signal,d=function(S){return function(){if(p.abort(),f==="readwrite"){for(var k=new Set,P=0,w=c;P<w.length;P++){var R=w[P],E=nr["idb://".concat(o,"/").concat(R)];if(E){var I=a.table(R),C=E.optimisticOps.filter(function(Q){return Q.trans===b});if(b._explicit&&S&&b.mutatedParts)for(var x=0,M=Object.values(E.queries.query);x<M.length;x++)for(var T=0,N=(U=M[x]).slice();T<N.length;T++)Pa((K=N[T]).obsSet,b.mutatedParts)&&(he(U,K),K.subscribers.forEach(function(Q){return k.add(Q)}));else if(0<C.length){E.optimisticOps=E.optimisticOps.filter(function(Q){return Q.trans!==b});for(var $=0,j=Object.values(E.queries.query);$<j.length;$++)for(var U,K,q,W=0,F=(U=j[$]).slice();W<F.length;W++)(K=F[W]).res!=null&&b.mutatedParts&&(S&&!K.dirty?(q=Object.isFrozen(K.res),q=js(K.res,K.req,C,I,K,q),K.dirty?(he(U,K),K.subscribers.forEach(function(Q){return k.add(Q)})):q!==K.res&&(K.res=q,K.promise=H.resolve({result:q}))):(K.dirty&&he(U,K),K.subscribers.forEach(function(Q){return k.add(Q)})))}}}k.forEach(function(Q){return Q()})}}},b.addEventListener("abort",d(!1),{signal:y}),b.addEventListener("error",d(!1),{signal:y}),b.addEventListener("complete",d(!0),{signal:y})),b},table:function(c){var f=a.table(c),d=f.schema.primaryKey;return n(n({},f),{mutate:function(p){var y=Y.trans;if(d.outbound||y.db._options.cache==="disabled"||y.explicit||y.idbtrans.mode!=="readwrite")return f.mutate(p);var b=nr["idb://".concat(o,"/").concat(c)];return b?(y=f.mutate(p),p.type!=="add"&&p.type!=="put"||!(50<=p.values.length||Ta(d,p).some(function(S){return S==null}))?(b.optimisticOps.push(p),p.mutatedParts&&pi(p.mutatedParts),y.then(function(S){0<S.numFailures&&(he(b.optimisticOps,p),(S=Bs(0,p,S))&&b.optimisticOps.push(S),p.mutatedParts&&pi(p.mutatedParts))}),y.catch(function(){he(b.optimisticOps,p),p.mutatedParts&&pi(p.mutatedParts)})):y.then(function(S){var k=Bs(0,n(n({},p),{values:p.values.map(function(P,w){var R;return S.failures[w]?P:(P=(R=d.keyPath)!==null&&R!==void 0&&R.includes(".")?we(P):n({},P),Z(P,d.keyPath,S.results[w]),P)})}),S);b.optimisticOps.push(k),queueMicrotask(function(){return p.mutatedParts&&pi(p.mutatedParts)})}),y):f.mutate(p)},query:function(p){if(!$s(Y,f)||!Ls("query",p))return f.query(p);var y=((k=Y.trans)===null||k===void 0?void 0:k.db._options.cache)==="immutable",w=Y,b=w.requery,S=w.signal,k=function(I,C,x,M){var T=nr["idb://".concat(I,"/").concat(C)];if(!T)return[];if(!(C=T.queries[x]))return[null,!1,T,null];var N=C[(M.query?M.query.index.name:null)||""];if(!N)return[null,!1,T,null];switch(x){case"query":var $=N.find(function(j){return j.req.limit===M.limit&&j.req.values===M.values&&Ks(j.req.query.range,M.query.range)});return $?[$,!0,T,N]:[N.find(function(j){return("limit"in j.req?j.req.limit:1/0)>=M.limit&&(!M.values||j.req.values)&&Af(j.req.query.range,M.query.range)}),!1,T,N];case"count":return $=N.find(function(j){return Ks(j.req.query.range,M.query.range)}),[$,!!$,T,N]}}(o,c,"query",p),P=k[0],w=k[1],R=k[2],E=k[3];return P&&w?P.obsSet=p.obsSet:(w=f.query(p).then(function(I){var C=I.result;if(P&&(P.res=C),y){for(var x=0,M=C.length;x<M;++x)Object.freeze(C[x]);Object.freeze(C)}else I.result=we(C);return I}).catch(function(I){return E&&P&&he(E,P),Promise.reject(I)}),P={obsSet:p.obsSet,promise:w,subscribers:new Set,type:"query",req:p,dirty:!1},E?E.push(P):(E=[P],(R=R||(nr["idb://".concat(o,"/").concat(c)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[p.query.index.name||""]=E)),Mf(P,E,b,S),P.promise.then(function(I){return{result:js(I.result,p,R==null?void 0:R.optimisticOps,f,P,y)}})}})}})}};function vi(a,o){return new Proxy(a,{get:function(c,f,d){return f==="db"?o:Reflect.get(c,f,d)}})}var Ot=(De.prototype.version=function(a){if(isNaN(a)||a<.1)throw new J.Type("Given version is not a positive number");if(a=Math.round(10*a)/10,this.idbdb||this._state.isBeingOpened)throw new J.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,a);var o=this._versions,c=o.filter(function(f){return f._cfg.version===a})[0];return c||(c=new this.Version(a),o.push(c),o.sort(Ef),c.stores({}),this._state.autoSchema=!1,c)},De.prototype._whenReady=function(a){var o=this;return this.idbdb&&(this._state.openComplete||Y.letThrough||this._vip)?a():new H(function(c,f){if(o._state.openComplete)return f(new J.DatabaseClosed(o._state.dbOpenError));if(!o._state.isBeingOpened){if(!o._state.autoOpen)return void f(new J.DatabaseClosed);o.open().catch(de)}o._state.dbReadyPromise.then(c,f)}).then(a)},De.prototype.use=function(a){var o=a.stack,c=a.create,f=a.level,d=a.name;return d&&this.unuse({stack:o,name:d}),a=this._middlewares[o]||(this._middlewares[o]=[]),a.push({stack:o,create:c,level:f??10,name:d}),a.sort(function(p,y){return p.level-y.level}),this},De.prototype.unuse=function(a){var o=a.stack,c=a.name,f=a.create;return o&&this._middlewares[o]&&(this._middlewares[o]=this._middlewares[o].filter(function(d){return f?d.create!==f:!!c&&d.name!==c})),this},De.prototype.open=function(){var a=this;return er(Lt,function(){return If(a)})},De.prototype._close=function(){var a=this._state,o=Cr.indexOf(this);if(0<=o&&Cr.splice(o,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}a.isBeingOpened||(a.dbReadyPromise=new H(function(c){a.dbReadyResolve=c}),a.openCanceller=new H(function(c,f){a.cancelOpen=f}))},De.prototype.close=function(c){var o=(c===void 0?{disableAutoOpen:!0}:c).disableAutoOpen,c=this._state;o?(c.isBeingOpened&&c.cancelOpen(new J.DatabaseClosed),this._close(),c.autoOpen=!1,c.dbOpenError=new J.DatabaseClosed):(this._close(),c.autoOpen=this._options.autoOpen||c.isBeingOpened,c.openComplete=!1,c.dbOpenError=null)},De.prototype.delete=function(a){var o=this;a===void 0&&(a={disableAutoOpen:!0});var c=0<arguments.length&&typeof arguments[0]!="object",f=this._state;return new H(function(d,p){function y(){o.close(a);var b=o._deps.indexedDB.deleteDatabase(o.name);b.onsuccess=Ee(function(){var S,k,P;S=o._deps,k=o.name,P=S.indexedDB,S=S.IDBKeyRange,ka(P)||k===ti||Oa(P,S).delete(k).catch(de),d()}),b.onerror=vt(p),b.onblocked=o._fireOnBlocked}if(c)throw new J.InvalidArgument("Invalid closeOptions argument to db.delete()");f.isBeingOpened?f.dbReadyPromise.then(y):y()})},De.prototype.backendDB=function(){return this.idbdb},De.prototype.isOpen=function(){return this.idbdb!==null},De.prototype.hasBeenClosed=function(){var a=this._state.dbOpenError;return a&&a.name==="DatabaseClosed"},De.prototype.hasFailed=function(){return this._state.dbOpenError!==null},De.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(De.prototype,"tables",{get:function(){var a=this;return u(this._allTables).map(function(o){return a._allTables[o]})},enumerable:!1,configurable:!0}),De.prototype.transaction=function(){var a=(function(o,c,f){var d=arguments.length;if(d<2)throw new J.InvalidArgument("Too few arguments");for(var p=new Array(d-1);--d;)p[d-1]=arguments[d];return f=p.pop(),[o,xe(p),f]}).apply(this,arguments);return this._transaction.apply(this,a)},De.prototype._transaction=function(a,o,c){var f=this,d=Y.trans;d&&d.db===this&&a.indexOf("!")===-1||(d=null);var p,y,b=a.indexOf("?")!==-1;a=a.replace("!","").replace("?","");try{if(y=o.map(function(k){if(k=k instanceof f.Table?k.name:k,typeof k!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return k}),a=="r"||a===ha)p=ha;else{if(a!="rw"&&a!=da)throw new J.InvalidArgument("Invalid transaction mode: "+a);p=da}if(d){if(d.mode===ha&&p===da){if(!b)throw new J.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");d=null}d&&y.forEach(function(k){if(d&&d.storeNames.indexOf(k)===-1){if(!b)throw new J.SubTransaction("Table "+k+" not included in parent transaction.");d=null}}),b&&d&&!d.active&&(d=null)}}catch(k){return d?d._promise(null,function(P,w){w(k)}):Pe(k)}var S=(function k(P,w,R,E,I){return H.resolve().then(function(){var C=Y.transless||Y,x=P._createTransaction(w,R,P._dbSchema,E);if(x.explicit=!0,C={trans:x,transless:C},E)x.idbtrans=E.idbtrans;else try{x.create(),x.idbtrans._explicit=!0,P._state.PR1398_maxLoop=3}catch(N){return N.name===ra.InvalidState&&P.isOpen()&&0<--P._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),P.close({disableAutoOpen:!1}),P.open().then(function(){return k(P,w,R,null,I)})):Pe(N)}var M,T=Be(I);return T&&Dr(),C=H.follow(function(){var N;(M=I.call(x,x))&&(T?(N=jt.bind(null,null),M.then(N,N)):typeof M.next=="function"&&typeof M.throw=="function"&&(M=Aa(M)))},C),(M&&typeof M.then=="function"?H.resolve(M).then(function(N){return x.active?N:Pe(new J.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):C.then(function(){return M})).then(function(N){return E&&x._resolve(),x._completion.then(function(){return N})}).catch(function(N){return x._reject(N),Pe(N)})})}).bind(null,this,p,y,d,c);return d?d._promise(p,S,"lock"):Y.trans?er(Y.transless,function(){return f._whenReady(S)}):this._whenReady(S)},De.prototype.table=function(a){if(!g(this._allTables,a))throw new J.InvalidTable("Table ".concat(a," does not exist"));return this._allTables[a]},De);function De(a,o){var c=this;this._middlewares={},this.verno=0;var f=De.dependencies;this._options=o=n({addons:De.addons,autoOpen:!0,indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange,cache:"cloned"},o),this._deps={indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange},f=o.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var d,p,y,b,S,k={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:de,dbReadyPromise:null,cancelOpen:de,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:o.autoOpen};k.dbReadyPromise=new H(function(w){k.dbReadyResolve=w}),k.openCanceller=new H(function(w,R){k.cancelOpen=R}),this._state=k,this.name=a,this.on=an(this,"populate","blocked","versionchange","close",{ready:[na,de]}),this.on.ready.subscribe=V(this.on.ready.subscribe,function(w){return function(R,E){De.vip(function(){var I,C=c._state;C.openComplete?(C.dbOpenError||H.resolve().then(R),E&&w(R)):C.onReadyBeingFired?(C.onReadyBeingFired.push(R),E&&w(R)):(w(R),I=c,E||w(function x(){I.on.ready.unsubscribe(R),I.on.ready.unsubscribe(x)}))})}}),this.Collection=(d=this,on(vf.prototype,function(M,x){this.db=d;var E=ys,I=null;if(x)try{E=x()}catch(T){I=T}var C=M._ctx,x=C.table,M=x.hook.reading.fire;this._ctx={table:x,index:C.index,isPrimKey:!C.index||x.schema.primKey.keyPath&&C.index===x.schema.primKey.name,range:E,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:I,or:C.or,valueMapper:M!==Zr?M:null}})),this.Table=(p=this,on(_s.prototype,function(w,R,E){this.db=p,this._tx=E,this.name=w,this.schema=R,this.hook=p._allTables[w]?p._allTables[w].hook:an(null,{creating:[sf,de],reading:[of,Zr],updating:[cf,de],deleting:[uf,de]})})),this.Transaction=(y=this,on(bf.prototype,function(w,R,E,I,C){var x=this;this.db=y,this.mode=w,this.storeNames=R,this.schema=E,this.chromeTransactionDurability=I,this.idbtrans=null,this.on=an(this,"complete","error","abort"),this.parent=C||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new H(function(M,T){x._resolve=M,x._reject=T}),this._completion.then(function(){x.active=!1,x.on.complete.fire()},function(M){var T=x.active;return x.active=!1,x.on.error.fire(M),x.parent?x.parent._reject(M):T&&x.idbtrans&&x.idbtrans.abort(),Pe(M)})})),this.Version=(b=this,on(xf.prototype,function(w){this.db=b,this._cfg={version:w,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(S=this,on(xs.prototype,function(w,R,E){if(this.db=S,this._ctx={table:w,index:R===":id"?null:R,or:E},this._cmp=this._ascending=ce,this._descending=function(I,C){return ce(C,I)},this._max=function(I,C){return 0<ce(I,C)?I:C},this._min=function(I,C){return ce(I,C)<0?I:C},this._IDBKeyRange=S._deps.IDBKeyRange,!this._IDBKeyRange)throw new J.MissingAPI})),this.on("versionchange",function(w){0<w.newVersion?console.warn("Another connection wants to upgrade database '".concat(c.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(c.name,"'. Closing db now to resume the delete request.")),c.close({disableAutoOpen:!1})}),this.on("blocked",function(w){!w.newVersion||w.newVersion<w.oldVersion?console.warn("Dexie.delete('".concat(c.name,"') was blocked")):console.warn("Upgrade '".concat(c.name,"' blocked by other connection holding version ").concat(w.oldVersion/10))}),this._maxKey=ln(o.IDBKeyRange),this._createTransaction=function(w,R,E,I){return new c.Transaction(w,R,E,c._options.chromeTransactionDurability,I)},this._fireOnBlocked=function(w){c.on("blocked").fire(w),Cr.filter(function(R){return R.name===c.name&&R!==c&&!R._state.vcFired}).map(function(R){return R.on("versionchange").fire(w)})},this.use(Cf),this.use(Tf),this.use(Rf),this.use(Pf),this.use(Df);var P=new Proxy(this,{get:function(w,R,E){if(R==="_vip")return!0;if(R==="table")return function(C){return vi(c.table(C),P)};var I=Reflect.get(w,R,E);return I instanceof _s?vi(I,P):R==="tables"?I.map(function(C){return vi(C,P)}):R==="_createTransaction"?function(){return vi(I.apply(this,arguments),P)}:I}});this.vip=P,f.forEach(function(w){return w(c)})}var yi,ct=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Nf=($a.prototype.subscribe=function(a,o,c){return this._subscribe(a&&typeof a!="function"?a:{next:a,error:o,complete:c})},$a.prototype[ct]=function(){return this},$a);function $a(a){this._subscribe=a}try{yi={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch{yi={indexedDB:null,IDBKeyRange:null}}function qs(a){var o,c=!1,f=new Nf(function(d){var p=Be(a),y,b=!1,S={},k={},P={get closed(){return b},unsubscribe:function(){b||(b=!0,y&&y.abort(),w&&Ft.storagemutated.unsubscribe(E))}};d.start&&d.start(P);var w=!1,R=function(){return fa(I)},E=function(C){di(S,C),Pa(k,S)&&R()},I=function(){var C,x,M;!b&&yi.indexedDB&&(S={},C={},y&&y.abort(),y=new AbortController,M=function(T){var N=Ir();try{p&&Dr();var $=Bt(a,T);return $=p?$.finally(jt):$}finally{N&&Pr()}}(x={subscr:C,signal:y.signal,requery:R,querier:a,trans:null}),Promise.resolve(M).then(function(T){c=!0,o=T,b||x.signal.aborted||(S={},function(N){for(var $ in N)if(g(N,$))return;return 1}(k=C)||w||(Ft(cn,E),w=!0),fa(function(){return!b&&d.next&&d.next(T)}))},function(T){c=!1,["DatabaseClosedError","AbortError"].includes(T==null?void 0:T.name)||b||fa(function(){b||d.error&&d.error(T)})}))};return setTimeout(R,0),P});return f.hasValue=function(){return c},f.getValue=function(){return o},f}var ir=Ot;function La(a){var o=Ut;try{Ut=!0,Ft.storagemutated.fire(a),Ra(a,!0)}finally{Ut=o}}_(ir,n(n({},zn),{delete:function(a){return new ir(a,{addons:[]}).delete()},exists:function(a){return new ir(a,{addons:[]}).open().then(function(o){return o.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(a){try{return o=ir.dependencies,c=o.indexedDB,o=o.IDBKeyRange,(ka(c)?Promise.resolve(c.databases()).then(function(f){return f.map(function(d){return d.name}).filter(function(d){return d!==ti})}):Oa(c,o).toCollection().primaryKeys()).then(a)}catch{return Pe(new J.MissingAPI)}var o,c},defineClass:function(){return function(a){h(this,a)}},ignoreTransaction:function(a){return Y.trans?er(Y.transless,a):a()},vip:xa,async:function(a){return function(){try{var o=Aa(a.apply(this,arguments));return o&&typeof o.then=="function"?o:H.resolve(o)}catch(c){return Pe(c)}}},spawn:function(a,o,c){try{var f=Aa(a.apply(c,o||[]));return f&&typeof f.then=="function"?f:H.resolve(f)}catch(d){return Pe(d)}},currentTransaction:{get:function(){return Y.trans||null}},waitFor:function(a,o){return o=H.resolve(typeof a=="function"?ir.ignoreTransaction(a):a).timeout(o||6e4),Y.trans?Y.trans.waitFor(o):o},Promise:H,debug:{get:function(){return mt},set:function(a){ls(a)}},derive:A,extend:h,props:_,override:V,Events:an,on:Ft,liveQuery:qs,extendObservabilitySet:di,getByKeyPath:ee,setByKeyPath:Z,delByKeyPath:function(a,o){typeof o=="string"?Z(a,o,void 0):"length"in o&&[].map.call(o,function(c){Z(a,c,void 0)})},shallowClone:ue,deepClone:we,getObjectDiff:Ma,cmp:ce,asap:X,minKey:-1/0,addons:[],connections:Cr,errnames:ra,dependencies:yi,cache:nr,semVer:"4.0.10",version:"4.0.10".split(".").map(function(a){return parseInt(a)}).reduce(function(a,o,c){return a+o/Math.pow(10,2*c)})})),ir.maxKey=ln(ir.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ft(cn,function(a){Ut||(a=new CustomEvent(ya,{detail:a}),Ut=!0,dispatchEvent(a),Ut=!1)}),addEventListener(ya,function(a){a=a.detail,Ut||La(a)}));var Mr,Ut=!1,Fs=function(){};return typeof BroadcastChannel<"u"&&((Fs=function(){(Mr=new BroadcastChannel(ya)).onmessage=function(a){return a.data&&La(a.data)}})(),typeof Mr.unref=="function"&&Mr.unref(),Ft(cn,function(a){Ut||Mr.postMessage(a)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(a){if(!Ot.disableBfCache&&a.persisted){mt&&console.debug("Dexie: handling persisted pagehide"),Mr!=null&&Mr.close();for(var o=0,c=Cr;o<c.length;o++)c[o].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(a){!Ot.disableBfCache&&a.persisted&&(mt&&console.debug("Dexie: handling persisted pageshow"),Fs(),La({all:new qe(-1/0,[[]])}))})),H.rejectionMapper=function(a,o){return!a||a instanceof Ce||a instanceof TypeError||a instanceof SyntaxError||!a.name||!cs[a.name]?a:(o=new cs[a.name](o||a.message,a),"stack"in a&&D(o,"stack",{get:function(){return this.inner.stack}}),o)},ls(mt),n(Ot,Object.freeze({__proto__:null,Dexie:Ot,liveQuery:qs,Entity:gs,cmp:ce,PropModSymbol:Et,PropModification:sn,replacePrefix:function(a,o){return new sn({replacePrefix:[a,o]})},add:function(a){return new sn({add:a})},remove:function(a){return new sn({remove:a})},default:Ot,RangeSet:qe,mergeRanges:dn,rangesOverlap:Rs}),{default:Ot}),Ot})})(Kl);var eg=Kl.exports;const xo=Bf(eg),Du=Symbol.for("Dexie"),qi=globalThis[Du]||(globalThis[Du]=xo);if(xo.semVer!==qi.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${xo.semVer} and ${qi.semVer}`);const{liveQuery:nb,mergeRanges:ib,rangesOverlap:ab,RangeSet:ob,cmp:sb,Entity:ub,PropModSymbol:cb,PropModification:lb,replacePrefix:fb,add:hb,remove:db}=qi;var Fi="docs",tg="changes",Cu="attachments",ql="dexie",Ru=new Map,Di=new Map;function rg(e,t,r,n){var i="rxdb-dexie-"+e+"--"+n.version+"--"+t,s=Pt(Ru,i,()=>{var u=(async()=>{var l=Se(r);l.autoOpen=!1;var h=new qi(i,l),m={[Fi]:ag(n),[tg]:"++sequence, id",[Cu]:"id"};return h.version(1).stores(m),await h.open(),{dexieDb:h,dexieTable:h[Fi],dexieAttachmentsTable:h[Cu],booleanIndexes:og(n)}})();return Ru.set(i,s),Di.set(s,0),u});return s}async function ng(e){var t=await e,r=Di.get(e),n=r-1;n===0?(t.dexieDb.close(),Di.delete(e)):Di.set(e,n)}var Io="__";function Xr(e){var t=e.split(".");if(t.length>1)return t.map(n=>Xr(n)).join(".");if(e.startsWith("|")){var r=e.substring(1);return Io+r}else return e}function Fl(e){var t=e.split(".");if(t.length>1)return t.map(n=>Fl(n)).join(".");if(e.startsWith(Io)){var r=e.substring(Io.length);return"|"+r}else return e}function ig(e,t){if(!t)return t;var r=Se(t);return r=Po(r),e.forEach(n=>{var i=Vt(t,n),s=i?"1":"0",u=Xr(n);Xu(r,u,s)}),r}function Ul(e,t){return t&&(t=Se(t),t=Do(t),e.forEach(r=>{var n=Vt(t,r),i=n==="1";Xu(t,r,i)}),t)}function Po(e){if(!e||typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(Array.isArray(e))return e.map(r=>Po(r));if(typeof e=="object"){var t={};return Object.entries(e).forEach(([r,n])=>{typeof n=="object"&&(n=Po(n)),t[Xr(r)]=n}),t}}function Do(e){if(!e||typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(Array.isArray(e))return e.map(r=>Do(r));if(typeof e=="object"){var t={};return Object.entries(e).forEach(([r,n])=>{(typeof n=="object"||Array.isArray(e))&&(n=Do(n)),t[Fl(r)]=n}),t}}function ag(e){var t=[],r=at(e.primaryKey);t.push([r]),t.push(["_deleted",r]),e.indexes&&e.indexes.forEach(s=>{var u=Ro(s);t.push(u)}),t.push(["_meta.lwt",r]),t.push(["_meta.lwt"]),t=t.map(s=>s.map(u=>Xr(u)));var n=t.map(s=>s.length===1?s[0]:"["+s.join("+")+"]");n=n.filter((s,u,l)=>l.indexOf(s)===u);var i=n.join(", ");return i}async function Au(e,t){var r=await e,n=await r.dexieTable.bulkGet(t);return n.map(i=>Ul(r.booleanIndexes,i))}function Si(e,t){return e+"||"+t}function og(e){var t=new Set,r=[];return e.indexes?(e.indexes.forEach(n=>{var i=Ro(n);i.forEach(s=>{if(!t.has(s)){t.add(s);var u=Kr(e,s);u.type==="boolean"&&r.push(s)}})}),r.push("_deleted"),Hf(r)):r}function Mu(e){return e===jr?-1/0:e}function Tu(e,t,r){if(e.includes(t)){var n=r===Br||r===!0?"1":"0";return n}else return r}function Wl(e,t,r){if(!r){if(typeof window>"u")throw new Error("IDBKeyRange missing");r=window.IDBKeyRange}var n=t.startKeys.map((u,l)=>{var h=t.index[l];return Tu(e,h,u)}).map(Mu),i=t.endKeys.map((u,l)=>{var h=t.index[l];return Tu(e,h,u)}).map(Mu),s=r.bound(n,i,!t.inclusiveStart,!t.inclusiveEnd);return s}async function Nu(e,t){var r=await e.internals,n=t.query,i=n.skip?n.skip:0,s=n.limit?n.limit:1/0,u=i+s,l=t.queryPlan,h=!1;l.selectorSatisfiedByIndex||(h=Zo(e.schema,t.query));var m=Wl(r.booleanIndexes,l,r.dexieDb._options.IDBKeyRange),v=l.index,g=[];if(await r.dexieDb.transaction("r",r.dexieTable,async O=>{var D=O.idbtrans,A=D.objectStore(Fi),L,B;B="["+v.map(V=>Xr(V)).join("+")+"]",L=A.index(B);var z=L.openCursor(m);await new Promise(V=>{z.onsuccess=function(se){var X=se.target.result;if(X){var ee=Ul(r.booleanIndexes,X.value);(!h||h(ee))&&g.push(ee),l.sortSatisfiedByIndex&&g.length===u?V():X.continue()}else V()}})}),!l.sortSatisfiedByIndex){var _=al(e.schema,t.query);g=g.sort(_)}return g=g.slice(i,u),{documents:g}}async function sg(e,t){var r=await e.internals,n=t.queryPlan,i=n.index,s=Wl(r.booleanIndexes,n,r.dexieDb._options.IDBKeyRange),u=-1;return await r.dexieDb.transaction("r",r.dexieTable,async l=>{var h=l.idbtrans,m=h.objectStore(Fi),v,g;g="["+i.map(O=>Xr(O)).join("+")+"]",v=m.index(g);var _=v.count(s);u=await new Promise((O,D)=>{_.onsuccess=function(){O(_.result)},_.onerror=A=>D(A)})}),u}var ug=je(),to=!1,cg=function(){function e(r,n,i,s,u,l,h,m){this.changes$=new tt,this.instanceId=ug++,this.storage=r,this.databaseName=n,this.collectionName=i,this.schema=s,this.internals=u,this.options=l,this.settings=h,this.devMode=m,this.primaryPath=at(this.schema.primaryKey)}var t=e.prototype;return t.bulkWrite=async function(n,i){sr(this),!to&&(!Ua.premium||typeof Ua.premium!="string"||await Vu(Ua.premium)!==Sh)&&console.warn(["-------------- RxDB Open Core RxStorage -------------------------------","You are using the free Dexie.js based RxStorage implementation from RxDB https://rxdb.info/rx-storage-dexie.html?console=dexie ","While this is a great option, we want to let you know that there are faster storage solutions available in our premium plugins.","For professional users and production environments, we highly recommend considering these premium options to enhance performance and reliability."," https://rxdb.info/premium?console=dexie ","If you already purchased premium access you can disable this log by calling the setPremiumFlag() function from rxdb-premium/plugins/shared.","---------------------------------------------------------------------"].join(`
`)),to=!0,n.forEach(v=>{if(!v.document._rev||v.previous&&!v.previous._rev)throw G("SNH",{args:{row:v}})});var s=await this.internals,u={error:[]};this.devMode&&(n=n.map(v=>{var g=Un(v.document);return{previous:v.previous,document:g}}));var l=n.map(v=>v.document[this.primaryPath]),h;if(await s.dexieDb.transaction("rw",s.dexieTable,s.dexieAttachmentsTable,async()=>{var v=new Map,g=await Au(this.internals,l);g.forEach(D=>{var A=D;return A&&v.set(A[this.primaryPath],A),A}),h=rv(this,this.primaryPath,v,n,i),u.error=h.errors;var _=[];h.bulkInsertDocs.forEach(D=>{_.push(D.document)}),h.bulkUpdateDocs.forEach(D=>{_.push(D.document)}),_=_.map(D=>ig(s.booleanIndexes,D)),_.length>0&&await s.dexieTable.bulkPut(_);var O=[];h.attachmentsAdd.forEach(D=>{O.push({id:Si(D.documentId,D.attachmentId),data:D.attachmentData.data})}),h.attachmentsUpdate.forEach(D=>{O.push({id:Si(D.documentId,D.attachmentId),data:D.attachmentData.data})}),await s.dexieAttachmentsTable.bulkPut(O),await s.dexieAttachmentsTable.bulkDelete(h.attachmentsRemove.map(D=>Si(D.documentId,D.attachmentId)))}),h=ae(h),h.eventBulk.events.length>0){var m=ae(h.newestRow).document;h.eventBulk.checkpoint={id:m[this.primaryPath],lwt:m._meta.lwt},h.eventBulk.endTime=je(),this.changes$.next(h.eventBulk)}return u},t.findDocumentsById=async function(n,i){sr(this);var s=await this.internals,u=[];return await s.dexieDb.transaction("r",s.dexieTable,async()=>{var l=await Au(this.internals,n);l.forEach(h=>{h&&(!h._deleted||i)&&u.push(h)})}),u},t.query=function(n){return sr(this),Nu(this,n)},t.count=async function(n){if(n.queryPlan.selectorSatisfiedByIndex){var i=await sg(this,n);return{count:i,mode:"fast"}}else{var s=await Nu(this,n);return{count:s.documents.length,mode:"slow"}}},t.changeStream=function(){return sr(this),this.changes$.asObservable()},t.cleanup=async function(n){sr(this);var i=await this.internals;return await i.dexieDb.transaction("rw",i.dexieTable,async()=>{var s=je()-n,u=await i.dexieTable.where("_meta.lwt").below(s).toArray(),l=[];u.forEach(h=>{h._deleted==="1"&&l.push(h[this.primaryPath])}),await i.dexieTable.bulkDelete(l)}),!0},t.getAttachmentData=async function(n,i,s){sr(this);var u=await this.internals,l=Si(n,i);return await u.dexieDb.transaction("r",u.dexieAttachmentsTable,async()=>{var h=await u.dexieAttachmentsTable.get(l);if(h)return h.data;throw new Error("attachment missing documentId: "+n+" attachmentId: "+i)})},t.remove=async function(){sr(this);var n=await this.internals;return await n.dexieTable.clear(),this.close()},t.close=function(){return this.closed?this.closed:(this.closed=(async()=>{this.changes$.complete(),await ng(this.internals)})(),this.closed)},t.conflictResultionTasks=function(){return new tt},t.resolveConflictResultionTask=async function(n){},e}();async function lg(e,t,r){var n=rg(t.databaseName,t.collectionName,r,t.schema),i=new cg(e,t.databaseName,t.collectionName,t.schema,n,t.options,r,t.devMode);return await Zy(ql,t,i),Promise.resolve(i)}function sr(e){if(e.closed)throw new Error("RxStorageInstanceDexie is closed "+e.databaseName+"-"+e.collectionName)}var fg=function(){function e(r){this.name=ql,this.rxdbVersion=Zu,this.settings=r}var t=e.prototype;return t.createStorageInstance=function(n){return av(n),lg(this,n,this.settings)},e}();function pb(e={}){var t=new fg(e);return t}async function Hl(e){var t=Lh(e.collection.schema.jsonSchema).map(n=>e.collection.name+"-"+n),r=await e.database.internalStore.findDocumentsById(t.map(n=>Qr(n,pr)),!1);if(r.length>1)throw new Error("more than one old collection meta found");return r[0]}function hg(e,t,r){var n=Se(r._attachments),i=Qe(r),s=i._meta;delete i._meta,i._attachments=n;for(var u=t+1,l=Promise.resolve(i),h=function(){var m=u;l=l.then(v=>dg(e,m,v)),u++};u<=e.schema.version;)h();return l.then(m=>m===null?To:(m._meta=s,m))}function dg(e,t,r){if(r===null)return To;var n=e.migrationStrategies[t](r,e),i=ph(n);return i}async function zl(e){if(e.collection.schema.version===0)return pt;var t=await Hl(e);return!!t}var pg=200,Ql=new WeakMap;function mg(e){var t=Vl(e.database),r=t.getValue().slice(0);r.push(e),t.next(r)}function Vl(e){return Pt(Ql,e,()=>new cr([]))}function vg(e){var t=Ql.get(e);t&&t.complete()}var yg=function(){function e(r,n,i=[r.name,"v",r.schema.version].join("-")){this.started=!1,this.updateStatusHandlers=[],this.updateStatusQueue=mh,this.collection=r,this.migrationStrategies=n,this.statusDocKey=i,this.database=r.database,this.oldCollectionMeta=Hl(this),this.mustMigrate=zl(this),this.statusDocId=Qr(this.statusDocKey,Ii),mg(this),this.$=tv(this.database.internalStore,this.statusDocId).pipe(ye(s=>!!s),Te(s=>ae(s).data),Bn(Mn))}var t=e.prototype;return t.getStatus=function(){return fr(this.$)},t.startMigration=async function(n=pg){var i=await this.mustMigrate;if(i){if(this.started)throw G("DM1");this.started=!0;var s=void 0;if(this.database.multiInstance){s=new Zi(["rx-migration-state",this.database.name,this.collection.name,this.collection.schema.version].join("|"));var u=Jy(s);await u.awaitLeadership()}var l=await this.oldCollectionMeta,h=await this.database.storage.createStorageInstance({databaseName:this.database.name,collectionName:this.collection.name,databaseInstanceToken:this.database.token,multiInstance:this.database.multiInstance,options:{},schema:l.data.schema,password:this.database.password,devMode:ge.isDevMode()}),m=await this.getConnectedStorageInstances(),v=await this.countAllDoucments([h].concat(m.map(g=>g.oldStorage)));await this.updateStatus(g=>(g.count.total=v,g));try{await Promise.all(m.map(async g=>{await dv(this.collection,g.newStorage.collectionName,g.newStorage.schema),await this.migrateStorage(g.oldStorage,g.newStorage,n),await g.newStorage.close()})),await this.migrateStorage(h,this.collection.storageInstance.originalStorageInstance,n)}catch(g){await h.close(),await this.updateStatus(_=>(_.status="ERROR",_.error=_h(g),_));return}await Cn(this.database.internalStore,{previous:l,document:Object.assign({},l,{_deleted:!0})},"rx-migration-remove-collection-meta"),await this.updateStatus(g=>(g.status="DONE",g)),s&&await s.close()}},t.updateStatus=function(n){return this.updateStatusHandlers.push(n),this.updateStatusQueue=this.updateStatusQueue.then(async()=>{if(this.updateStatusHandlers.length!==0){var i=this.updateStatusHandlers;for(this.updateStatusHandlers=[];;){var s=await Fn(this.database.internalStore,this.statusDocId),u=Qe(s);s||(u={id:this.statusDocId,key:this.statusDocKey,context:Ii,data:{collectionName:this.collection.name,status:"RUNNING",count:{total:0,handled:0,percent:0}},_deleted:!1,_meta:_r(),_rev:ht(),_attachments:{}});var l=ae(u).data;for(var h of i)l=h(l);if(l.count.percent=Math.round(l.count.handled/l.count.total*100),u&&s&&En(u.data,s.data))break;try{await Cn(this.database.internalStore,{previous:s,document:ae(u)},Ii);break}catch(m){if(!Hi(m))throw m}}}}),this.updateStatusQueue},t.migrateStorage=async function(n,i,s){var u=await this.database.storage.createStorageInstance({databaseName:this.database.name,collectionName:"rx-migration-state-meta-"+this.collection.name+"-"+this.collection.schema.version,databaseInstanceToken:this.database.token,multiInstance:this.database.multiInstance,options:{},schema:wu(n.schema,wo(n.schema)),password:this.database.password,devMode:ge.isDevMode()}),l=Pv(i,Bi,this.database.token,!0),h=xv({keepMeta:!0,identifier:["rx-migration-state",this.collection.name,n.schema.version,this.collection.schema.version].join("-"),replicationHandler:{masterChangesSince(){return Promise.resolve({checkpoint:null,documents:[]})},masterWrite:async v=>{v=await Promise.all(v.map(async _=>{var O=_.newDocumentState;if(i.schema.title===Pi&&(O=_.newDocumentState.docData,_.newDocumentState.isCheckpoint==="1"))return{assumedMasterState:void 0,newDocumentState:_.newDocumentState};var D=await hg(this.collection,n.schema.version,O),A={assumedMasterState:void 0,newDocumentState:i.schema.title===Pi?Object.assign({},_.newDocumentState,{docData:D}):D};return A})),v=v.filter(_=>!!_.newDocumentState);var g=await l.masterWrite(v);return g},masterChangeStream$:new tt().asObservable()},forkInstance:n,metaInstance:u,pushBatchSize:s,pullBatchSize:0,conflictHandler:Bi,hashFunction:this.database.hashFunction}),m=!1;if(h.events.error.subscribe(v=>m=v),h.events.processed.up.subscribe(()=>{this.updateStatus(v=>(v.count.handled=v.count.handled+1,v))}),await Iv(h),await Dv(h),await this.updateStatusQueue,m)throw await u.close(),m;await Promise.all([n.remove(),u.remove()])},t.countAllDoucments=async function(n){var i=0;return await Promise.all(n.map(async s=>{var u=Yi(s.schema,Dn(s.schema,{selector:{}})),l=await s.count(u);i+=l.count})),i},t.getConnectedStorageInstances=async function(){var n=await this.oldCollectionMeta,i=[];return await Promise.all(await Promise.all(n.data.connectedStorages.map(async s=>{if(s.schema.title!==Pi)throw new Error("unknown migration handling for schema");var u=wu(Qe(this.collection.schema.jsonSchema),wo(s.schema));u.version=this.collection.schema.version;var[l,h]=await Promise.all([this.database.storage.createStorageInstance({databaseInstanceToken:this.database.token,databaseName:this.database.name,devMode:ge.isDevMode(),multiInstance:this.database.multiInstance,options:{},schema:s.schema,password:this.database.password,collectionName:s.collectionName}),this.database.storage.createStorageInstance({databaseInstanceToken:this.database.token,databaseName:this.database.name,devMode:ge.isDevMode(),multiInstance:this.database.multiInstance,options:{},schema:u,password:this.database.password,collectionName:s.collectionName})]);i.push({oldStorage:l,newStorage:h})}))),i},t.migratePromise=async function(n){this.startMigration(n);var i=await this.mustMigrate;if(!i)return{status:"DONE",collectionName:this.collection.name,count:{handled:0,percent:0,total:0}};var s=await Promise.race([fr(this.$.pipe(ye(u=>u.status==="DONE"))),fr(this.$.pipe(ye(u=>u.status==="ERROR")))]);if(s.status==="ERROR")throw G("DM4",{collection:this.collection.name,error:s.error});return s},e}(),gg=pl(),bg=function(e){function t(r,n,i){var s;return s=e.call(this,null,n)||this,s.id=r,s.parent=i,s}return No(t,e),t}(gg),bn={get isLocal(){return!0},get allAttachments$(){throw G("LD1",{document:this})},get primaryPath(){return"id"},get primary(){return this.id},get $(){var e=this,t=yr(Co,this.parent);return e.parent.$.pipe(ye(r=>r.documentId===this.primary),ye(r=>r.isLocal),Te(r=>Oc(r)),jn(t.docCache.getLatestDocumentData(this.primary)),xn((r,n)=>r._rev===n._rev),Te(r=>t.docCache.getCachedRxDocument(r)),Bn(Mn))},get $$(){var e=this,t=ro(e),r=t.getReactivityFactory();return r.fromObservable(e.$,e.getLatest()._data,t)},get deleted$$(){var e=this,t=ro(e),r=t.getReactivityFactory();return r.fromObservable(e.deleted$,e.getLatest().deleted,t)},getLatest(){var e=yr(Co,this.parent),t=e.docCache.getLatestDocumentData(this.primary);return e.docCache.getCachedRxDocument(t)},get(e){if(e="data."+e,!!this._data){if(typeof e!="string")throw Ze("LD2",{objPath:e});var t=Vt(this._data,e);return t=ge.deepFreezeWhenDevMode(t),t}},get$(e){if(e="data."+e,ge.isDevMode()){if(e.includes(".item."))throw G("LD3",{objPath:e});if(e===this.primaryPath)throw G("LD4")}return this.$.pipe(Te(t=>t._data),Te(t=>Vt(t,e)),xn())},get$$(e){var t=ro(this),r=t.getReactivityFactory();return r.fromObservable(this.get$(e),this.getLatest().get(e),t)},async incrementalModify(e){var t=await wn(this.parent);return t.incrementalWriteQueue.addWrite(this._data,async r=>(r.data=await e(r.data,this),r)).then(r=>t.docCache.getCachedRxDocument(r))},incrementalPatch(e){return this.incrementalModify(t=>(Object.entries(e).forEach(([r,n])=>{t[r]=n}),t))},async _saveData(e){var t=await wn(this.parent),r=this._data;e.id=this.id;var n=[{previous:r,document:e}];return t.storageInstance.bulkWrite(n,"local-document-save-data").then(i=>{if(i.error[0])throw i.error[0];var s=it(this.collection.schema.primaryPath,n,i)[0];e=Se(e),e._rev=s._rev})},async remove(){var e=await wn(this.parent),t=Se(this._data);return t._deleted=!0,Cn(e.storageInstance,{previous:this._data,document:t},"local-document-remove").then(r=>e.docCache.getCachedRxDocument(r))}},$u=!1,wg=()=>{if(!$u){$u=!0;var e=Ji,t=Object.getOwnPropertyNames(e);t.forEach(n=>{var i=Object.getOwnPropertyDescriptor(bn,n);if(!i){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(bn,n,s)}});var r=n=>()=>{throw G("LD6",{functionName:n})};["populate","update","putAttachment","getAttachment","allAttachments"].forEach(n=>bn[n]=r(n))}};function _g(e,t){wg();var r=new bg(e.id,e,t);return Object.setPrototypeOf(r,bn),r.prototype=bn,r}function ro(e){var t=e.parent;return Bv(t)?t:t.database}var Ui=new WeakMap,Co=new WeakMap;function Lu(e){var t=e.database?e.database:e,r=e.database?e.name:"",n=(async()=>{var i=await Gl(t.token,t.storage,t.name,r,t.instanceCreationOptions,t.multiInstance);i=es(t,i,Yl);var s=new sl("id",t.eventBulks$.pipe(ye(v=>{var g=!1;return(r===""&&!v.collectionName||r!==""&&v.collectionName===r)&&(g=!0),g&&v.events[0].isLocal}),Te(v=>v.events)),v=>_g(v,e)),u=new dl(i,"id",()=>{},()=>{}),l=await t.storageToken,h=i.changeStream().subscribe(v=>{for(var g=new Array(v.events.length),_=v.events,O=e.database?e.name:void 0,D=0;D<_.length;D++){var A=_[D];g[D]={documentId:A.documentId,collectionName:O,isLocal:!0,operation:A.operation,documentData:ge.deepFreezeWhenDevMode(A.documentData),previousDocumentData:ge.deepFreezeWhenDevMode(A.previousDocumentData)}}var L={id:v.id,internal:!1,collectionName:e.database?e.name:void 0,storageToken:l,events:g,databaseToken:t.token,checkpoint:v.checkpoint,context:v.context,endTime:v.endTime,startTime:v.startTime};t.$emit(L)});e._subs.push(h);var m={database:t,parent:e,storageInstance:i,docCache:s,incrementalWriteQueue:u};return Co.set(e,m),m})();Ui.set(e,n)}function wn(e){var t=Ui.get(e);if(!t){var r=e.database?e.database:e,n=e.database?e.name:"";throw G("LD8",{database:r.name,collection:n})}return t}function Gl(e,t,r,n,i,s){return t.createStorageInstance({databaseInstanceToken:e,databaseName:r,collectionName:Sg(n),schema:Yl,options:i,multiInstance:s,devMode:ge.isDevMode()})}function Bu(e){var t=Ui.get(e);if(t)return Ui.delete(e),t.then(r=>r.storageInstance.close())}async function ju(e,t,r){var n=An(10),i=await Gl(n,e,t,r,{},!1);await i.remove()}function Sg(e){return"plugin-local-documents-"+e}var Yl=zi({title:"RxLocalDocument",version:0,primaryKey:"id",type:"object",properties:{id:{type:"string",maxLength:128},data:{type:"object",additionalProperties:!0}},required:["id","data"]});async function Ku(e,t){var r=await wn(this),n={id:e,data:t,_deleted:!1,_meta:_r(),_rev:ht(),_attachments:{}};return Cn(r.storageInstance,{document:n},"local-document-insert").then(i=>r.docCache.getCachedRxDocument(i))}function qu(e,t){return this.getLocal(e).then(r=>{if(r)return r.incrementalModify(()=>t);var n=this.insertLocal(e,t);return n})}async function Fu(e){var t=await wn(this),r=t.docCache,n=r.getLatestDocumentDataIfExists(e);return n?Promise.resolve(r.getCachedRxDocument(n)):Fn(t.storageInstance,e).then(i=>i?t.docCache.getCachedRxDocument(i):null)}function Uu(e){return this.$.pipe(jn(null),Ct(async t=>{if(t)return{changeEvent:t};var r=await this.getLocal(e);return{doc:r}}),Ct(async t=>{if(t.changeEvent){var r=t.changeEvent;if(!r.isLocal||r.documentId!==e)return{use:!1};var n=await this.getLocal(e);return{use:!0,doc:n}}else return{use:!0,doc:t.doc}}),ye(t=>t.use),Te(t=>t.doc))}var Eg={name:"local-documents",rxdb:!0,prototypes:{RxCollection:e=>{e.insertLocal=Ku,e.upsertLocal=qu,e.getLocal=Fu,e.getLocal$=Uu},RxDatabase:e=>{e.insertLocal=Ku,e.upsertLocal=qu,e.getLocal=Fu,e.getLocal$=Uu}},hooks:{createRxDatabase:{before:e=>{e.creator.localDocuments&&Lu(e.database)}},createRxCollection:{before:e=>{e.creator.localDocuments&&Lu(e.collection)}},preDestroyRxDatabase:{after:e=>Bu(e)},postDestroyRxCollection:{after:e=>Bu(e)},postRemoveRxDatabase:{after:e=>ju(e.storage,e.databaseName,"")},postRemoveRxCollection:{after:e=>ju(e.storage,e.databaseName,e.collectionName)}},overwritable:{}},Og=new WeakMap,kg={name:"migration-schema",rxdb:!0,init(){qv(Eg)},hooks:{preDestroyRxDatabase:{after:vg}},prototypes:{RxDatabase:e=>{e.migrationStates=function(){return Vl(this).pipe(Bn(Mn))}},RxCollection:e=>{e.getMigrationState=function(){return Pt(Og,this,()=>new yg(this.asRxCollection,this.migrationStrategies))},e.migrationNeeded=function(){return this.schema.version===0?pt:zl(this.getMigrationState())}}}},mb=kg;const ea=e=>He((t,r,n)=>{let i=0;if(r instanceof Array)for(const s of r)i=i|1<<s;else i=r;return e(t&i,i)}),xg=ea((e,t)=>e==0),Ig=ea((e,t)=>e==t),Pg=ea((e,t)=>e<t),Dg=ea((e,t)=>e>0),Cg=Object.freeze(Object.defineProperty({__proto__:null,$all:Rm,$and:Fc,$bitsAllClear:xg,$bitsAllSet:Ig,$bitsAnyClear:Pg,$bitsAnySet:Dg,$elemMatch:tl,$eq:Hc,$exists:nl,$expr:Pm,$gt:zc,$gte:Qc,$in:Vc,$jsonSchema:Dm,$lt:Gc,$lte:Yc,$mod:Zc,$ne:Jc,$nin:Xc,$nor:Uc,$not:Wc,$or:Xo,$regex:el,$size:rl,$type:il,$where:Cm},Symbol.toStringTag,{value:"Module"})),us=(e,t)=>{switch(e){case"deep":return fo(t);case"copy":return Ai(t)?new Date(t):Me(t)?[...t]:Oe(t)?{...t}:t;default:return t}},Rg=/^[a-z]+[a-zA-Z0-9]*$/;function Jl(e){if(!e.includes(".$"))return[{parent:e,selector:e},[]];const t=e.indexOf(".$"),r=e.indexOf("]"),n=e.substring(0,t),i=e.substring(t+3,r);Ae(i===""||Rg.test(i),"The filter <identifier> must begin with a lowercase letter and contain only alphanumeric characters.");const s=e.substring(r+2),[u,l]=s?Jl(s):[];return[{selector:e,parent:n,child:i||"$",next:u},[i,...l||[]].filter(Boolean)]}const Ye=(e,t,r,n,i)=>{const{parent:s,child:u,next:l}=t;if(!u){let m=!1;return Pn(e,s,(g,_)=>m=!!n(g,_)||m,i),m}const h=Yr(e,s);return Me(h)?h.map((m,v)=>r[u]&&!r[u].test({[u]:m})?!1:l?Ye(m,l,r,n,i):n(h,v)).some(Boolean):!1};function st(e,t,r,n){const i=[];for(const[s,u]of Object.entries(e)){const[l,h]=Jl(s);if(!h.length)n(u,l,{})&&i.push(l.parent);else{const m={};t.forEach(g=>{Object.keys(g).forEach(_=>{h.forEach(O=>{(_===O||_.startsWith(O+"."))&&(m[O]=m[O]||{},Object.assign(m[O],{[_]:g[_]}))})})});const v={};for(const[g,_]of Object.entries(m))v[g]=new Mt(_,r.queryOptions);n(u,l,v)&&i.push(l.parent)}}return i}const Ag=(e,t,r=[],n={})=>st(t,r,n,(i,s,u)=>{const l={$each:[i]};return Oe(i)&&rt(i,"$each")&&Object.assign(l,i),Ye(e,s,u,(h,m)=>{const v=h[m]||(h[m]=[]);return Yo([v,l.$each]).length===l.$each.length?!1:(h[m]=us(n.cloneMode,Fp(v.concat(l.$each))),!0)},{buildGraph:!0})}),Mg=new Set(["and","or","xor"]),Tg=(e,t,r=[],n={})=>st(t,r,n,(i,s,u)=>{const l=Object.keys(i);return Ae(l.length===1&&Mg.has(l[0]),`Invalid bit operator '${l[0]}'. Must be one of 'and', 'or', or 'xor'.`),Ye(e,s,u,(h,m)=>{let v=h[m];const g=i[l[0]];if(v!==void 0&&!(et(v)&&et(g)))return!1;switch(v=v||0,l[0]){case"and":h[m]=v&g;break;case"or":h[m]=v|g;break;case"xor":h[m]=v^g;break}return h[m]!==v},{buildGraph:!0})}),Ng=(e,t,r=[],n={})=>{const i=Date.now();return st(t,r,n,(s,u,l)=>Ye(e,u,l,(h,m)=>(h[m]=i,!0),{buildGraph:!0}))},$g=(e,t,r=[],n={})=>st(t,r,n,(i,s,u)=>{if(!s.child){const l=Yr(e,s.parent);Ae(l===void 0||et(l),"cannot apply $inc to a value of non-numeric type")}return Ye(e,s,u,(l,h)=>(l[h]=(l[h]||(l[h]=0))+i,!0),{buildGraph:!0})}),Lg=(e,t,r=[],n={})=>st(t,r,n,(i,s,u)=>Ye(e,s,u,(l,h)=>l[h]!==void 0&&Ge(l[h],i)>-1?!1:(l[h]=i,!0),{buildGraph:!0})),Bg=(e,t,r=[],n={})=>st(t,r,n,(i,s,u)=>Ye(e,s,u,(l,h)=>l[h]!==void 0&&Ge(l[h],i)<1?!1:(l[h]=i,!0),{buildGraph:!0})),jg=(e,t,r=[],n={})=>st(t,r,n,(i,s,u)=>Ye(e,s,u,(l,h)=>{const m=l[h];return l[h]=l[h]===void 0?0:l[h]*i,l[h]!==m},{buildGraph:!0})),Kg=(e,t,r=[],n={})=>st(t,r,n,(i,s,u)=>Ye(e,s,u,(l,h)=>{const m=l[h];return Ae(Me(m),`path '${s.selector}' contains an element of non-array type.`),m.length?(i===-1?m.splice(0,1):m.pop(),!0):!1})),Xl=(e,t,r=[],n={})=>st(t,r,n,(i,s,u)=>{const l=!Oe(i)||Object.keys(i).some(kr),h=new Mt(l?{k:i}:i,n.queryOptions),m=l?v=>h.test({k:v}):v=>h.test(v);return Ye(e,s,u,(v,g)=>{const _=v[g],O=new Array;return _.map(A=>{const L=m(A);return L||O.push(A),L}).some(Boolean)?(v[g]=O,!0):!1})}),qg=(e,t,r=[],n={})=>{const i={};return Object.entries(t).forEach(([s,u])=>{i[s]={$in:u}}),Xl(e,i,r,n)},Fg=Object.freeze(["$each","$slice","$sort","$position"]),Ug=(e,t,r=[],n={})=>st(t,r,n,(i,s,u)=>{const l={$each:[i]};return Oe(i)&&Fg.some(h=>rt(i,h))&&Object.assign(l,i),Ye(e,s,u,(h,m)=>{const v=h[m]||(h[m]=[]),g=v.slice(0,l.$slice||v.length),_=v.length,O=et(l.$position)?l.$position:v.length;if(v.splice(O,0,...us(n.cloneMode,l.$each)),l.$sort){const D=Oe(l.$sort)?Object.keys(l.$sort||{}).pop():"",A=D?l.$sort[D]:l.$sort,L=D?B=>Yr(B,D):B=>B;v.sort((B,z)=>A*Ge(L(B),L(z)))}return et(l.$slice)&&(l.$slice<0?v.splice(0,v.length+l.$slice):v.splice(l.$slice)),_!=v.length||!bt(g,v)},{descendArray:!0,buildGraph:!0})}),Zl=(e,t,r=[],n={})=>st(t,r,n,(i,s,u)=>Ye(e,s,u,(l,h)=>bt(l[h],i)?!1:(l[h]=us(n.cloneMode,i),!0),{buildGraph:!0})),Wg=(e,t,r=[],n={})=>{const i=[],s=st(t,r,n,(u,l,h)=>Ye(e,l,h,(m,v)=>rt(m,v)?(i.push(...Zl(e,{[u]:m[v]},r,n)),delete m[v],!0):!1));return Array.from(new Set(s.concat(i)))},Hg=(e,t,r=[],n={})=>st(t,r,n,(i,s,u)=>Ye(e,s,u,(l,h)=>rt(l,h)?(Me(l)?l[h]=null:delete l[h],!0):!1)),Wu=Object.freeze(Object.defineProperty({__proto__:null,$addToSet:Ag,$bit:Tg,$currentDate:Ng,$inc:$g,$max:Lg,$min:Bg,$mul:jg,$pop:Kg,$pull:Xl,$pullAll:qg,$push:Ug,$rename:Wg,$set:Zl,$unset:Hg},Symbol.toStringTag,{value:"Module"}));function ef(e){return e={...e,queryOptions:Mi(e.queryOptions)},e.queryOptions.context.addQueryOps(Cg).addExpressionOps(vm).addExpressionOps(Om),(t,r,n=[],i={},s={})=>{const u=Object.assign({cloneMode:"copy"},e,s);Object.assign(u,{queryOptions:Mi(Object.assign({useStrictMode:!1},u==null?void 0:u.queryOptions))}),n=n||[],i=i||{};const l=Object.entries(r);Ae(l.length===1,"Update expression must contain only one operator.");const[h,m]=l[0];Ae(rt(Wu,h),`Update operator '${h}' is not supported.`);const v=Wu[h];return Object.keys(i).length&&!(i instanceof Mt?i:new Mt(i,u.queryOptions)).test(t)?[]:v(t,m,n,u)}}ef({});var no;function tf(e,t){if(!no){var r=ef({cloneMode:"none"});no=(n,i)=>{var s=Qe(n);return r(s,i),s}}return no(e,t)}function zg(e){return this.incrementalModify(t=>{var r=tf(t,e);return r})}function Qg(e){var t=this._data,r=tf(t,e);return this._saveData(r,t)}async function Vg(e){return Tr(this.asRxQuery,t=>t.update(e))}var vb={name:"update",rxdb:!0,prototypes:{RxDocument:e=>{e.update=Qg,e.incrementalUpdate=zg},RxQuery:e=>{e.update=Vg}}},Gg=["__proto__","constructor","prototype"];function vn(e,t){Object.keys(t).forEach(r=>{Gg.includes(r)||(typeof e[r]>"u"?e[r]=t[r]:_n(t[r])?vn(e[r],t[r]):e[r]=t[r])})}function _n(e){return e.toString()==="[object Object]"}var ta=function(){function e(r,n){if(this.options={},this._conditions={},this._fields={},this._path=n,r){var i=this;r.selector&&i.find(r.selector),r.limit&&i.limit(r.limit),r.skip&&i.skip(r.skip),r.sort&&r.sort.forEach(s=>i.sort(s))}}var t=e.prototype;return t.where=function(n,i){if(!arguments.length)return this;var s=typeof arguments[0];if(s==="string")return this._path=arguments[0],arguments.length===2&&(this._conditions[this._path]=arguments[1]),this;if(s==="object"&&!Array.isArray(arguments[0]))return this.merge(arguments[0]);throw Ze("MQ1",{path:arguments[0]})},t.equals=function(n){this._ensurePath("equals");var i=this._path;return this._conditions[i]=n,this},t.eq=function(n){this._ensurePath("eq");var i=this._path;return this._conditions[i]=n,this},t.or=function(n){var i=this._conditions.$or||(this._conditions.$or=[]);return Array.isArray(n)||(n=[n]),i.push.apply(i,n),this},t.nor=function(n){var i=this._conditions.$nor||(this._conditions.$nor=[]);return Array.isArray(n)||(n=[n]),i.push.apply(i,n),this},t.and=function(n){var i=this._conditions.$and||(this._conditions.$and=[]);return Array.isArray(n)||(n=[n]),i.push.apply(i,n),this},t.mod=function(n,i){var s,u;arguments.length===1?(this._ensurePath("mod"),s=arguments[0],u=this._path):arguments.length===2&&!Array.isArray(arguments[1])?(this._ensurePath("mod"),s=arguments.slice(),u=this._path):arguments.length===3?(s=arguments.slice(1),u=arguments[0]):(s=arguments[1],u=arguments[0]);var l=this._conditions[u]||(this._conditions[u]={});return l.$mod=s,this},t.exists=function(n,i){var s,u;arguments.length===0?(this._ensurePath("exists"),s=this._path,u=!0):arguments.length===1?typeof arguments[0]=="boolean"?(this._ensurePath("exists"),s=this._path,u=arguments[0]):(s=arguments[0],u=!0):arguments.length===2&&(s=arguments[0],u=arguments[1]);var l=this._conditions[s]||(this._conditions[s]={});return l.$exists=u,this},t.elemMatch=function(n,i){if(arguments[0]===null)throw Ze("MQ2");var s,u,l;if(typeof arguments[0]=="function")this._ensurePath("elemMatch"),u=this._path,s=arguments[0];else if(_n(arguments[0]))this._ensurePath("elemMatch"),u=this._path,l=arguments[0];else if(typeof arguments[1]=="function")u=arguments[0],s=arguments[1];else if(arguments[1]&&_n(arguments[1]))u=arguments[0],l=arguments[1];else throw Ze("MQ2");s&&(l=new e,s(l),l=l._conditions);var h=this._conditions[u]||(this._conditions[u]={});return h.$elemMatch=l,this},t.sort=function(n){if(!n)return this;var i,s=typeof n;if(Array.isArray(n)){i=n.length;for(var u=0;u<n.length;++u)Jg(this.options,n[u][0],n[u][1]);return this}if(arguments.length===1&&s==="string"){n=n.split(/\s+/),i=n.length;for(var l=0;l<i;++l){var h=n[l];if(h){var m=h[0]==="-"?-1:1;m===-1&&(h=h.substring(1)),Hu(this.options,h,m)}}return this}if(_n(n)){var v=Object.keys(n);return v.forEach(g=>Hu(this.options,g,n[g])),this}throw Ze("MQ3",{args:arguments})},t.merge=function(n){if(!n)return this;if(!zu(n))throw Ze("MQ4",{source:n});return n instanceof e?(n._conditions&&vn(this._conditions,n._conditions),n._fields&&(this._fields||(this._fields={}),vn(this._fields,n._fields)),n.options&&(this.options||(this.options={}),vn(this.options,n.options)),n._distinct&&(this._distinct=n._distinct),this):(vn(this._conditions,n),this)},t.find=function(n){return zu(n)&&this.merge(n),this},t._ensurePath=function(n){if(!this._path)throw G("MQ5",{method:n})},t.toJSON=function(){var n={selector:this._conditions};return this.options.skip&&(n.skip=this.options.skip),this.options.limit&&(n.limit=this.options.limit),this.options.sort&&(n.sort=Yg(this.options.sort)),{query:n,path:this._path}},e}();function Yg(e){return Object.entries(e).map(([t,r])=>{var n=r===1?"asc":"desc",i={[t]:n};return i})}var rf=["limit","skip","maxScan","batchSize","comment"];rf.forEach(function(e){ta.prototype[e]=function(t){return this.options[e]=t,this}});var nf=["gt","gte","lt","lte","ne","in","nin","all","regex","size"];nf.forEach(function(e){ta.prototype[e]=function(){var t,r;arguments.length===1?(this._ensurePath(e),r=arguments[0],t=this._path):(r=arguments[1],t=arguments[0]);var n=this._conditions[t]===null||typeof this._conditions[t]=="object"?this._conditions[t]:this._conditions[t]={};if(e==="regex"){if(r instanceof RegExp)throw G("QU16",{field:t,query:this._conditions});typeof r=="string"?n["$"+e]=r:(n["$"+e]=r.$regex,r.$options&&(n.$options=r.$options))}else n["$"+e]=r;return this}});function Hu(e,t,r){if(Array.isArray(e.sort))throw Ze("MQ6",{opts:e,field:t,value:r});if(r&&r.$meta){var n=e.sort||(e.sort={});n[t]={$meta:r.$meta};return}var i=String(r||1).toLowerCase();if(!/^(?:ascending|asc|descending|desc|1|-1)$/.test(i))throw Array.isArray(r)&&(r="["+r+"]"),Ze("MQ7",{field:t,value:r});var s=e.sort||(e.sort={}),u=r.toString().replace("asc","1").replace("ascending","1").replace("desc","-1").replace("descending","-1");s[t]=parseInt(u,10)}function Jg(e,t,r){if(e.sort=e.sort||[],!Array.isArray(e.sort))throw Ze("MQ8",{opts:e,field:t,value:r});e.sort.push([t,r])}function zu(e){return e instanceof ta||_n(e)}function Xg(e,t){return new ta(e,t)}var Qu="queryBuilderPath";function Zg(e,t,r){var n=Xg(Qe(e.mangoQuery),e.other[Qu]);n[t](r);var i=n.toJSON();return Nr(e.op,i.query,e.collection,{...e.other,[Qu]:i.path})}function io(e,t){e[t]=function(r){if(ge.isDevMode()&&this.op==="findByIds")throw G("QU17",{collection:this.collection.name,query:this.mangoQuery});return Zg(this,t,r)}}var yb={name:"query-builder",rxdb:!0,prototypes:{RxQuery(e){["where","equals","eq","or","nor","and","mod","exists","elemMatch","sort"].forEach(t=>{io(e,t)}),rf.forEach(t=>{io(e,t)}),nf.forEach(t=>{io(e,t)})}}};export{mb as R,qv as a,pb as b,rb as c,vb as d,yb as e,Bf as g};
//# sourceMappingURL=rxdb-qAQF2UeV.js.map
